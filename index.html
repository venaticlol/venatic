<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recon-Spoofer - Download</title>
    
    <!-- Cloudflare DDoS Protection & Security -->
    <!-- Cloudflare Turnstile (Bot Protection) - Replace YOUR_SITE_KEY with your actual site key -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    
    <!-- Cloudflare Web Analytics (Optional) - Replace YOUR_TOKEN with your analytics token -->
    <!-- <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "YOUR_TOKEN"}'></script> -->
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <!-- Note: X-Frame-Options must be set via HTTP headers, not meta tags -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Prevent caching of source code -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <!-- KeyAuth Browser-Compatible Implementation -->
    <script>
        // Browser-compatible KeyAuth class
        class KeyAuth {
            constructor(options) {
                this.name = options.name;
                this.ownerid = options.ownerid;
                this.version = options.version;
                this.url = options.url || "https://keyauth.win/api/1.3/";
                this.sessionid = null;
                this.initialized = false;
            }

            async init() {
                if (this.initialized && this.sessionid) {
                    return;
                }

                const postData = {
                    type: "init",
                    name: this.name,
                    ownerid: this.ownerid,
                    version: this.version
                };

                try {
                    const response = await fetch(this.url, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: new URLSearchParams(postData).toString()
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data === "KeyAuth_Invalid") {
                        throw new Error("This application does not exist");
                    }

                    if (data.message === "invalidver") {
                        throw new Error("Your application is outdated");
                    }

                    if (data.success === false) {
                        throw new Error(data.message || "Initialization failed");
                    }

                    this.sessionid = data.sessionid;
                    this.initialized = true;
                    return data;
                } catch (error) {
                    console.error("KeyAuth init error:", error);
                    throw error;
                }
            }

            async license(licenseKey, hwid = null) {
                if (!this.initialized) {
                    await this.init();
                }

                if (!hwid) {
                    // Generate a simple browser HWID
                    hwid = this.getBrowserHWID();
                }

                const postData = {
                    type: "license",
                    name: this.name,
                    ownerid: this.ownerid,
                    sessionid: this.sessionid,
                    key: licenseKey,
                    hwid: hwid
                };

                try {
                    const response = await fetch(this.url, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: new URLSearchParams(postData).toString()
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data.success === true) {
                        this.user_data = data.info ? {
                            username: data.info.username,
                            ip: data.info.ip,
                            hwid: data.info.hwid || "N/A",
                            expires: data.info.subscriptions?.[0]?.expiry,
                            createdate: data.info.createdate,
                            lastlogin: data.info.lastlogin,
                            subscription: data.info.subscriptions?.[0]?.subscription,
                            subscriptions: data.info.subscriptions
                        } : null;
                        return data;
                    } else {
                        throw new Error(data.message || "Invalid license key");
                    }
                } catch (error) {
                    console.error("KeyAuth license error:", error);
                    throw error;
                }
            }

            getBrowserHWID() {
                // Generate a consistent browser fingerprint
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px "Arial"';
                ctx.textBaseline = 'alphabetic';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('KeyAuth Browser HWID', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('KeyAuth Browser HWID', 4, 17);

                const fingerprint = [
                    navigator.userAgent,
                    navigator.language,
                    screen.width + 'x' + screen.height,
                    new Date().getTimezoneOffset(),
                    canvas.toDataURL()
                ].join('|');

                // Create a simple hash
                let hash = 0;
                for (let i = 0; i < fingerprint.length; i++) {
                    const char = fingerprint.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32bit integer
                }
                return Math.abs(hash).toString();
            }
        }

        // Make KeyAuth available globally
        window.KeyAuth = KeyAuth;
        console.log('✅ KeyAuth browser implementation loaded');
    </script>
    
    <!-- Developer Tools Protection -->
    <script>
        // ============================================
        // DEVELOPER TOOLS PROTECTION
        // ============================================
        
        // Disable right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        }, false);
        
        // Disable common keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Disable F12 (DevTools)
            if (e.key === 'F12' || e.keyCode === 123) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Disable Ctrl+Shift+I (DevTools)
            if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.keyCode === 73)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Disable Ctrl+Shift+J (Console)
            if (e.ctrlKey && e.shiftKey && (e.key === 'J' || e.keyCode === 74)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Disable Ctrl+Shift+C (Inspect Element)
            if (e.ctrlKey && e.shiftKey && (e.key === 'C' || e.keyCode === 67)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Disable Ctrl+U (View Source)
            if (e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.keyCode === 85)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Disable Ctrl+S (Save Page)
            if (e.ctrlKey && (e.key === 's' || e.key === 'S' || e.keyCode === 83)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Disable Ctrl+P (Print - can be used to view source)
            if (e.ctrlKey && (e.key === 'p' || e.key === 'P' || e.keyCode === 80)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
            
            // Disable Ctrl+Shift+Delete
            if (e.ctrlKey && e.shiftKey && (e.key === 'Delete' || e.keyCode === 46)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }, true);
        
        // Disable text selection
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        }, false);
        
        // Disable drag
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        }, false);
        
        // Advanced DevTools Detection (multiple methods)
        let devtools = {
            open: false,
            orientation: null,
            detectionCount: 0,
            lastCheck: Date.now()
        };
        
        // Block access function (defined first)
        function blockAccess() {
            // Only block if confirmed DevTools is open
            devtools.detectionCount++;
            if (devtools.detectionCount < 2) {
                return; // Require 2 confirmations (reduced from 3)
            }
            
            try {
                // Clear all intervals
                for (let i = 1; i < 99999; i++) {
                    try {
                        clearInterval(i);
                        clearTimeout(i);
                    } catch(e) {}
                }
                
                // Redirect to prevent access
                document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0a0a0a; color: #ef4444; font-size: 24px; font-family: Arial, sans-serif; text-align: center; padding: 20px;">Developer Tools Detected.<br><br>Please close DevTools and refresh the page.</div>';
                
                // Prevent further execution
                setTimeout(function() {
                    window.location.href = '/';
                }, 2000);
            } catch(e) {
                window.location.href = '/';
            }
        }
        
        // Wait for page to fully load before starting detection (reduced delay)
        let detectionActive = false;
        setTimeout(function() {
            detectionActive = true;
        }, 1000); // Wait 1 second after page load (reduced from 2)
        
        // Method 1: Window size detection (improved)
        const threshold = 150; // Reduced threshold for better detection
        let checkInterval1 = setInterval(function() {
            if (!detectionActive) return;
            
            const heightDiff = Math.abs(window.outerHeight - window.innerHeight);
            const widthDiff = Math.abs(window.outerWidth - window.innerWidth);
            
            // Check if DevTools is open (either side or bottom)
            const isOpen = (heightDiff > threshold && window.innerHeight > 200) || 
                          (widthDiff > threshold && window.innerWidth > 200);
            
            if (isOpen) {
                if (!devtools.open) {
                    devtools.open = true;
                    devtools.lastCheck = Date.now();
                    blockAccess();
                }
            } else {
                // Reset only if DevTools was closed for a while
                if (devtools.open && Date.now() - devtools.lastCheck > 2000) {
                    devtools.open = false;
                    devtools.detectionCount = 0;
                }
            }
        }, 200); // Check more frequently
        
        // Method 2: Console detection (improved)
        try {
            let consoleAccessCount = 0;
            let element = new Image();
            Object.defineProperty(element, 'id', {
                get: function() {
                    consoleAccessCount++;
                    if (consoleAccessCount > 2 && detectionActive) {
                        blockAccess();
                    }
                    return '';
                }
            });
            // Check console access periodically
            setTimeout(function() {
                setInterval(function() {
                    if (detectionActive) {
                        try {
                            console.log(element);
                            console.clear();
                        } catch(e) {}
                    }
                }, 1500);
            }, 2000);
        } catch(e) {}
        
        // Method 3: DevTools property detection (improved)
        try {
            let devtoolsCheck = /./;
            let checkCount = 0;
            devtoolsCheck.toString = function() {
                checkCount++;
                if (checkCount > 3 && detectionActive) {
                    blockAccess();
                }
                return '';
            };
            // Check periodically
            setTimeout(function() {
                setInterval(function() {
                    if (detectionActive) {
                        try {
                            console.log(devtoolsCheck);
                            console.clear();
                        } catch(e) {}
                    }
                }, 1500);
            }, 2000);
        } catch(e) {}
        
        // Method 4: Focus detection (improved)
        let focusCheck = Date.now();
        let focusChangeCount = 0;
        window.addEventListener('blur', function() {
            focusCheck = Date.now();
        });
        window.addEventListener('focus', function() {
            if (detectionActive && Date.now() - focusCheck > 1500) {
                focusChangeCount++;
                if (focusChangeCount > 1) {
                    blockAccess();
                }
            }
        });
        
        // Method 5: Continuous window monitoring
        let lastInnerHeight = window.innerHeight;
        let lastInnerWidth = window.innerWidth;
        setInterval(function() {
            if (!detectionActive) return;
            
            const currentHeight = window.innerHeight;
            const currentWidth = window.innerWidth;
            
            // If window size changed significantly, might be DevTools
            if (Math.abs(currentHeight - lastInnerHeight) > 100 || 
                Math.abs(currentWidth - lastInnerWidth) > 100) {
                // Check if it's actually DevTools
                const heightDiff = Math.abs(window.outerHeight - window.innerHeight);
                const widthDiff = Math.abs(window.outerWidth - window.innerWidth);
                if (heightDiff > threshold || widthDiff > threshold) {
                    blockAccess();
                }
            }
            
            lastInnerHeight = currentHeight;
            lastInnerWidth = currentWidth;
        }, 300);
        
        // Advanced Console Protection (less aggressive)
        (function() {
            const noop = function() {};
            const methods = ['log', 'debug', 'info', 'warn', 'error', 'assert', 'clear', 'count', 'dir', 'dirxml', 'group', 'groupCollapsed', 'groupEnd', 'profile', 'profileEnd', 'table', 'time', 'timeEnd', 'timeStamp', 'trace', 'memory'];
            
            // Override console methods (only block after detection is active)
            methods.forEach(function(method) {
                try {
                    const original = window.console[method];
                    window.console[method] = function() {
                        if (detectionActive && devtools.detectionCount > 0) {
                            blockAccess();
                        }
                        return noop;
                    };
                } catch(e) {
                    try {
                        window.console[method] = noop;
                    } catch(e2) {}
                }
            });
        })();
        
        // Clear console less frequently to avoid false positives
        setTimeout(function() {
            setInterval(function() {
                if (detectionActive) {
                    try {
                        console.clear();
                    } catch(e) {}
                }
            }, 1000);
        }, 3000);
        
        // Disable common DevTools detection bypasses
        Object.defineProperty(window, 'devtools', {
            get: function() {
                blockAccess();
                return { open: false, orientation: null };
            },
            configurable: false
        });
        
        // Protect source code access
        Object.defineProperty(document, 'scripts', {
            get: function() {
                blockAccess();
                return [];
            },
            configurable: false
        });
        
        // Disable view source
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                blockAccess();
                return false;
            }
        }, true);
        
        // Prevent opening DevTools via menu and other methods
        document.addEventListener('keydown', function(e) {
            // Alt key combinations
            if (e.altKey) {
                if (e.key === 'F4' || e.keyCode === 115) {
                    e.preventDefault();
                    blockAccess();
                    return false;
                }
            }
            
            // Additional shortcuts
            if (e.key === 'F12' || e.keyCode === 123) {
                e.preventDefault();
                blockAccess();
                return false;
            }
        }, true);
        
        // Disable source viewing methods
        window.addEventListener('beforeunload', function(e) {
            if (devtools.open) {
                e.preventDefault();
                e.returnValue = '';
                blockAccess();
            }
        });
        
        // Obfuscate source code access
        (function() {
            const scripts = document.getElementsByTagName('script');
            for (let i = 0; i < scripts.length; i++) {
                try {
                    Object.defineProperty(scripts[i], 'innerHTML', {
                        get: function() {
                            blockAccess();
                            return '';
                        },
                        set: function() {}
                    });
                    Object.defineProperty(scripts[i], 'text', {
                        get: function() {
                            blockAccess();
                            return '';
                        },
                        set: function() {}
                    });
                } catch(e) {}
            }
        })();
        
        // Monitor for source code access attempts
        const originalQuerySelector = Document.prototype.querySelector;
        Document.prototype.querySelector = function(selector) {
            if (selector && (selector.includes('script') || selector.includes('style'))) {
                blockAccess();
            }
            return originalQuerySelector.apply(this, arguments);
        };
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000000;
            background-image: 
                linear-gradient(rgba(42, 42, 42, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(42, 42, 42, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: 0 0, 0 0;
            color: #e5e5e5;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(42, 42, 42, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(42, 42, 42, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: 0 0, 0 0;
            pointer-events: none;
            z-index: 0;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(150, 150, 150, 0.3);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.3;
            }
            90% {
                opacity: 0.3;
            }
            50% {
                transform: translateY(-100vh) translateX(50px);
                opacity: 0.5;
            }
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
            z-index: 1;
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 80px 24px;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, rgba(100, 100, 100, 0.08) 0%, transparent 70%);
            pointer-events: none;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 0.5;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        .brand-title {
            font-size: clamp(48px, 8vw, 72px);
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #ffffff 0%, #b0b0b0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.2s forwards, subtleFloat 6s ease-in-out infinite 1s;
            position: relative;
            transition: all 0.3s ease;
        }

        .brand-title.glitching {
            animation: fadeInUp 0.8s ease-out 0.2s forwards, subtleFloat 6s ease-in-out infinite 1s, glitch 0.3s ease-in-out;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.2s ease;
        }

        @keyframes subtleFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        @keyframes glitch {
            0%, 100% {
                transform: translate(0);
            }
            20% {
                transform: translate(-2px, 2px);
            }
            40% {
                transform: translate(-2px, -2px);
            }
            60% {
                transform: translate(2px, 2px);
            }
            80% {
                transform: translate(2px, -2px);
            }
        }

        .tagline {
            font-size: clamp(18px, 2.5vw, 24px);
            font-weight: 400;
            color: #a0a0a0;
            margin-bottom: 48px;
            letter-spacing: 0.02em;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.4s forwards;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 18px 56px;
            font-size: 16px;
            font-weight: 600;
            color: #e5e5e5;
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 2px;
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.6s forwards;
            position: relative;
            overflow: hidden;
        }

        .ticket-create-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 18px 56px;
            font-size: 16px;
            font-weight: 600;
            color: #e5e5e5;
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 2px;
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .ticket-create-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
            transition: left 0.6s;
        }

        .ticket-create-btn:hover::before {
            left: 100%;
        }

        .ticket-create-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
            border-color: #6a6a6a;
            background: #222222;
        }

        .ticket-create-btn:active {
            transform: translateY(-2px) scale(1);
        }

        .ticket-create-btn:hover .download-icon {
            transform: translateY(2px);
        }

        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
            transition: left 0.6s;
        }

        .download-btn:hover::before {
            left: 100%;
        }

        .download-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
            border-color: #6a6a6a;
            background: #222222;
        }

        .download-btn:active {
            transform: translateY(-2px) scale(1);
        }

        .download-icon {
            width: 18px;
            height: 18px;
            transition: transform 0.3s ease;
        }

        .download-btn:hover .download-icon {
            transform: translateY(2px);
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 48px;
            margin-top: 64px;
            flex-wrap: wrap;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.8s forwards;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #e5e5e5;
            display: block;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #b0b0b0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 12px;
            color: #888888;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Features Section */
        .features {
            padding: 120px 24px;
            background: linear-gradient(to bottom, #000000 0%, #0a0a0a 100%);
            position: relative;
        }

        .section-title {
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #ffffff 0%, #b0b0b0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            text-align: center;
            color: #888888;
            font-size: 16px;
            margin-bottom: 64px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 32px;
            margin-top: 64px;
        }

        .feature-card {
            padding: 40px;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(30px);
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            transition: left 0.6s;
        }

        .feature-card:hover::before {
            left: 100%;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            border-color: #3a3a3a;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.1) rotate(5deg);
            border-color: #4a4a4a;
        }

        .feature-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #e5e5e5;
        }

        .feature-text {
            font-size: 14px;
            color: #888888;
            line-height: 1.7;
        }

        /* System Requirements */
        .requirements {
            padding: 120px 24px;
            background: linear-gradient(to bottom, #0a0a0a 0%, #000000 100%);
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
            margin-top: 48px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .req-card {
            padding: 32px;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.4s ease;
        }

        .req-card:hover {
            transform: translateY(-4px);
            border-color: #2a2a2a;
        }

        .req-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #e5e5e5;
            padding-bottom: 12px;
            border-bottom: 1px solid #1a1a1a;
        }

        .req-list {
            list-style: none;
        }

        .req-list li {
            padding: 8px 0;
            color: #888888;
            font-size: 14px;
            position: relative;
            padding-left: 24px;
        }

        .req-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #6a6a6a;
            font-weight: 600;
        }

        /* Installer Info Panel */
        .installer-info {
            padding: 120px 24px;
            display: flex;
            justify-content: center;
            background: linear-gradient(to bottom, #000000 0%, #0a0a0a 100%);
        }

        .info-card {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            padding: 48px;
            max-width: 600px;
            width: 100%;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.4s ease;
        }

        .info-card:hover {
            border-color: #2a2a2a;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }

        .info-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 32px;
            color: #e5e5e5;
            text-align: center;
        }

        .info-grid {
            display: grid;
            gap: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #050505;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .info-item:hover {
            border-color: #2a2a2a;
            background: #0f0f0f;
        }

        .info-label {
            color: #888888;
            font-weight: 500;
            font-size: 14px;
        }

        .info-value {
            color: #e5e5e5;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            font-weight: 600;
        }

        .hash-value {
            font-size: 11px;
            word-break: break-all;
            text-align: right;
            max-width: 300px;
        }

        /* Changelog Section */
        .changelog {
            padding: 120px 24px;
            background: linear-gradient(to bottom, #0a0a0a 0%, #000000 100%);
        }

        .changelog-content {
            max-width: 800px;
            margin: 0 auto;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            padding: 40px;
            opacity: 0;
            transform: translateY(30px);
        }

        .changelog-item {
            padding: 20px 0;
            border-bottom: 1px solid #1a1a1a;
        }

        .changelog-item:last-child {
            border-bottom: none;
        }

        .changelog-version {
            font-size: 18px;
            font-weight: 600;
            color: #e5e5e5;
            margin-bottom: 8px;
        }

        .changelog-date {
            font-size: 12px;
            color: #666666;
            margin-bottom: 12px;
            line-height: 1.8;
            word-wrap: break-word;
            white-space: normal;
            display: flex;
            align-items: baseline;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .changelog-date-label {
            display: inline-block;
            white-space: nowrap;
        }
        
        .changelog-date-value {
            display: inline-block;
            font-weight: 500;
            color: #888888;
        }

        .changelog-list {
            list-style: none;
            padding-left: 0;
        }

        .changelog-loading {
            text-align: center;
            padding: 40px;
            color: #666666;
            font-size: 14px;
        }

        .changelog-empty {
            text-align: center;
            padding: 40px;
            color: #666666;
            font-size: 14px;
        }

        /* Surveys Section */
        .surveys {
            padding: 120px 24px;
            background: linear-gradient(to bottom, #0a0a0a 0%, #000000 100%);
        }

        .surveys-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .survey-item {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            padding: 40px;
            margin-bottom: 32px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .survey-item:hover {
            border-color: #2a2a2a;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }

        .survey-title {
            font-size: 24px;
            font-weight: 600;
            color: #e5e5e5;
            margin-bottom: 12px;
        }

        .survey-description {
            font-size: 14px;
            color: #888888;
            line-height: 1.7;
            margin-bottom: 24px;
        }

        .survey-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .survey-option-btn {
            padding: 16px 24px;
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            color: #e5e5e5;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .survey-option-btn:hover:not(:disabled) {
            background: #222222;
            border-color: #6a6a6a;
            transform: translateX(4px);
        }

        .survey-option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .survey-rating {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .rating-btn {
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            padding: 12px 16px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rating-btn:hover:not(:disabled) {
            background: #222222;
            border-color: #6a6a6a;
            transform: scale(1.1);
        }

        .rating-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Support Tickets Section */
        .support-section {
            padding: 120px 24px;
            background: linear-gradient(to bottom, #000000 0%, #0a0a0a 100%);
        }

        .support-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .ticket-item {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }

        .ticket-item:hover {
            border-color: #2a2a2a;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }

        .ticket-content {
            flex: 1;
            cursor: pointer;
        }

        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .ticket-id {
            font-size: 14px;
            font-weight: 600;
            color: #3b82f6;
            font-family: monospace;
        }

        .ticket-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .ticket-status.open {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .ticket-status.closed {
            background: rgba(107, 114, 128, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        .ticket-title {
            font-size: 18px;
            font-weight: 600;
            color: #e5e5e5;
            margin-bottom: 8px;
        }

        .ticket-meta {
            font-size: 12px;
            color: #888;
            display: flex;
            gap: 16px;
        }

        .ticket-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .ticket-action-btn {
            background: rgba(26, 26, 26, 0.6);
            border: 1px solid #2a2a2a;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
        }

        .ticket-action-btn:hover {
            background: rgba(42, 42, 42, 0.8);
            border-color: #3a3a3a;
            transform: translateY(-2px);
        }

        .ticket-action-btn.view-btn:hover {
            color: #3b82f6;
            border-color: rgba(59, 130, 246, 0.3);
        }

        .ticket-action-btn.delete-btn:hover {
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.3);
        }

        .ticket-action-btn:active {
            transform: translateY(0);
        }

        /* Ticket Modal */
        .ticket-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .ticket-modal.active {
            display: flex;
        }

        .ticket-modal-content {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .ticket-modal-header {
            padding: 24px;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ticket-modal-header button {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .ticket-modal-header button:hover {
            color: #ef4444;
            transform: rotate(90deg);
        }

        .ticket-modal-body {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        .ticket-form-group {
            margin-bottom: 20px;
        }

        .ticket-form-label {
            display: block;
            color: #e5e5e5;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .ticket-input, .ticket-textarea {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            color: #e5e5e5;
            font-size: 14px;
            font-family: inherit;
        }

        .ticket-input:focus, .ticket-textarea:focus {
            outline: none;
            border-color: #6a6a6a;
        }

        .ticket-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .ticket-messages {
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 16px;
            background: #000;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
        }

        .ticket-message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 4px;
            max-width: 80%;
        }

        .ticket-message.user {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            margin-left: auto;
        }

        .ticket-message.admin {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .ticket-message-header {
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ticket-message-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid rgba(74, 74, 74, 0.5);
        }

        .ticket-message-user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ticket-message-username {
            font-weight: 600;
            color: #e5e5e5;
        }

        /* User Profile Styles */
        .user-profile-container {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 1000;
        }

        .user-profile-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid rgba(42, 42, 42, 0.5);
            border-radius: 8px;
            color: #e5e5e5;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .user-profile-btn:hover {
            background: rgba(26, 26, 26, 0.9);
            border-color: rgba(74, 74, 74, 0.7);
            transform: translateY(-2px);
        }

        .user-profile-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(74, 74, 74, 0.5);
        }

        .user-profile-name {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .profile-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .profile-modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .profile-modal-overlay.required {
            pointer-events: all !important;
        }

        .profile-modal-overlay.required .profile-modal {
            pointer-events: all;
        }

        .profile-modal {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .profile-modal-overlay.active .profile-modal {
            transform: scale(1);
        }

        .profile-modal-header {
            padding: 24px;
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-modal-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
            color: #e5e5e5;
        }

        .profile-modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .profile-modal-close:hover {
            color: #ef4444;
            transform: rotate(90deg);
        }

        .profile-modal-body {
            padding: 24px;
        }

        .profile-avatar-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(74, 74, 74, 0.5);
            background: #1a1a1a;
        }

        .profile-avatar-upload-btn {
            padding: 10px 20px;
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 8px;
            color: #e5e5e5;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .profile-avatar-upload-btn:hover {
            background: rgba(42, 42, 42, 0.8);
            border-color: rgba(74, 74, 74, 0.8);
        }

        .profile-form-group {
            margin-bottom: 20px;
        }

        .profile-form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #c0c0c0;
        }

        .profile-form-input {
            width: 100%;
            padding: 12px 16px;
            background: #050505;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            color: #e5e5e5;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .profile-form-input:focus {
            outline: none;
            border-color: #4a4a4a;
            background: #0a0a0a;
        }

        .profile-form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .profile-submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border: 1px solid #4a4a4a;
            border-radius: 8px;
            color: #e5e5e5;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .profile-submit-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #222222 0%, #1a1a1a 100%);
            border-color: #6a6a6a;
            transform: translateY(-2px);
        }

        .profile-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .profile-logout-btn {
            margin-top: 12px;
            width: 100%;
            padding: 12px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .profile-logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
            transform: translateY(-1px);
        }

        .profile-error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
        }

        .profile-error-message.show {
            display: block;
        }

        .profile-tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: #888;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .profile-tab-btn.active {
            color: #e5e5e5;
            border-bottom-color: #3b82f6;
        }

        .profile-tab-btn:hover {
            color: #b0b0b0;
        }

        .ticket-message-text {
            color: #e5e5e5;
            font-size: 14px;
            line-height: 1.5;
        }

        .ticket-message-image {
            margin-top: 12px;
            border-radius: 8px;
            overflow: hidden;
            max-width: 100%;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .ticket-message-image:hover {
            transform: scale(1.02);
        }

        .ticket-message-image img {
            width: 100%;
            height: auto;
            display: block;
            max-width: 400px;
        }

        .ticket-input-area {
            display: flex;
            gap: 12px;
        }

        .ticket-image-preview {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .ticket-image-preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid rgba(59, 130, 246, 0.4);
        }

        .ticket-image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ticket-image-preview-item button {
            position: absolute;
            top: -8px;
            right: -8px;
            background: rgba(239, 68, 68, 0.9);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .ticket-image-preview-item button:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }

        .ticket-attach-btn, .ticket-voice-btn {
            padding: 12px 16px;
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            color: #e5e5e5;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .ticket-attach-btn:hover, .ticket-voice-btn:hover {
            background: #222222;
            border-color: #6a6a6a;
        }

        .ticket-voice-btn.recording {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
            color: #ef4444;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .ticket-attach-btn svg, .ticket-voice-btn svg {
            width: 18px;
            height: 18px;
        }

        .ticket-send-btn {
            padding: 12px 24px;
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            color: #e5e5e5;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ticket-send-btn:hover:not(:disabled) {
            background: #222222;
            border-color: #6a6a6a;
        }

        .ticket-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ticket-btn-secondary {
            background: rgba(74, 74, 74, 0.3);
            border: 1px solid #4a4a4a;
            color: #e5e5e5;
        }

        .ticket-btn-secondary:hover {
            background: rgba(74, 74, 74, 0.5);
        }

        .ticket-error {
            color: #ef4444;
            font-size: 13px;
            margin-bottom: 16px;
            display: none;
        }
        
        .ticket-voice-message {
            margin-top: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .ticket-voice-player {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ticket-voice-play-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #3b82f6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .ticket-voice-play-btn:hover {
            background: rgba(59, 130, 246, 0.3);
        }
        
        .ticket-voice-duration {
            font-size: 12px;
            color: #888;
            min-width: 50px;
        }

        input[type="file"] {
            display: none;
        }
        
        /* Re-enable text selection for input fields and textareas */
        input, textarea, [contenteditable="true"], .ticket-input, .form-input, .profile-form-input, .profile-form-textarea {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }

        .changelog-list li {
            padding: 6px 0;
            padding-left: 24px;
            color: #888888;
            font-size: 14px;
            position: relative;
        }

        .changelog-list li::before {
            content: '•';
            position: absolute;
            left: 8px;
            color: #6a6a6a;
        }

        /* Second Download Section */
        .download-section {
            padding: 120px 24px;
            text-align: center;
            background: linear-gradient(to bottom, #000000 0%, #0a0a0a 100%);
            position: relative;
        }

        .download-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(100, 100, 100, 0.05) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        .download-section .download-btn {
            opacity: 1;
            animation: none;
            position: relative;
            z-index: 1;
        }

        /* Footer */
        .footer {
            padding: 64px 24px;
            text-align: center;
            border-top: 1px solid #1a1a1a;
            background: #000000;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
            margin-bottom: 32px;
        }

        .footer-link {
            color: #888888;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
        }

        .footer-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 1px;
            background: #6a6a6a;
            transition: width 0.3s ease;
        }

        .footer-link:hover {
            color: #e5e5e5;
        }

        .footer-link:hover::after {
            width: 100%;
        }

        /* Announcements Banner */
        .announcement-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10000;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border-bottom: 1px solid rgba(74, 74, 74, 0.3);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            animation: slideDown 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .announcement-banner.info {
            border-left: 4px solid #3b82f6;
        }

        .announcement-banner.success {
            border-left: 4px solid #10b981;
        }

        .announcement-banner.warning {
            border-left: 4px solid #f59e0b;
        }

        .announcement-banner.error {
            border-left: 4px solid #ef4444;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .announcement-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
        }

        .announcement-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .announcement-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .announcement-title {
            color: #e5e5e5;
            font-size: 14px;
            font-weight: 600;
        }

        .announcement-message {
            color: #a0a0a0;
            font-size: 13px;
        }

        .announcement-link {
            color: #3b82f6;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            transition: color 0.2s;
        }

        .announcement-link:hover {
            color: #60a5fa;
        }

        .announcement-close {
            background: transparent;
            border: none;
            color: #888888;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
            flex-shrink: 0;
        }

        .announcement-close:hover {
            color: #e5e5e5;
        }

        /* Admin Login Button */
        .admin-login-btn-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
        }

        .admin-login-btn {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 8px;
            padding: 8px 12px;
            color: #e5e5e5;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .admin-login-btn:hover {
            background: rgba(42, 42, 42, 0.9);
            border-color: rgba(106, 106, 106, 0.7);
        }

        .admin-login-btn svg {
            width: 18px;
            height: 18px;
        }

        .admin-login-btn.logged-in {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.5);
            color: #10b981;
        }

        /* Language Switcher */
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .lang-btn {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 8px;
            padding: 8px 12px;
            color: #e5e5e5;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .lang-btn:hover {
            background: rgba(42, 42, 42, 0.9);
            border-color: rgba(106, 106, 106, 0.7);
        }

        .lang-btn svg {
            width: 18px;
            height: 18px;
        }

        .lang-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 8px;
            padding: 4px;
            min-width: 150px;
            display: none;
            flex-direction: column;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
        }

        .lang-dropdown.show {
            display: flex;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .lang-option {
            background: transparent;
            border: none;
            color: #e5e5e5;
            padding: 10px 12px;
            text-align: left;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .lang-option:hover {
            background: rgba(74, 74, 74, 0.5);
        }

        .lang-option.active {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        /* Adjust main content when announcement is visible */
        body:has(.announcement-banner[style*="display: block"]) .main-content {
            margin-top: 60px;
        }

        .footer-text {
            color: #666666;
            font-size: 12px;
        }

        /* Rating Section */
        .rating-section {
            padding: 120px 24px;
            background: linear-gradient(to bottom, #0a0a0a 0%, #000000 100%);
        }

        .rating-container {
            max-width: 600px;
            margin: 0 auto;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 4px;
            padding: 48px;
            opacity: 0;
            transform: translateY(30px);
        }

        .rating-display {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 1px solid #1a1a1a;
        }

        .rating-stars-display {
            font-size: 48px;
            letter-spacing: 8px;
            margin-bottom: 16px;
            color: #4a4a4a;
        }

        .rating-stars-display .star {
            display: inline-block;
            transition: color 0.3s ease;
        }

        .rating-stars-display .star.filled {
            color: #ffd700;
        }

        .rating-stars-display .star.half {
            background: linear-gradient(90deg, #ffd700 50%, #4a4a4a 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rating-value {
            font-size: 36px;
            font-weight: 700;
            color: #e5e5e5;
            margin-bottom: 8px;
        }

        .rating-count {
            font-size: 14px;
            color: #888888;
        }

        .rating-input {
            text-align: center;
        }

        .rating-label {
            font-size: 16px;
            color: #a0a0a0;
            margin-bottom: 20px;
        }

        .star-rating {
            font-size: 40px;
            letter-spacing: 12px;
            margin-bottom: 24px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .star-input {
            color: #4a4a4a;
            transition: all 0.2s ease;
            cursor: pointer;
            user-select: none;
        }

        .star-input:hover {
            color: #ffd700;
            transform: scale(1.2);
        }

        .star-input.active {
            color: #ffd700;
        }

        .rating-submit-btn {
            padding: 14px 32px;
            background: #1a1a1a;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            color: #e5e5e5;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .rating-submit-btn:hover:not(:disabled) {
            background: #222222;
            border-color: #6a6a6a;
            transform: translateY(-2px);
        }

        .rating-submit-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .rating-message {
            margin-top: 16px;
            font-size: 14px;
            min-height: 20px;
        }

        .rating-message.success {
            color: #4ade80;
        }

        .rating-message.error {
            color: #ff6b6b;
        }

        /* Review Bubbles */
        .review-bubbles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            overflow: hidden;
        }

        .review-bubble {
            position: fixed;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(42, 42, 42, 0.7);
            border-radius: 12px;
            padding: 12px 16px;
            max-width: 240px;
            min-width: 200px;
            pointer-events: auto;
            opacity: 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            font-size: 12px;
            z-index: 100;
        }

        .review-bubble.slide-left {
            left: 20px;
            animation: bubbleSlideIn 6s ease-in-out forwards;
        }

        .review-bubble.slide-right {
            right: 20px;
            animation: bubbleSlideInRight 6s ease-in-out forwards;
        }

        .review-bubble:hover {
            background: rgba(10, 10, 10, 0.95);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            border-color: rgba(58, 58, 58, 0.8);
        }

        .review-bubble-close {
            position: absolute;
            top: 6px;
            right: 8px;
            width: 18px;
            height: 18px;
            background: rgba(42, 42, 42, 0.6);
            border: none;
            border-radius: 50%;
            color: #888888;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
            pointer-events: auto;
            line-height: 1;
        }

        .review-bubble:hover .review-bubble-close {
            opacity: 1;
        }

        .review-bubble-close:hover {
            background: rgba(58, 58, 58, 0.8);
            color: #e5e5e5;
        }

        .review-bubble-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .review-bubble-stars {
            color: #ffd700;
            font-size: 11px;
            letter-spacing: 1px;
        }

        .review-bubble-text {
            font-size: 11px;
            color: #b0b0b0;
            line-height: 1.4;
            margin-bottom: 6px;
            margin-top: 4px;
        }

        .review-bubble-author {
            font-size: 10px;
            color: #666666;
            font-style: italic;
        }

        @keyframes bubbleSlideIn {
            0% {
                opacity: 0;
                transform: translateX(-100%) translateY(0);
            }
            10% {
                opacity: 0.8;
                transform: translateX(0) translateY(0);
            }
            80% {
                opacity: 0.8;
                transform: translateX(0) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-100%) translateY(0);
            }
        }

        @keyframes bubbleSlideInRight {
            0% {
                opacity: 0;
                transform: translateX(100%) translateY(0);
            }
            10% {
                opacity: 0.8;
                transform: translateX(0) translateY(0);
            }
            80% {
                opacity: 0.8;
                transform: translateX(0) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(100%) translateY(0);
            }
        }

        /* Review Stream Ticker */
        .review-stream-section {
            padding: 30px 0;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(42, 42, 42, 0.3);
            border-bottom: 1px solid rgba(42, 42, 42, 0.3);
            overflow: hidden;
            position: relative;
        }

        .review-stream-container {
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .review-stream-track {
            display: inline-flex;
            gap: 30px;
            animation: streamScroll 8s linear infinite;
            will-change: transform;
            white-space: nowrap;
        }

        .review-stream-track:hover {
            animation-play-state: paused;
        }

        @keyframes streamScroll {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(-50%);
            }
        }

        .review-stream-item {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background: rgba(10, 10, 10, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(42, 42, 42, 0.5);
            border-radius: 8px;
            white-space: nowrap;
            min-width: fit-content;
        }

        .review-stream-stars {
            color: #ffd700;
            font-size: 14px;
            letter-spacing: 2px;
            flex-shrink: 0;
        }

        .review-stream-text {
            color: #b0b0b0;
            font-size: 13px;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .review-stream-separator {
            width: 1px;
            height: 20px;
            background: rgba(42, 42, 42, 0.5);
            flex-shrink: 0;
        }

        .review-stream-user {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .review-stream-user:hover {
            opacity: 0.8;
        }

        .review-stream-user img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid rgba(74, 74, 74, 0.5);
        }


        .review-bubbles-container.hidden {
            display: none;
        }

        .review-bubbles-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(42, 42, 42, 0.6);
            border-radius: 50%;
            color: #888888;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 101;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .review-bubbles-toggle:hover {
            background: rgba(10, 10, 10, 0.95);
            border-color: rgba(58, 58, 58, 0.8);
            color: #e5e5e5;
            transform: scale(1.1);
        }

        .review-bubbles-toggle.hidden {
            opacity: 0.5;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scroll reveal animation */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Login Modal */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            background-image: 
                linear-gradient(rgba(42, 42, 42, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(42, 42, 42, 0.15) 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: 0 0, 0 0;
            backdrop-filter: blur(10px);
            z-index: 10000;
            opacity: 1;
            transition: opacity 0.3s ease;
            overflow: hidden;
        }

        .login-overlay.hide-landing {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }

        .login-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Login Landing Page */
        .login-landing {
            min-height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 0;
            position: relative;
            overflow: hidden;
        }

        .login-landing.hidden {
            display: none;
        }

        .landing-hero {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 80px 24px;
            position: relative;
        }

        .landing-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, rgba(100, 100, 100, 0.08) 0%, transparent 70%);
            pointer-events: none;
            animation: pulse 4s ease-in-out infinite;
        }

        .landing-title {
            font-size: clamp(48px, 8vw, 72px);
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #ffffff 0%, #b0b0b0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.2s forwards;
            position: relative;
            z-index: 1;
        }

        .landing-subtitle {
            font-size: clamp(18px, 2.5vw, 24px);
            font-weight: 400;
            color: #a0a0a0;
            margin-bottom: 48px;
            letter-spacing: 0.02em;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.4s forwards;
            position: relative;
            z-index: 1;
        }

        .landing-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            max-width: 900px;
            width: 100%;
            margin: 0 auto 48px;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.6s forwards;
            position: relative;
            z-index: 1;
        }

        .landing-feature {
            padding: 24px;
            background: rgba(10, 10, 10, 0.6);
            border: 1px solid rgba(42, 42, 42, 0.5);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .landing-feature:hover {
            transform: translateY(-4px);
            border-color: rgba(74, 74, 74, 0.7);
            background: rgba(15, 15, 15, 0.6);
        }

        .landing-feature-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .landing-feature-title {
            font-size: 16px;
            font-weight: 600;
            color: #e5e5e5;
            margin-bottom: 8px;
        }

        .landing-feature-text {
            font-size: 13px;
            color: #888888;
            line-height: 1.5;
        }

        .landing-cta {
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.8s forwards;
            position: relative;
            z-index: 1;
        }

        .landing-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 18px 56px;
            font-size: 16px;
            font-weight: 600;
            color: #e5e5e5;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border: 1px solid #4a4a4a;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .landing-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
            transition: left 0.6s;
        }

        .landing-btn:hover::before {
            left: 100%;
        }

        .landing-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
            border-color: #6a6a6a;
            background: linear-gradient(135deg, #222222 0%, #1a1a1a 100%);
        }

        .landing-btn:active {
            transform: translateY(-2px) scale(1);
        }

        .landing-btn-icon {
            width: 18px;
            height: 18px;
            transition: transform 0.3s ease;
        }

        .landing-btn:hover .landing-btn-icon {
            transform: translateX(4px);
        }

        .login-modal {
            background: linear-gradient(135deg, #0a0a0a 0%, #0f0f0f 100%);
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 0;
            max-width: 520px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255, 255, 255, 0.05);
            animation: modalSlideIn 0.4s ease-out;
            overflow: hidden;
            position: relative;
        }

        .login-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .login-header {
            padding: 40px 48px 32px;
            text-align: center;
            background: linear-gradient(180deg, rgba(26, 26, 26, 0.5) 0%, transparent 100%);
            border-bottom: 1px solid rgba(42, 42, 42, 0.5);
        }

        .login-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 2px solid #3a3a3a;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            position: relative;
            overflow: hidden;
        }

        .login-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .login-icon svg {
            position: relative;
            z-index: 1;
            width: 36px;
            height: 36px;
            stroke: #e5e5e5;
        }

        .login-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #b0b0b0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .login-subtitle {
            color: #888888;
            font-size: 15px;
            margin-bottom: 0;
            line-height: 1.5;
        }

        .login-body {
            padding: 32px 48px 40px;
        }

        .login-info {
            background: rgba(5, 5, 5, 0.6);
            border: 1px solid rgba(42, 42, 42, 0.5);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .login-info-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            margin-top: 2px;
            color: #6a6a6a;
        }

        .login-info-text {
            font-size: 13px;
            color: #a0a0a0;
            line-height: 1.6;
        }

        .login-info-text strong {
            color: #e5e5e5;
            font-weight: 600;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #c0c0c0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-label-icon {
            width: 16px;
            height: 16px;
            color: #6a6a6a;
        }

        .form-input-wrapper {
            position: relative;
        }

        .form-input {
            padding: 16px 48px 16px 16px;
            background: #050505;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            color: #e5e5e5;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
            width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: #4a4a4a;
            background: #0a0a0a;
            box-shadow: 0 0 0 3px rgba(74, 74, 74, 0.1);
        }

        .form-input::placeholder {
            color: #555555;
        }

        .input-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: #6a6a6a;
            pointer-events: none;
        }

        .form-input:focus + .input-icon {
            color: #8a8a8a;
        }

        .login-btn {
            padding: 18px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border: 1px solid #4a4a4a;
            border-radius: 8px;
            color: #e5e5e5;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 8px;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .login-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .login-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #222222 0%, #1a1a1a 100%);
            border-color: #6a6a6a;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .login-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .login-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Discord Login Button */
        .discord-login-btn {
            width: 100%;
            padding: 18px;
            background: #5865F2;
            border: 1px solid #4752C4;
            border-radius: 8px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 8px;
        }

        .discord-login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .discord-login-btn:hover::before {
            left: 100%;
        }

        .discord-login-btn:hover:not(:disabled) {
            background: #4752C4;
            border-color: #3C45A5;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(88, 101, 242, 0.4);
        }

        .discord-login-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .discord-login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .discord-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .discord-login-btn.loading {
            color: transparent;
        }

        .discord-login-btn.loading .discord-icon {
            opacity: 0;
        }


        .btn-icon {
            width: 18px;
            height: 18px;
            transition: transform 0.3s ease;
        }

        .login-btn:hover:not(:disabled) .btn-icon {
            transform: translateX(2px);
        }

        .login-footer {
            padding: 24px 48px 32px;
            text-align: center;
            border-top: 1px solid rgba(42, 42, 42, 0.5);
            background: rgba(5, 5, 5, 0.3);
        }

        .login-footer-text {
            font-size: 12px;
            color: #666666;
            margin-bottom: 12px;
        }

        .login-footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .login-footer-link {
            color: #888888;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s ease;
            position: relative;
        }

        .login-footer-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background: #6a6a6a;
            transition: width 0.3s ease;
        }

        .login-footer-link:hover {
            color: #e5e5e5;
        }

        .login-footer-link:hover::after {
            width: 100%;
        }

        /* Login Reviews Section */
        .login-reviews {
            padding: 24px 48px;
            border-top: 1px solid rgba(42, 42, 42, 0.5);
            border-bottom: 1px solid rgba(42, 42, 42, 0.5);
            background: rgba(5, 5, 5, 0.3);
            max-height: 200px;
            overflow-y: auto;
        }

        .login-reviews-title {
            font-size: 14px;
            font-weight: 600;
            color: #c0c0c0;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .login-reviews-title svg {
            width: 16px;
            height: 16px;
            color: #6a6a6a;
        }

        .login-reviews-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .login-review-item {
            padding: 12px;
            background: rgba(10, 10, 10, 0.5);
            border: 1px solid rgba(42, 42, 42, 0.5);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .login-review-item:hover {
            border-color: rgba(74, 74, 74, 0.7);
            background: rgba(15, 15, 15, 0.5);
        }

        .login-review-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .login-review-stars {
            color: #ffd700;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .login-review-text {
            font-size: 12px;
            color: #a0a0a0;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .login-reviews-empty {
            text-align: center;
            padding: 20px;
            color: #666666;
            font-size: 12px;
        }

        .login-reviews::-webkit-scrollbar {
            width: 6px;
        }

        .login-reviews::-webkit-scrollbar-track {
            background: rgba(10, 10, 10, 0.5);
            border-radius: 3px;
        }

        .login-reviews::-webkit-scrollbar-thumb {
            background: rgba(74, 74, 74, 0.5);
            border-radius: 3px;
        }

        .login-reviews::-webkit-scrollbar-thumb:hover {
            background: rgba(106, 106, 106, 0.7);
        }

        .error-message {
            padding: 14px 16px;
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 8px;
            color: #ff6b6b;
            font-size: 14px;
            text-align: left;
            display: none;
            position: relative;
            padding-left: 44px;
            line-height: 1.5;
        }

        .error-message::before {
            content: '⚠';
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }

        .error-message.show {
            display: block;
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #4a4a4a;
            border-top-color: #e5e5e5;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }

        .login-btn.loading .loading-spinner {
            display: block;
        }

        .login-btn.loading {
            color: transparent;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }


        /* Responsive */
        @media (max-width: 768px) {
            .hero {
                min-height: 80vh;
                padding: 60px 24px;
            }

            .features, .requirements, .installer-info, .changelog, .rating-section {
                padding: 80px 24px;
            }

            .rating-container {
                padding: 32px 24px;
            }

            .rating-stars-display {
                font-size: 36px;
            }

            .star-rating {
                font-size: 32px;
            }

            .features-grid, .requirements-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .info-card {
                padding: 32px 24px;
            }

            .stats-bar {
                gap: 32px;
            }

            .footer-links {
                flex-direction: column;
                gap: 20px;
            }

            .login-modal {
                max-width: 95%;
            }

            .login-header {
                padding: 32px 24px 24px;
            }

            .login-icon {
                width: 56px;
                height: 56px;
                font-size: 28px;
            }

            .login-icon svg {
                width: 32px;
                height: 32px;
            }

            .login-title {
                font-size: 26px;
            }

            .login-subtitle {
                font-size: 14px;
            }

            .login-body {
                padding: 24px 24px 32px;
            }

            .login-info {
                padding: 14px;
            }

            .login-info-text {
                font-size: 12px;
            }

            .login-footer {
                padding: 20px 24px 24px;
            }

            .login-footer-links {
                gap: 16px;
            }

            .login-reviews {
                padding: 20px 24px;
                max-height: 180px;
            }

            .login-reviews-title {
                font-size: 13px;
            }

            .login-review-item {
                padding: 10px;
            }

            .login-review-text {
                font-size: 11px;
            }

            .landing-hero {
                padding: 60px 24px;
            }

            .landing-title {
                font-size: 42px;
            }

            .landing-subtitle {
                font-size: 18px;
            }

            .landing-features {
                grid-template-columns: 1fr;
                gap: 16px;
                margin-bottom: 32px;
            }

            .landing-feature {
                padding: 20px;
            }

            .landing-btn {
                padding: 16px 40px;
                font-size: 15px;
            }

            /* Responsive: Announcements */
            .announcement-banner {
                padding: 10px 16px;
                flex-wrap: wrap;
            }

            .announcement-content {
                flex: 1 1 100%;
                margin-bottom: 8px;
            }

            .announcement-close {
                position: absolute;
                top: 8px;
                right: 8px;
            }

            .announcement-title {
                font-size: 13px;
            }

            .announcement-message {
                font-size: 12px;
            }

            /* Responsive: Language Switcher */
            .language-switcher {
                top: 10px;
                right: 10px;
            }

            .lang-btn {
                padding: 6px 10px;
                font-size: 12px;
            }

            .lang-btn svg {
                width: 16px;
                height: 16px;
            }

            .lang-dropdown {
                min-width: 130px;
            }

            /* Responsive: User Profile */
            .user-profile-container {
                top: 60px;
                right: 10px;
            }

            .user-profile-btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .user-profile-avatar {
                width: 24px;
                height: 24px;
            }

            .user-profile-name {
                max-width: 100px;
            }

            .lang-option {
                padding: 8px 10px;
                font-size: 13px;
            }

            /* Responsive: Admin Login */
            .admin-login-btn-container {
                top: 10px;
                left: 10px;
            }

            .admin-login-btn {
                padding: 6px 10px;
                font-size: 12px;
            }

            .admin-login-btn svg {
                width: 16px;
                height: 16px;
            }

            /* Adjust main content margin when announcement is visible on mobile */
            body:has(.announcement-banner[style*="display: flex"]) .main-content {
                margin-top: 80px;
            }
        }

        /* Admin Modal */
        .admin-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .admin-modal {
            background: #1a1a1a;
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .admin-modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(74, 74, 74, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-modal-header h2 {
            color: #e5e5e5;
            font-size: 20px;
            margin: 0;
        }

        .admin-modal-close {
            background: transparent;
            border: none;
            color: #888888;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .admin-modal-close:hover {
            color: #e5e5e5;
        }

        .admin-modal-body {
            padding: 20px;
        }

        .admin-form-group {
            margin-bottom: 24px;
        }

        .admin-form-group label {
            display: block;
            color: #e5e5e5;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .admin-form-input {
            width: 100%;
            padding: 14px 18px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(74, 74, 74, 0.6);
            border-radius: 10px;
            color: #e5e5e5;
            font-size: 14px;
            transition: all 0.3s;
            box-sizing: border-box;
        }

        .admin-form-input:hover {
            border-color: rgba(59, 130, 246, 0.4);
            background: rgba(0, 0, 0, 0.5);
        }

        .admin-form-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(0, 0, 0, 0.6);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15), 0 0 20px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .admin-error-message {
            color: #ef4444;
            font-size: 13px;
            margin-bottom: 16px;
            display: none;
        }

        .admin-error-message.show {
            display: block;
        }

        .admin-submit-btn {
            flex: 1;
            padding: 14px 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .admin-submit-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .admin-submit-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .admin-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Admin Panel */
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10001;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        .admin-panel-header {
            padding: 20px;
            border-bottom: 1px solid rgba(74, 74, 74, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1a1a1a;
        }

        .admin-panel-header h2 {
            color: #e5e5e5;
            font-size: 24px;
            margin: 0;
        }

        .admin-panel-close {
            background: transparent;
            border: none;
            color: #888888;
            font-size: 32px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .admin-panel-close:hover {
            color: #e5e5e5;
        }

        .admin-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .admin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(74, 74, 74, 0.5);
        }

        .admin-tab {
            background: transparent;
            border: none;
            color: #888888;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .admin-tab:hover {
            color: #e5e5e5;
        }

        .admin-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .admin-tab-content h3 {
            color: #e5e5e5;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .admin-add-btn, .admin-action-btn {
            background: #10b981;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            color: #ffffff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background 0.2s;
        }

        .admin-add-btn:hover, .admin-action-btn:hover {
            background: #059669;
        }

        .admin-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .admin-list-item {
            background: rgba(26, 26, 26, 0.5);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 8px;
            padding: 16px;
        }

        .admin-list-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .admin-list-item-title {
            color: #e5e5e5;
            font-size: 16px;
            font-weight: 600;
        }

        .admin-list-item-actions {
            display: flex;
            gap: 8px;
        }

        .admin-btn-small {
            background: rgba(74, 74, 74, 0.5);
            border: 1px solid rgba(106, 106, 106, 0.5);
            border-radius: 6px;
            padding: 6px 12px;
            color: #e5e5e5;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .admin-btn-small:hover {
            background: rgba(106, 106, 106, 0.7);
        }

        .admin-btn-small.delete {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }

        .admin-btn-small.delete:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .admin-status {
            background: rgba(26, 26, 26, 0.5);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 8px;
            padding: 16px;
            color: #e5e5e5;
            font-size: 14px;
            margin-top: 16px;
        }

        .admin-status.success {
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.1);
        }

        .admin-status.error {
            border-color: rgba(239, 68, 68, 0.5);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Admin Editor Modal */
        .admin-editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10002;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(20px);
            overflow-y: auto;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .admin-editor-content {
            background: linear-gradient(145deg, #1a1a1a 0%, #252525 50%, #1a1a1a 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(59, 130, 246, 0.1);
            animation: slideUp 0.3s ease;
            overflow: hidden;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .admin-editor-header {
            padding: 24px 28px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
        }

        .admin-editor-header h2 {
            color: #e5e5e5;
            font-size: 22px;
            margin: 0;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #a0a0a0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-editor-close {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            line-height: 1;
        }

        .admin-editor-close:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
            transform: scale(1.05);
        }

        .admin-editor-body {
            padding: 28px;
            overflow-y: auto;
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
        }

        .admin-editor-body::-webkit-scrollbar {
            width: 8px;
        }

        .admin-editor-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .admin-editor-body::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.3);
            border-radius: 4px;
        }

        .admin-editor-body::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.5);
        }

        .admin-editor-body textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .admin-editor-body select {
            cursor: pointer;
        }

        .admin-editor-body label input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .admin-editor-error {
            color: #ef4444;
            font-size: 13px;
            margin-bottom: 16px;
            display: none;
        }

        .admin-editor-error.show {
            display: block;
        }

        .admin-editor-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .admin-cancel-btn {
            flex: 1;
            padding: 14px 20px;
            background: rgba(74, 74, 74, 0.3);
            border: 1px solid rgba(106, 106, 106, 0.4);
            border-radius: 10px;
            color: #e5e5e5;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .admin-cancel-btn:hover {
            background: rgba(106, 106, 106, 0.5);
            border-color: rgba(106, 106, 106, 0.6);
            transform: translateY(-1px);
        }

        .admin-submit-btn {
            flex: 1;
        }

        /* Changelog Changes List */
        .changelog-change-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(26, 26, 26, 0.5);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .changelog-change-item-text {
            flex: 1;
            color: #e5e5e5;
            font-size: 14px;
        }

        .changelog-change-item-remove {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            border-radius: 4px;
            padding: 4px 8px;
            color: #ef4444;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .changelog-change-item-remove:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Advanced Admin Features */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .admin-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.2);
        }

        .admin-stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .admin-stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 5px;
        }

        .admin-stat-label {
            font-size: 13px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-activity-log {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .admin-activity-item {
            padding: 12px;
            border-bottom: 1px solid rgba(74, 74, 74, 0.3);
            color: #e5e5e5;
            font-size: 13px;
        }

        .admin-activity-item:last-child {
            border-bottom: none;
        }

        .admin-activity-time {
            color: #888;
            font-size: 11px;
            margin-top: 4px;
        }

        .admin-tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .admin-tool-btn {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8) 0%, rgba(37, 37, 37, 0.8) 100%);
            border: 1px solid rgba(74, 74, 74, 0.5);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .admin-tool-btn:hover {
            transform: translateY(-3px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .admin-tool-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .admin-tool-title {
            font-size: 16px;
            font-weight: 600;
            color: #e5e5e5;
            margin-bottom: 6px;
        }

        .admin-tool-desc {
            font-size: 13px;
            color: #888;
        }
    </style>
</head>
<body>
    <!-- Announcements Banner -->
    <div class="announcement-banner" id="announcementBanner" style="display: none;">
        <div class="announcement-content">
            <div class="announcement-icon" id="announcementIcon"></div>
            <div class="announcement-text">
                <strong class="announcement-title" id="announcementTitle"></strong>
                <span class="announcement-message" id="announcementMessage"></span>
                </div>
            <a href="#" class="announcement-link" id="announcementLink" style="display: none;"></a>
        </div>
        <button class="announcement-close" id="announcementClose" aria-label="Close announcement">×</button>
    </div>

    <!-- Admin Login Button -->
    <div class="admin-login-btn-container" id="adminLoginContainer">
        <button class="admin-login-btn" id="adminLoginBtn" aria-label="Admin Login">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                <path d="M9 12l2 2 4-4"></path>
            </svg>
            <span>Admin</span>
                </button>
        </div>

    <!-- User Profile Button -->
    <div class="user-profile-container" id="userProfileContainer" style="display: none;">
        <div style="position: relative;">
            <button class="user-profile-btn" id="userProfileBtn" onclick="showEditProfileModal()">
                <img class="user-profile-avatar" id="userProfileAvatar" src="" alt="Profile" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2232%22 height=%2232%22%3E%3Ccircle cx=%2216%22 cy=%2216%22 r=%2216%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2216%22 y=%2220%22 font-size=%2214%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E?%3C/text%3E%3C/svg%3E'">
                <span class="user-profile-name" id="userProfileName">Profile</span>
            </button>
            <button onclick="logoutProfile()" style="position: absolute; top: -8px; right: -8px; width: 20px; height: 20px; background: rgba(239, 68, 68, 0.9); border: none; border-radius: 50%; color: white; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; z-index: 1001;" title="Logout">×</button>
        </div>
    </div>

    <!-- Language Switcher -->
    <div class="language-switcher" id="languageSwitcher">
        <button class="lang-btn" id="langBtn" aria-label="Change language">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </svg>
            <span id="currentLang">EN</span>
        </button>
        <div class="lang-dropdown" id="langDropdown">
            <button class="lang-option" data-lang="en">English</button>
            <button class="lang-option" data-lang="es">Español</button>
            <button class="lang-option" data-lang="fr">Français</button>
            <button class="lang-option" data-lang="de">Deutsch</button>
            <button class="lang-option" data-lang="pt">Português</button>
        </div>
    </div>

    <!-- Cloudflare Turnstile Container (Invisible) -->
    <div id="cloudflare-turnstile-container" style="display: none;"></div>

    <!-- Profile Signup/Login Modal -->
    <div class="profile-modal-overlay" id="profileModalOverlay">
        <div class="profile-modal">
            <div class="profile-modal-header">
                <h2 id="profileModalTitle">Sign Up / Login</h2>
                <button class="profile-modal-close" id="profileModalCloseBtn" onclick="hideProfileModal()">×</button>
            </div>
            <div class="profile-modal-body">
                <div class="profile-error-message" id="profileErrorMessage"></div>
                
                <!-- Tab Switcher (only shown for signup/login) -->
                <div id="profileTabSwitcher" style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 1px solid #2a2a2a;">
                    <button class="profile-tab-btn active" id="profileSignupTab" onclick="switchProfileTab('signup')">Sign Up</button>
                    <button class="profile-tab-btn" id="profileLoginTab" onclick="switchProfileTab('login')">Login</button>
                </div>

                <!-- Signup Form -->
                <div id="profileSignupForm">
                    <div class="profile-avatar-preview">
                        <img class="profile-avatar-large" id="profileAvatarPreview" src="data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Ccircle cx=%2260%22 cy=%2260%22 r=%2260%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2260%22 y=%2275%22 font-size=%2240%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E?%3C/text%3E%3C/svg%3E" alt="Profile Picture">
                        <label for="profileAvatarInput" class="profile-avatar-upload-btn">Upload Profile Picture</label>
                        <input type="file" id="profileAvatarInput" accept="image/*" style="display: none;" onchange="handleProfileAvatarUpload(event)">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label" for="profileUsernameInput">Username *</label>
                        <input type="text" id="profileUsernameInput" class="profile-form-input" placeholder="Enter your username" maxlength="30" required>
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label" for="profilePasswordInput">Password *</label>
                        <input type="password" id="profilePasswordInput" class="profile-form-input" placeholder="Enter your password" minlength="6" required>
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label" for="profileBioInput">Bio (Optional)</label>
                        <textarea id="profileBioInput" class="profile-form-input profile-form-textarea" placeholder="Tell us about yourself..." maxlength="200"></textarea>
                    </div>
                    <button class="profile-submit-btn" id="profileSubmitBtn" onclick="signupProfile()">Sign Up</button>
                </div>

                <!-- Login Form -->
                <div id="profileLoginForm" style="display: none;">
                    <div class="profile-form-group">
                        <label class="profile-form-label" for="loginUsernameInput">Username *</label>
                        <input type="text" id="loginUsernameInput" class="profile-form-input" placeholder="Enter your username" maxlength="30" required onkeypress="if(event.key === 'Enter') loginProfile()">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label" for="loginPasswordInput">Password *</label>
                        <input type="password" id="loginPasswordInput" class="profile-form-input" placeholder="Enter your password" required onkeypress="if(event.key === 'Enter') loginProfile()">
                    </div>
                    <button class="profile-submit-btn" id="profileLoginBtn" onclick="loginProfile()">Login</button>
                </div>

                <!-- Edit Profile Form (for logged-in users) -->
                <div id="profileEditForm" style="display: none;">
                    <div class="profile-avatar-preview">
                        <img class="profile-avatar-large" id="editAvatarPreview" src="data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Ccircle cx=%2260%22 cy=%2260%22 r=%2260%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2260%22 y=%2275%22 font-size=%2240%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E?%3C/text%3E%3C/svg%3E" alt="Profile Picture">
                        <label for="editAvatarInput" class="profile-avatar-upload-btn">Upload Profile Picture</label>
                        <input type="file" id="editAvatarInput" accept="image/*" style="display: none;" onchange="handleEditAvatarUpload(event)">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label" for="editUsernameInput">Username *</label>
                        <input type="text" id="editUsernameInput" class="profile-form-input" placeholder="Enter your username" maxlength="30" required>
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label" for="editBioInput">Bio (Optional)</label>
                        <textarea id="editBioInput" class="profile-form-input profile-form-textarea" placeholder="Tell us about yourself..." maxlength="200"></textarea>
                    </div>
                    <button class="profile-submit-btn" id="profileEditBtn" onclick="updateProfile()">Save Changes</button>
                    <button class="profile-logout-btn" id="profileLogoutBtn" onclick="logoutProfile()" style="margin-top: 12px; width: 100%; padding: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; color: #ef4444; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-family: inherit;">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="admin-modal-overlay" id="adminModalOverlay" style="display: none;">
        <div class="admin-modal">
            <div class="admin-modal-header">
                <h2>Admin Login</h2>
                <button class="admin-modal-close" id="adminModalClose">×</button>
            </div>
            <div class="admin-modal-body">
                <div class="admin-form-group">
                    <p style="color: #888; font-size: 14px; margin-bottom: 16px;">Admin access is restricted to authorized IP addresses only.</p>
                </div>
                <div class="admin-error-message" id="adminErrorMessage"></div>
                <button class="admin-submit-btn" id="adminSubmitBtn">Login</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel" style="display: none;">
        <div class="admin-panel-header">
            <h2>Admin Panel</h2>
            <button class="admin-panel-close" id="adminPanelClose">×</button>
        </div>
        <div class="admin-panel-content">
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="announcements">📢 Announcements</button>
                <button class="admin-tab" data-tab="changelog">📝 Changelog</button>
                <button class="admin-tab" data-tab="analytics">📊 Analytics</button>
                <button class="admin-tab" data-tab="tools">🛠️ Tools</button>
                <button class="admin-tab" data-tab="database">💾 Database</button>
            </div>

            <!-- Announcements Tab -->
            <div class="admin-tab-content active" id="tabAnnouncements">
                <h3>Manage Announcements</h3>
                <button class="admin-add-btn" id="addAnnouncementBtn">+ Add Announcement</button>
                <div class="admin-list" id="announcementsList"></div>
            </div>

            <!-- Changelog Tab -->
            <div class="admin-tab-content" id="tabChangelog">
                <h3>Manage Changelog</h3>
                <button class="admin-add-btn" id="addChangelogBtn">+ Add Changelog Entry</button>
                <div class="admin-list" id="changelogList"></div>
            </div>

            <!-- Database Tab -->
            <div class="admin-tab-content" id="tabDatabase">
                <h3>Database Management</h3>
                <button class="admin-action-btn" id="initPathsBtn">Initialize Database Paths</button>
                <div class="admin-status" id="databaseStatus"></div>
            </div>

            <!-- Analytics Tab -->
            <div class="admin-tab-content" id="tabAnalytics">
                <h3>Analytics Dashboard</h3>
                <div class="admin-stats-grid">
                    <div class="admin-stat-card">
                        <div class="admin-stat-icon">📥</div>
                        <div class="admin-stat-value" id="statDownloads">0</div>
                        <div class="admin-stat-label">Total Downloads</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-icon">⭐</div>
                        <div class="admin-stat-value" id="statRatings">0</div>
                        <div class="admin-stat-label">Total Ratings</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-icon">📢</div>
                        <div class="admin-stat-value" id="statAnnouncements">0</div>
                        <div class="admin-stat-label">Active Announcements</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-icon">📝</div>
                        <div class="admin-stat-value" id="statChangelogs">0</div>
                        <div class="admin-stat-label">Changelog Entries</div>
                    </div>
                </div>
                <div class="admin-chart-container">
                    <h4 style="color: #e5e5e5; margin-top: 30px; margin-bottom: 15px;">Recent Activity</h4>
                    <div class="admin-activity-log" id="activityLog"></div>
                </div>
            </div>

            <!-- Tools Tab -->
            <div class="admin-tab-content" id="tabTools">
                <h3>Quick Tools</h3>
                <div class="admin-tools-grid">
                    <button class="admin-tool-btn" onclick="exportData()">
                        <div class="admin-tool-icon">💾</div>
                        <div class="admin-tool-title">Export Data</div>
                        <div class="admin-tool-desc">Download all data as JSON</div>
                    </button>
                    <button class="admin-tool-btn" onclick="importData()">
                        <div class="admin-tool-icon">📤</div>
                        <div class="admin-tool-title">Import Data</div>
                        <div class="admin-tool-desc">Upload JSON file to restore</div>
                    </button>
                    <button class="admin-tool-btn" onclick="clearDismissedAnnouncements()">
                        <div class="admin-tool-icon">🔄</div>
                        <div class="admin-tool-title">Reset Dismissals</div>
                        <div class="admin-tool-desc">Clear all dismissed announcements</div>
                    </button>
                    <button class="admin-tool-btn" onclick="bulkDeleteAnnouncements()">
                        <div class="admin-tool-icon">🗑️</div>
                        <div class="admin-tool-title">Bulk Delete</div>
                        <div class="admin-tool-desc">Delete multiple announcements</div>
                    </button>
                    <button class="admin-tool-btn" onclick="searchAndFilter()">
                        <div class="admin-tool-icon">🔍</div>
                        <div class="admin-tool-title">Search & Filter</div>
                        <div class="admin-tool-desc">Advanced search options</div>
                    </button>
                    <button class="admin-tool-btn" onclick="systemHealthCheck()">
                        <div class="admin-tool-icon">🏥</div>
                        <div class="admin-tool-title">System Health</div>
                        <div class="admin-tool-desc">Check system status</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Announcement Editor Modal -->
    <div class="admin-editor-modal" id="announcementEditorModal" style="display: none;">
        <div class="admin-editor-content">
            <div class="admin-editor-header">
                <h2 id="announcementEditorTitle">Add Announcement</h2>
                <button class="admin-editor-close" id="announcementEditorClose">×</button>
            </div>
            <div class="admin-editor-body">
                <div class="admin-form-group">
                    <label for="announcementTitleInput">Title *</label>
                    <input type="text" id="announcementTitleInput" class="admin-form-input" placeholder="New Update Available!" maxlength="100">
                </div>
                <div class="admin-form-group">
                    <label for="announcementMessageInput">Message *</label>
                    <textarea id="announcementMessageInput" class="admin-form-input" rows="4" placeholder="Version 1.2.0 is now live with exciting new features." maxlength="500"></textarea>
                </div>
                <div class="admin-form-group">
                    <label for="announcementTypeInput">Type *</label>
                    <select id="announcementTypeInput" class="admin-form-input">
                        <option value="info">Info (Blue)</option>
                        <option value="success">Success (Green)</option>
                        <option value="warning">Warning (Orange)</option>
                        <option value="error">Error (Red)</option>
                    </select>
                </div>
                <div class="admin-form-group">
                    <label for="announcementPriorityInput">Priority *</label>
                    <select id="announcementPriorityInput" class="admin-form-input">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="admin-form-group">
                    <label for="announcementEndDateInput">End Date (Optional)</label>
                    <input type="datetime-local" id="announcementEndDateInput" class="admin-form-input">
                    <div style="font-size: 12px; color: #888; margin-top: 4px;">Leave empty to show indefinitely</div>
                </div>
                <div class="admin-form-group">
                    <label>
                        <input type="checkbox" id="announcementDismissibleInput" checked> Dismissible (users can close)
                    </label>
                </div>
                <div class="admin-form-group">
                    <label for="announcementLinkInput">Link URL (Optional)</label>
                    <input type="url" id="announcementLinkInput" class="admin-form-input" placeholder="https://...">
                </div>
                <div class="admin-form-group">
                    <label for="announcementLinkTextInput">Link Text (Optional)</label>
                    <input type="text" id="announcementLinkTextInput" class="admin-form-input" placeholder="Learn More">
                </div>
                <div class="admin-editor-error" id="announcementEditorError"></div>
                <div class="admin-editor-actions">
                    <button class="admin-submit-btn" id="announcementSaveBtn">Save Announcement</button>
                    <button class="admin-cancel-btn" id="announcementCancelBtn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Changelog Editor Modal -->
    <div class="admin-editor-modal" id="changelogEditorModal" style="display: none;">
        <div class="admin-editor-content">
            <div class="admin-editor-header">
                <h2 id="changelogEditorTitle">Add Changelog Entry</h2>
                <button class="admin-editor-close" id="changelogEditorClose">×</button>
            </div>
            <div class="admin-editor-body">
                <div class="admin-form-group">
                    <label for="changelogVersionInput">Version *</label>
                    <input type="text" id="changelogVersionInput" class="admin-form-input" placeholder="1.2.0" maxlength="20">
                </div>
                <div class="admin-form-group">
                    <label for="changelogDateInput">Release Date *</label>
                    <input type="date" id="changelogDateInput" class="admin-form-input">
                </div>
                <div class="admin-form-group">
                    <label for="changelogTypeInput">Type (Optional)</label>
                    <select id="changelogTypeInput" class="admin-form-input">
                        <option value="">None</option>
                        <option value="major">Major</option>
                        <option value="minor">Minor</option>
                        <option value="patch">Patch</option>
                    </select>
                </div>
                <div class="admin-form-group">
                    <label for="changelogDownloadUrlInput">Download URL (Optional)</label>
                    <input type="url" id="changelogDownloadUrlInput" class="admin-form-input" placeholder="https://github.com/.../releases/tag/v1.2.0">
                </div>
                <div class="admin-form-group">
                    <label>Changes *</label>
                    <div id="changelogChangesList" style="margin-bottom: 12px;"></div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="changelogChangeInput" class="admin-form-input" placeholder="Added new feature..." style="flex: 1;" maxlength="200">
                        <button type="button" class="admin-btn-small" id="addChangeBtn" style="white-space: nowrap;">+ Add</button>
                    </div>
                    <div style="font-size: 12px; color: #888; margin-top: 4px;">Add each change as a separate item</div>
                </div>
                <div class="admin-editor-error" id="changelogEditorError"></div>
                <div class="admin-editor-actions">
                    <button class="admin-submit-btn" id="changelogSaveBtn">Save Changelog</button>
                    <button class="admin-cancel-btn" id="changelogCancelBtn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        
        <!-- Animated Background Particles -->
        <div class="particles" id="particles"></div>

        <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1 class="brand-title" id="brandTitle" data-i18n="hero.title">RECON-SPOOFER</h1>
            <p class="tagline" data-i18n="hero.tagline">Simple. Secure. Reliable.</p>
            <a href="#" class="download-btn" id="downloadBtn1" onclick="handleDownload(event)">
                <svg class="download-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <span data-i18n="hero.download">Download Installer</span>
            </a>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-number" id="downloadCount" data-count="1">0</span>
                    <span class="stat-label" data-i18n="hero.downloads">Downloads</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" data-count="99">0</span>
                    <span class="stat-label">% Uptime</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="ratingDisplay" data-count="0">0</span>
                    <span class="stat-label" data-i18n="hero.rating">Rating</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Review Stream Ticker -->
    <section class="review-stream-section">
        <div class="review-stream-container">
            <div class="review-stream-track" id="reviewStreamTrack">
                <!-- Reviews will be dynamically added here -->
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2 class="section-title reveal" data-i18n="features.title">Key Features</h2>
            <p class="section-subtitle reveal" data-i18n="features.subtitle">Everything you need in one powerful package</p>
            <div class="features-grid">
                <div class="feature-card reveal">
                    <div class="feature-icon">⚡</div>
                    <h3 class="feature-title">Lightweight Installer</h3>
                    <p class="feature-text">Minimal footprint with fast installation process. Optimized for performance without compromising functionality.</p>
                </div>
                <div class="feature-card reveal">
                    <div class="feature-icon">🚀</div>
                    <h3 class="feature-title">Quick Setup</h3>
                    <p class="feature-text">Get up and running in minutes with intuitive configuration. No technical expertise required.</p>
                </div>
                <div class="feature-card reveal">
                    <div class="feature-icon">🔄</div>
                    <h3 class="feature-title">Automatic Updates</h3>
                    <p class="feature-text">Stay current with seamless background updates. Always have the latest features and security patches.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- System Requirements -->
    <section class="requirements">
        <div class="container">
            <h2 class="section-title reveal">System Requirements</h2>
            <p class="section-subtitle reveal">Windows operating system required</p>
            <div class="requirements-grid">
                <div class="req-card reveal">
                    <h3 class="req-title">Windows</h3>
                    <ul class="req-list">
                        <li>Windows 10 (22H2 or later)</li>
                        <li>Windows 11 (22H2 or later)</li>
                        <li>Windows 11 (24H2 or later)</li>
                        <li>64-bit processor</li>
                        <li>Administrator privileges</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Installer Info Panel -->
    <section class="installer-info">
        <div class="container">
            <div class="info-card reveal">
                <h2 class="info-title">Installer Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Version</span>
                        <span class="info-value">1.7</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">File Size</span>
                        <span class="info-value">1.19 MB</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Format</span>
                        <span class="info-value">.exe</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Changelog Section -->
    <section class="changelog">
        <div class="container">
            <h2 class="section-title reveal" data-i18n="changelog.title">What's New</h2>
            <p class="section-subtitle reveal" data-i18n="changelog.subtitle">Latest updates and improvements</p>
            <div class="changelog-content reveal" id="changelogContent">
                <div class="changelog-loading" data-i18n="changelog.loading">Loading changelog...</div>
                </div>
        </div>
    </section>

    <!-- Surveys Section -->
    <section class="surveys" id="surveys" style="display: none;">
        <div class="container">
            <h2 class="section-title reveal">Surveys & Polls</h2>
            <p class="section-subtitle reveal">Share your feedback with us</p>
            <div class="surveys-content reveal" id="surveysContent">
                <div class="changelog-loading">Loading surveys...</div>
            </div>
        </div>
    </section>

    <!-- Support Tickets Section -->
    <section class="support-section" id="support">
        <div class="container">
            <h2 class="section-title reveal">Support Tickets</h2>
            <p class="section-subtitle reveal">Need help? Create a support ticket and we'll get back to you</p>
            <div class="support-content reveal">
                <div style="text-align: center; margin-bottom: 40px;">
                    <button class="ticket-create-btn" onclick="openTicketModal()">
                        <svg class="download-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 4v16m8-8H4"></path>
                        </svg>
                        Create Support Ticket
                    </button>
                </div>
                <div id="userTicketsContent">
                    <div class="changelog-loading">Loading your tickets...</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Second Download Section -->
    <section class="download-section" id="download">
        <div class="container">
            <h2 class="section-title reveal" style="margin-bottom: 32px;">Ready to Get Started?</h2>
            <p class="section-subtitle reveal" style="margin-bottom: 48px;">Download now and experience the difference</p>
            <a href="#" class="download-btn" id="downloadBtn2" onclick="handleDownload(event)">
                <svg class="download-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download Installer
            </a>
        </div>
    </section>

    <!-- Ticket Creation Modal -->
    <div class="ticket-modal" id="ticketCreationModal">
        <div class="ticket-modal-content">
            <div class="ticket-modal-header">
                <h3>Create Support Ticket</h3>
                <button onclick="closeTicketModal()">×</button>
            </div>
            <div class="ticket-modal-body">
                <div class="ticket-form-group">
                    <label class="ticket-form-label">Subject *</label>
                    <input type="text" id="ticketSubjectInput" class="ticket-input" placeholder="What do you need help with?" maxlength="200">
                </div>
                <div class="ticket-form-group">
                    <label class="ticket-form-label">Message *</label>
                    <textarea id="ticketMessageInput" class="ticket-textarea" rows="6" placeholder="Describe your issue in detail..." maxlength="2000"></textarea>
                </div>
                <div class="ticket-form-group">
                    <label class="ticket-form-label">Attachments</label>
                    <div class="ticket-image-preview" id="ticketImagePreview"></div>
                    <div style="display: flex; gap: 8px;">
                        <input type="file" id="ticketImageInput" accept="image/*" multiple>
                        <button class="ticket-attach-btn" onclick="document.getElementById('ticketImageInput').click()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Images
                        </button>
                        <button class="ticket-voice-btn" id="ticketVoiceRecordBtn" onmousedown="TicketSystem.startRecording('creation')" onmouseup="TicketSystem.stopRecording('creation')" ontouchstart="event.preventDefault(); TicketSystem.startRecording('creation')" ontouchend="event.preventDefault(); TicketSystem.stopRecording('creation')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>
                            <span id="ticketVoiceRecordText">Hold to Record</span>
                        </button>
                    </div>
                </div>
                <div id="ticketError" class="ticket-error"></div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button class="ticket-send-btn" onclick="createTicket()" style="flex: 1;">Create Ticket</button>
                    <button class="ticket-send-btn ticket-btn-secondary" onclick="closeTicketModal()" style="flex: 1;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ticket View Modal -->
    <div class="ticket-modal" id="ticketViewModal">
        <div class="ticket-modal-content" style="max-width: 800px;">
            <div class="ticket-modal-header">
                <div>
                    <h3 id="ticketViewTitle" style="margin: 0 0 4px 0;">Ticket</h3>
                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-top: 4px;" id="ticketViewId"></div>
                </div>
                <button onclick="closeTicketViewModal()">×</button>
            </div>
            <div class="ticket-modal-body">
                <div class="ticket-messages" id="ticketMessagesContainer">
                    <div style="color: #888; text-align: center; padding: 40px;">Loading messages...</div>
                </div>
                <div class="ticket-form-group" style="margin-bottom: 0;">
                    <div class="ticket-image-preview" id="ticketReplyImagePreview"></div>
                    <div class="ticket-input-area">
                        <input type="text" id="ticketReplyInput" class="ticket-input" placeholder="Type your message..." maxlength="1000" style="flex: 1;" onkeypress="if(event.key === 'Enter') sendTicketMessage()">
                        <input type="file" id="ticketReplyImageInput" accept="image/*" multiple style="display: none;">
                        <button class="ticket-attach-btn" onclick="document.getElementById('ticketReplyImageInput').click()" title="Attach Images">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </button>
                        <button class="ticket-voice-btn" id="ticketReplyVoiceBtn" onmousedown="TicketSystem.startRecording('reply')" onmouseup="TicketSystem.stopRecording('reply')" ontouchstart="event.preventDefault(); TicketSystem.startRecording('reply')" ontouchend="event.preventDefault(); TicketSystem.stopRecording('reply')" title="Hold to Record">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>
                        </button>
                        <button class="ticket-send-btn" onclick="sendTicketMessage()" id="ticketSendBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rating Section -->
    <section class="rating-section">
        <div class="container">
            <h2 class="section-title reveal">Rate Your Experience</h2>
            <p class="section-subtitle reveal">Help us improve by sharing your feedback</p>
            <div class="rating-container reveal">
                <div class="rating-display">
                    <div class="rating-stars-display" id="ratingStarsDisplay">
                        <span class="star">★</span>
                        <span class="star">★</span>
                        <span class="star">★</span>
                        <span class="star">★</span>
                        <span class="star">★</span>
                    </div>
                    <div class="rating-value" id="ratingValue">0.0</div>
                    <div class="rating-count" id="ratingCount">(0 ratings)</div>
                </div>
                <div class="rating-input">
                    <div class="rating-label">Your Rating:</div>
                    <div class="star-rating" id="starRating">
                        <span class="star-input" data-rating="1">★</span>
                        <span class="star-input" data-rating="2">★</span>
                        <span class="star-input" data-rating="3">★</span>
                        <span class="star-input" data-rating="4">★</span>
                        <span class="star-input" data-rating="5">★</span>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label" for="reviewText">Review (Optional):</label>
                        <textarea 
                            id="reviewText" 
                            class="form-input" 
                            rows="3" 
                            placeholder="Share your experience..."
                            maxlength="200"
                            style="resize: vertical; min-height: 80px;"
                        ></textarea>
                        <div style="font-size: 12px; color: #666; text-align: right; margin-top: 4px;">
                            <span id="reviewCharCount">0</span>/200
                        </div>
                    </div>
                    <button class="rating-submit-btn" id="ratingSubmitBtn" disabled>Submit Rating</button>
                    <div class="rating-message" id="ratingMessage"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="https://discord.gg/getrecon" target="_blank" class="footer-link">Support</a>
                <a href="/documentation" class="footer-link">Documentation</a>
                <a href="/terms" class="footer-link">Terms</a>
                <a href="/privacy" class="footer-link">Privacy</a>
                <a href="#" class="footer-link">GitHub</a>
            </div>
            <p class="footer-text">© 2024 Recon-Spoofer. All rights reserved.</p>
        </div>
    </footer>
    </div> <!-- End main-content -->

    <script>
        // ============================================
        // CLOUDFLARE TURNSTILE (DDoS Protection)
        // ============================================
        // Replace 'YOUR_SITE_KEY' with your actual Cloudflare Turnstile site key
        // Get it from: https://dash.cloudflare.com/ → Turnstile → Add Site
        const CLOUDFLARE_TURNSTILE_SITE_KEY = 'YOUR_SITE_KEY';
        
        let turnstileToken = null;
        let turnstileWidgetId = null;
        
        function initCloudflareTurnstile() {
            if (typeof turnstile === 'undefined' || !CLOUDFLARE_TURNSTILE_SITE_KEY || CLOUDFLARE_TURNSTILE_SITE_KEY === 'YOUR_SITE_KEY') {
                console.warn('Cloudflare Turnstile not configured. Please add your site key. See CLOUDFLARE_DDOS_SETUP.md for instructions.');
                return;
            }
            
            const container = document.getElementById('cloudflare-turnstile-container');
            if (!container) {
                console.warn('Cloudflare Turnstile container not found');
                    return;
                }

            try {
                turnstileWidgetId = turnstile.render(container, {
                    sitekey: CLOUDFLARE_TURNSTILE_SITE_KEY,
                    theme: 'dark',
                    size: 'invisible', // Invisible mode - runs in background for DDoS protection
                    callback: function(token) {
                        turnstileToken = token;
                        console.log('Cloudflare Turnstile verified successfully');
                        // Token is automatically refreshed by Turnstile
                    },
                    'error-callback': function() {
                        console.error('Cloudflare Turnstile verification failed');
                        turnstileToken = null;
                    },
                    'expired-callback': function() {
                        console.warn('Cloudflare Turnstile token expired, refreshing...');
                        turnstileToken = null;
                        if (turnstileWidgetId) {
                            turnstile.reset(turnstileWidgetId);
                            turnstile.execute(turnstileWidgetId);
                        }
                    }
                });
                
                // Execute Turnstile immediately for protection
                turnstile.execute(turnstileWidgetId);
                } catch (error) {
                console.error('Error initializing Cloudflare Turnstile:', error);
            }
        }
        
        function refreshTurnstileToken() {
            if (turnstileWidgetId && typeof turnstile !== 'undefined') {
                try {
                    turnstile.reset(turnstileWidgetId);
                    turnstile.execute(turnstileWidgetId);
                } catch (error) {
                    console.error('Error refreshing Turnstile token:', error);
                }
            }
        }
        
        // Initialize Cloudflare Turnstile when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                // Wait a bit for Turnstile script to load
                setTimeout(initCloudflareTurnstile, 500);
            });
                    } else {
            setTimeout(initCloudflareTurnstile, 500);
        }
        
        // Refresh Turnstile token every 5 minutes
        setInterval(refreshTurnstileToken, 5 * 60 * 1000);

        document.addEventListener('DOMContentLoaded', () => {
            // Check rate limit on page load
            checkRateLimitOnLoad();
            
            // Initialize particles
            if (document.getElementById('particles')) {
                createParticles();
            }
            
            // Load review stream
            setTimeout(() => {
                loadReviewBubbles();
            }, 1000);

            // Initialize new features
            initLanguageSystem(); // FEATURE #18: Multi-Language Support
            loadAnnouncements(); // FEATURE #2: Dynamic Announcements
            setupAnnouncementListener(); // Listen for announcement updates
            loadChangelog(); // FEATURE #5: Dynamic Changelog
            setupChangelogListener(); // Listen for changelog updates
            setupSurveysListener(); // Listen for survey updates
        });

        // Original page scripts
        // Create animated particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Scroll reveal animation
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, observerOptions);

        // Observe all reveal elements
        document.querySelectorAll('.reveal').forEach(el => {
            observer.observe(el);
        });

        // ============================================
        // FIREBASE CONFIGURATION - REQUIRED FOR GLOBAL DOWNLOAD TRACKING
        // ============================================
        // SECURITY NOTE: Firebase API keys are PUBLIC by design and safe to expose.
        // They identify your project but don't grant access by themselves.
        // Real security comes from Firebase Security Rules (see FIREBASE_SETUP.md).
        // Anyone can see these keys in your code - this is NORMAL and EXPECTED.
        // 
        // To set up Firebase:
        // 1. Go to https://console.firebase.google.com/
        // 2. Create a new project or select existing
        // 3. Enable Realtime Database
        // 4. Set up Security Rules (IMPORTANT - see FIREBASE_SETUP.md)
        // 5. Get your config from: Project Settings > General > Your apps
        // 6. Replace the values below with your actual Firebase config
        // 
        // See FIREBASE_SETUP.md for detailed instructions and security setup
        // ============================================
        const firebaseConfig = {
          apiKey: "AIzaSyC6CrMVEbsr-AADq-w-TOkzO0AAOZtUqmU",
          authDomain: "recon-265bc.firebaseapp.com",
          databaseURL: "https://recon-265bc-default-rtdb.firebaseio.com",
          projectId: "recon-265bc",
          storageBucket: "recon-265bc.firebasestorage.app",
          messagingSenderId: "99005456592",
          appId: "1:99005456592:web:9ca83e210d9e85ca8a3ed5"
        };

        // Initialize Firebase
        let database = null;
        let firebaseInitialized = false;
        
        // User Profile System Variables (declared early for access)
        let currentUserProfile = null;
        let userProfileId = null;
        let isFirstTimeProfile = false;
        const AUTH_TOKEN_KEY = 'recon_auth_token';
        const USER_PROFILE_ID_KEY = 'recon_user_profile_id';

        try {
            if (typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                firebaseInitialized = true;
                console.log('Firebase initialized successfully');
                
                // Setup real-time listeners for instant updates
                checkBlacklist().then(isBlacklisted => {
                    if (isBlacklisted) {
                        // User is being redirected, don't continue loading
                        return;
                    }
                    
                    // Setup real-time listeners for instant updates
                    setupBlacklistListener();
                    setupMaintenanceListener();
                    
                    // Also do initial check for maintenance mode
                    checkMaintenanceMode();
                });
                
                // Initialize database structure if it doesn't exist
                initializeDatabaseStructure();
                
                // Track user visit
                trackUserVisit();
                
                // Initialize profile system
                initializeProfileSystem();
                
                // Initialize glitch effect
                initGlitchEffect();
                
                // Set up periodic monitoring to auto-recreate deleted structures
                setupDatabaseStructureMonitor();
            }
        } catch (error) {
            console.error('Firebase initialization error:', error);
            console.log('Using fallback localStorage tracking');
        }

        // Initialize database structure (creates all required paths if they don't exist)
        async function initializeDatabaseStructure() {
            if (!firebaseInitialized || !database) {
                console.log('⚠️ Firebase not initialized, skipping database structure initialization');
                return;
            }

            console.log('🔄 Initializing database structure...');
            try {
                // Initialize downloads/count
                const downloadsRef = database.ref('downloads/count');
                const downloadsSnapshot = await downloadsRef.once('value');
                if (downloadsSnapshot.val() === null) {
                    await downloadsRef.set(0);
                    console.log('✅ Initialized: downloads/count = 0');
                }

                // Initialize ratings path (just ensure it exists, can be empty)
                const ratingsRef = database.ref('ratings');
                const ratingsSnapshot = await ratingsRef.once('value');
                if (ratingsSnapshot.val() === null) {
                    // Create empty object to initialize the path
                    await ratingsRef.set({});
                    console.log('✅ Initialized: ratings path');
                }

                // Initialize announcements path
                const announcementsRef = database.ref('announcements');
                const announcementsSnapshot = await announcementsRef.once('value');
                if (announcementsSnapshot.val() === null) {
                    try {
                        await announcementsRef.set({});
                        console.log('✅ Initialized: announcements path');
                    } catch (err) {
                        console.error('❌ Failed to create announcements path:', err);
                        console.log('💡 Make sure Firebase rules allow writes to announcements');
                    }
                } else {
                    console.log('ℹ️ Announcements path already exists');
                }

                // Initialize changelog path
                const changelogRef = database.ref('changelog');
                const changelogSnapshot = await changelogRef.once('value');
                if (changelogSnapshot.val() === null) {
                    try {
                        await changelogRef.set({});
                        console.log('✅ Initialized: changelog path');
                    } catch (err) {
                        console.error('❌ Failed to create changelog path:', err);
                        console.log('💡 Make sure Firebase rules allow writes to changelog');
                    }
                } else {
                    console.log('ℹ️ Changelog path already exists');
                }

                // Initialize translations path
                const translationsRef = database.ref('translations');
                const translationsSnapshot = await translationsRef.once('value');
                if (translationsSnapshot.val() === null) {
                    try {
                        await translationsRef.set({});
                        console.log('✅ Initialized: translations path');
                    } catch (err) {
                        console.error('❌ Failed to create translations path:', err);
                        console.log('💡 Make sure Firebase rules allow writes to translations');
                    }
                } else {
                    console.log('ℹ️ Translations path already exists');
                }

                console.log('✅ Database structure check complete');
            } catch (error) {
                console.error('❌ Error initializing database structure:', error);
                console.error('Error details:', error.message, error.code);
            }
        }

        // Manual initialization function (can be called from browser console)
        window.initializeFirebasePaths = async function() {
            console.log('🔧 Manual initialization triggered...');
            await initializeDatabaseStructure();
        };

        // Periodic check to ensure database structures exist (runs every 30 seconds)
        function setupDatabaseStructureMonitor() {
            if (!firebaseInitialized || !database) return;

            // Real-time listener for downloads/count - auto-recreate if deleted
            database.ref('downloads/count').on('value', async (snapshot) => {
                if (snapshot.val() === null) {
                    try {
                        await database.ref('downloads/count').set(0);
                        console.log('🔄 Auto-recreated: downloads/count = 0');
                    } catch (error) {
                        console.error('Error recreating downloads/count:', error);
                    }
                }
            }, (error) => {
                console.error('Error monitoring downloads/count:', error);
            });

            // Real-time listener for ratings - auto-recreate if deleted
            database.ref('ratings').on('value', async (snapshot) => {
                if (snapshot.val() === null) {
                    try {
                        await database.ref('ratings').set({});
                        console.log('🔄 Auto-recreated: ratings path');
                    } catch (error) {
                        console.error('Error recreating ratings:', error);
                    }
                }
            }, (error) => {
                console.error('Error monitoring ratings:', error);
            });

            // Real-time listener for announcements - auto-recreate if deleted
            database.ref('announcements').on('value', async (snapshot) => {
                if (snapshot.val() === null) {
                    try {
                        await database.ref('announcements').set({});
                        console.log('🔄 Auto-recreated: announcements path');
                    } catch (error) {
                        console.error('Error recreating announcements:', error);
                    }
                }
            }, (error) => {
                console.error('Error monitoring announcements:', error);
            });

            // Real-time listener for changelog - auto-recreate if deleted
            database.ref('changelog').on('value', async (snapshot) => {
                if (snapshot.val() === null) {
                    try {
                        await database.ref('changelog').set({});
                        console.log('🔄 Auto-recreated: changelog path');
                    } catch (error) {
                        console.error('Error recreating changelog:', error);
                    }
                }
            }, (error) => {
                console.error('Error monitoring changelog:', error);
            });

            // Real-time listener for translations - auto-recreate if deleted
            database.ref('translations').on('value', async (snapshot) => {
                if (snapshot.val() === null) {
                    try {
                        await database.ref('translations').set({});
                        console.log('🔄 Auto-recreated: translations path');
                    } catch (error) {
                        console.error('Error recreating translations:', error);
                    }
                }
            }, (error) => {
                console.error('Error monitoring translations:', error);
            });

            // Periodic check as backup (every 30 seconds)
            setInterval(async () => {
                try {
                    // Check downloads/count
                    const downloadsRef = database.ref('downloads/count');
                    const downloadsSnapshot = await downloadsRef.once('value');
                    if (downloadsSnapshot.val() === null) {
                        await downloadsRef.set(0);
                        console.log('🔄 Periodic check: Recreated downloads/count = 0');
                    }

                    // Check ratings path
                    const ratingsRef = database.ref('ratings');
                    const ratingsSnapshot = await ratingsRef.once('value');
                    if (ratingsSnapshot.val() === null) {
                        await ratingsRef.set({});
                        console.log('🔄 Periodic check: Recreated ratings path');
                    }

                    // Check announcements
                    const announcementsRef = database.ref('announcements');
                    const announcementsSnapshot = await announcementsRef.once('value');
                    if (announcementsSnapshot.val() === null) {
                        await announcementsRef.set({});
                        console.log('🔄 Periodic check: Recreated announcements path');
                    }

                    // Check changelog
                    const changelogRef = database.ref('changelog');
                    const changelogSnapshot = await changelogRef.once('value');
                    if (changelogSnapshot.val() === null) {
                        await changelogRef.set({});
                        console.log('🔄 Periodic check: Recreated changelog path');
                    }

                    // Check translations
                    const translationsRef = database.ref('translations');
                    const translationsSnapshot = await translationsRef.once('value');
                    if (translationsSnapshot.val() === null) {
                        await translationsRef.set({});
                        console.log('🔄 Periodic check: Recreated translations path');
                    }
                } catch (error) {
                    console.error('Error in database structure monitor:', error);
                }
            }, 30000); // Check every 30 seconds
        }


        // ============================================
        // FEATURE #2: Dynamic Announcements System
        // ============================================
        const ANNOUNCEMENTS_PATH = 'announcements';
        const ANNOUNCEMENT_DISMISSED_KEY = 'recon_announcements_dismissed';

        async function loadAnnouncements() {
            if (!firebaseInitialized || !database) return;

            try {
                const snapshot = await database.ref(ANNOUNCEMENTS_PATH).once('value');
                if (!snapshot.exists()) return;

                const announcements = snapshot.val();
                const now = Date.now();
                const dismissed = JSON.parse(localStorage.getItem(ANNOUNCEMENT_DISMISSED_KEY) || '[]');

                // Find active announcement
                let activeAnnouncement = null;
                for (const [id, announcement] of Object.entries(announcements)) {
                    if (dismissed.includes(id)) continue;
                    
                    // Check end date only (start date removed - announcements show instantly)
                    const endDate = announcement.endDate || Infinity;
                    
                    if (now <= endDate) {
                        // Check priority (higher priority first)
                        if (!activeAnnouncement || 
                            (announcement.priority === 'high' && activeAnnouncement.priority !== 'high')) {
                            activeAnnouncement = { id, ...announcement };
                        }
                    }
                }

                if (activeAnnouncement) {
                    showAnnouncement(activeAnnouncement);
                }
            } catch (error) {
                console.error('Error loading announcements:', error);
            }
        }

        function showAnnouncement(announcement) {
            const banner = document.getElementById('announcementBanner');
            const icon = document.getElementById('announcementIcon');
            const title = document.getElementById('announcementTitle');
            const message = document.getElementById('announcementMessage');
            const link = document.getElementById('announcementLink');
            const closeBtn = document.getElementById('announcementClose');

            if (!banner) return;

            // Set type/color
            banner.className = `announcement-banner ${announcement.type || 'info'}`;
            
            // Set icon
            const icons = {
                info: 'ℹ️',
                success: '✅',
                warning: '⚠️',
                error: '❌'
            };
            icon.textContent = icons[announcement.type] || icons.info;

            // Set content
            title.textContent = announcement.title || '';
            message.textContent = announcement.message || '';

            // Set link if provided
            if (announcement.link && announcement.linkText) {
                link.href = announcement.link;
                link.textContent = announcement.linkText;
                link.style.display = 'inline';
            } else {
                link.style.display = 'none';
            }

            // Show banner
            banner.style.display = 'flex';
            document.body.style.paddingTop = '60px';

            // Store announcement ID for close button
            banner.setAttribute('data-announcement-id', announcement.id);
            
            // Close button handler
            if (closeBtn) {
                closeBtn.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (announcement.dismissible !== false) {
                        dismissAnnouncement(announcement.id);
                    }
                };
            }
        }

        function dismissAnnouncement(id) {
            const dismissed = JSON.parse(localStorage.getItem(ANNOUNCEMENT_DISMISSED_KEY) || '[]');
            if (!dismissed.includes(id)) {
                dismissed.push(id);
                localStorage.setItem(ANNOUNCEMENT_DISMISSED_KEY, JSON.stringify(dismissed));
            }
            
            const banner = document.getElementById('announcementBanner');
            if (banner) {
                banner.style.display = 'none';
                document.body.style.paddingTop = '0';
            }
        }

        // Listen for real-time announcement updates
        function setupAnnouncementListener() {
            if (!firebaseInitialized || !database) return;

            database.ref(ANNOUNCEMENTS_PATH).on('value', () => {
                loadAnnouncements();
            });
        }

        // ============================================
        // FEATURE #5: Dynamic Changelog System
        // ============================================
        const CHANGELOG_PATH = 'changelog';

        async function loadChangelog() {
            const content = document.getElementById('changelogContent');
            if (!content) return;

            if (!firebaseInitialized || !database) {
                content.innerHTML = '<div class="changelog-empty" data-i18n="changelog.error">Unable to load changelog.</div>';
                return;
            }

            try {
                const snapshot = await database.ref(CHANGELOG_PATH).once('value');
                if (!snapshot.exists()) {
                    content.innerHTML = '<div class="changelog-empty" data-i18n="changelog.empty">No changelog entries yet.</div>';
                    return;
                }

                const changelog = snapshot.val();
                const entries = Object.entries(changelog)
                    .map(([id, entry]) => ({ id, ...entry }))
                    .sort((a, b) => {
                        // Sort by date (newest first)
                        const dateA = a.date || '';
                        const dateB = b.date || '';
                        return dateB.localeCompare(dateA);
                    });

                if (entries.length === 0) {
                    content.innerHTML = '<div class="changelog-empty" data-i18n="changelog.empty">No changelog entries yet.</div>';
                    return;
                }

                // Render changelog
                content.innerHTML = entries.map(entry => {
                    const changes = Array.isArray(entry.changes) ? entry.changes : [];
                    const changesList = changes.map(change => `<li>${escapeHtml(change)}</li>`).join('');
                    
                    return `
                        <div class="changelog-item">
                            <div class="changelog-version">${escapeHtml(entry.version || 'Unknown Version')}</div>
                            ${entry.downloadUrl ? `<a href="${escapeHtml(entry.downloadUrl)}" class="changelog-download" style="display: inline-block; margin-top: 8px; color: #3b82f6; text-decoration: none;">Download this version</a>` : ''}
                            <ul class="changelog-list">
                                ${changesList || '<li>No changes listed</li>'}
                            </ul>
                        </div>
                    `;
                }).join('');

                // Update translations
                updateTranslations();
            } catch (error) {
                console.error('Error loading changelog:', error);
                content.innerHTML = '<div class="changelog-empty" data-i18n="changelog.error">Error loading changelog.</div>';
            }
        }

        // Listen for real-time changelog updates
        function setupChangelogListener() {
            if (!firebaseInitialized || !database) return;

            database.ref(CHANGELOG_PATH).on('value', () => {
                loadChangelog();
            });
        }

        // Listen for real-time survey updates
        function setupSurveysListener() {
            if (!firebaseInitialized || !database) return;

            const content = document.getElementById('surveysContent');
            const section = document.getElementById('surveys');

            database.ref('surveys').on('value', (snapshot) => {
                if (!snapshot.exists()) {
                    section.style.display = 'none';
                    return;
                }

                const surveys = snapshot.val();
                const activeSurveys = Object.entries(surveys)
                    .map(([id, survey]) => ({ id, ...survey }))
                    .filter(survey => survey.active !== false)
                    .sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

                if (activeSurveys.length === 0) {
                    section.style.display = 'none';
                    return;
                }

                section.style.display = 'block';
                renderSurveys(activeSurveys, content);
            }, (error) => {
                console.error('Error listening to surveys:', error);
                section.style.display = 'none';
            });
        }

        function renderSurveys(surveys, content) {
            if (!content) return;

            const html = surveys.map(survey => {
                const isPoll = survey.type === 'poll';
                const isRating = survey.type === 'rating';
                let optionsHtml = '';

                if (isRating) {
                    optionsHtml = `
                        <div class="survey-rating">
                            ${[1, 2, 3, 4, 5].map(rating => `
                                <button class="rating-btn" onclick="submitSurveyResponse('${survey.id}', ${rating})" data-rating="${rating}">
                                    ⭐
                                </button>
                            `).join('')}
                        </div>
                    `;
                } else {
                    optionsHtml = `
                        <div class="survey-options">
                            ${survey.options.map((option, index) => `
                                <button class="survey-option-btn" onclick="submitSurveyResponse('${survey.id}', ${index})">
                                    ${escapeHtml(option)}
                                </button>
                            `).join('')}
                        </div>
                    `;
                }

                return `
                    <div class="survey-item">
                        <h3 class="survey-title">${escapeHtml(survey.title)}</h3>
                        ${survey.description ? `<p class="survey-description">${escapeHtml(survey.description)}</p>` : ''}
                        ${optionsHtml}
                        <div class="survey-response" id="surveyResponse_${survey.id}" style="display: none; margin-top: 16px; padding: 12px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 4px; color: #22c55e;">
                            ✅ Thank you for your response!
                        </div>
                    </div>
                `;
            }).join('');

            content.innerHTML = html;
        }

        async function submitSurveyResponse(surveyId, response) {
            if (!firebaseInitialized || !database) return;

            try {
                const responseKey = `response_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const responseData = {
                    surveyId,
                    response,
                    timestamp: Date.now(),
                    ip: await getClientIP()
                };

                await database.ref(`surveyResponses/${responseKey}`).set(responseData);

                // Show success message
                const responseDiv = document.getElementById(`surveyResponse_${surveyId}`);
                if (responseDiv) {
                    responseDiv.style.display = 'block';
                }

                // Disable buttons
                const surveyItem = document.querySelector(`#surveyResponse_${surveyId}`).closest('.survey-item');
                if (surveyItem) {
                    surveyItem.querySelectorAll('button').forEach(btn => {
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    });
                }
            } catch (error) {
                console.error('Error submitting survey response:', error);
                alert('Failed to submit response. Please try again.');
            }
        }

        // ============================================
        // SUPPORT TICKETS SYSTEM (REWORKED)
        // ============================================
        
        // Ticket system state
        const TicketSystem = {
            currentTicketId: null,
            messageListener: null,
            elements: {
                creationModal: null,
                viewModal: null,
                subjectInput: null,
                messageInput: null,
                errorDiv: null,
                ticketsContent: null,
                viewTitle: null,
                viewId: null,
                messagesContainer: null,
                replyInput: null
            },
            
            // Initialize and cache all elements
            init: function() {
                this.elements.creationModal = document.getElementById('ticketCreationModal');
                this.elements.viewModal = document.getElementById('ticketViewModal');
                this.elements.subjectInput = document.getElementById('ticketSubjectInput');
                this.elements.messageInput = document.getElementById('ticketMessageInput');
                this.elements.errorDiv = document.getElementById('ticketError');
                this.elements.ticketsContent = document.getElementById('userTicketsContent');
                this.elements.viewTitle = document.getElementById('ticketViewTitle');
                this.elements.viewId = document.getElementById('ticketViewId');
                this.elements.messagesContainer = document.getElementById('ticketMessagesContainer');
                this.elements.replyInput = document.getElementById('ticketReplyInput');
                
                // Validate critical elements
                if (!this.elements.creationModal || !this.elements.viewModal) {
                    console.error('Ticket modals not found in DOM');
                }
            },
            
            // Show creation modal
            openCreationModal: function() {
                if (!this.elements.creationModal) {
                    this.init();
                }
                if (!this.elements.creationModal) {
                    alert('Error: Ticket system not initialized. Please refresh the page.');
                    return;
                }
                
                this.elements.creationModal.classList.add('active');
                if (this.elements.subjectInput) this.elements.subjectInput.value = '';
                if (this.elements.messageInput) this.elements.messageInput.value = '';
                this.clearImages('creation');
                if (this.elements.errorDiv) {
                    this.elements.errorDiv.style.display = 'none';
                    this.elements.errorDiv.textContent = '';
                }
            },
            
            // Close creation modal
            closeCreationModal: function() {
                if (this.elements.creationModal) {
                    this.elements.creationModal.classList.remove('active');
                }
            },
            
            // Show error message
            showError: function(message) {
                if (this.elements.errorDiv) {
                    this.elements.errorDiv.textContent = message;
                    this.elements.errorDiv.style.display = 'block';
                } else {
                    alert(message);
                }
            },
            
            // Hide error message
            hideError: function() {
                if (this.elements.errorDiv) {
                    this.elements.errorDiv.style.display = 'none';
                    this.elements.errorDiv.textContent = '';
                }
            }
        };
        
        // Initialize ticket system on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                TicketSystem.init();
                setupTicketImageHandlers();
            });
        } else {
            TicketSystem.init();
            setupTicketImageHandlers();
        }
        
        function setupTicketImageHandlers() {
            // Creation modal image input
            const creationImageInput = document.getElementById('ticketImageInput');
            if (creationImageInput) {
                creationImageInput.addEventListener('change', (e) => {
                    if (e.target.files && e.target.files.length > 0) {
                        TicketSystem.handleImageUpload('creation', e.target.files);
                        e.target.value = ''; // Reset input
                    }
                });
            }
            
            // Reply image input
            const replyImageInput = document.getElementById('ticketReplyImageInput');
            if (replyImageInput) {
                replyImageInput.addEventListener('change', (e) => {
                    if (e.target.files && e.target.files.length > 0) {
                        TicketSystem.handleImageUpload('reply', e.target.files);
                        e.target.value = ''; // Reset input
                    }
                });
            }
        }
        
        // Global functions for onclick handlers
        window.openTicketModal = function() {
            TicketSystem.openCreationModal();
        };
        
        window.closeTicketModal = function() {
            TicketSystem.closeCreationModal();
        };

        // Image handling functions
        TicketSystem.attachedImages = {
            creation: [],
            reply: []
        };
        
        // Voice recording functions
        TicketSystem.voiceRecording = {
            creation: null,
            reply: null,
            mediaRecorder: null,
            audioChunks: [],
            isRecording: false
        };
        
        TicketSystem.startRecording = async function(type) {
            if (this.voiceRecording.isRecording) return;
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                this.voiceRecording.mediaRecorder = new MediaRecorder(stream);
                this.voiceRecording.audioChunks = [];
                this.voiceRecording.isRecording = true;
                
                const recordBtn = type === 'creation' ? document.getElementById('ticketVoiceRecordBtn') : document.getElementById('ticketReplyVoiceBtn');
                const recordText = type === 'creation' ? document.getElementById('ticketVoiceRecordText') : null;
                
                if (recordBtn) {
                    recordBtn.classList.add('recording');
                    if (recordText) recordText.textContent = 'Recording...';
                }
                
                this.voiceRecording.mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        this.voiceRecording.audioChunks.push(event.data);
                    }
                };
                
                this.voiceRecording.mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(this.voiceRecording.audioChunks, { type: 'audio/webm' });
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const audioData = e.target.result;
                        if (type === 'creation') {
                            this.voiceRecording.creation = {
                                data: audioData,
                                duration: 0 // Will be calculated if needed
                            };
                        } else {
                            this.voiceRecording.reply = {
                                data: audioData,
                                duration: 0
                            };
                        }
                        
                        if (recordBtn) {
                            recordBtn.classList.remove('recording');
                            if (recordText) recordText.textContent = 'Hold to Record';
                        }
                        
                        // Stop all tracks
                        stream.getTracks().forEach(track => track.stop());
                    };
                    reader.readAsDataURL(audioBlob);
                };
                
                this.voiceRecording.mediaRecorder.start();
            } catch (error) {
                console.error('Error starting recording:', error);
                alert('Could not access microphone. Please check permissions.');
                this.voiceRecording.isRecording = false;
            }
        };
        
        TicketSystem.stopRecording = function(type) {
            if (!this.voiceRecording.isRecording || !this.voiceRecording.mediaRecorder) return;
            
            if (this.voiceRecording.mediaRecorder.state === 'recording') {
                this.voiceRecording.mediaRecorder.stop();
                this.voiceRecording.isRecording = false;
            }
        };
        
        TicketSystem.clearVoice = function(type) {
            if (type === 'creation') {
                this.voiceRecording.creation = null;
            } else {
                this.voiceRecording.reply = null;
            }
        };

        TicketSystem.handleImageUpload = function(type, files) {
            const maxSize = 5 * 1024 * 1024; // 5MB
            const maxImages = 5;
            const imageArray = type === 'creation' ? this.attachedImages.creation : this.attachedImages.reply;
            const previewId = type === 'creation' ? 'ticketImagePreview' : 'ticketReplyImagePreview';
            
            if (imageArray.length + files.length > maxImages) {
                alert(`Maximum ${maxImages} images allowed`);
                return;
            }
            
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) {
                    alert('Only image files are allowed');
                    return;
                }
                
                if (file.size > maxSize) {
                    alert(`Image ${file.name} is too large. Maximum size is 5MB`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    imageArray.push({
                        name: file.name,
                        data: e.target.result,
                        size: file.size
                    });
                    this.updateImagePreview(type);
                };
                reader.readAsDataURL(file);
            });
        };

        TicketSystem.updateImagePreview = function(type) {
            const previewId = type === 'creation' ? 'ticketImagePreview' : 'ticketReplyImagePreview';
            const preview = document.getElementById(previewId);
            if (!preview) return;
            
            const imageArray = type === 'creation' ? this.attachedImages.creation : this.attachedImages.reply;
            
            if (imageArray.length === 0) {
                preview.innerHTML = '';
                return;
            }
            
            preview.innerHTML = imageArray.map((img, index) => `
                <div class="ticket-image-preview-item">
                    <img src="${img.data}" alt="${escapeHtml(img.name)}">
                    <button onclick="TicketSystem.removeImage('${type}', ${index})">×</button>
                </div>
            `).join('');
        };

        TicketSystem.removeImage = function(type, index) {
            const imageArray = type === 'creation' ? this.attachedImages.creation : this.attachedImages.reply;
            imageArray.splice(index, 1);
            this.updateImagePreview(type);
        };

        TicketSystem.clearImages = function(type) {
            if (type === 'creation') {
                this.attachedImages.creation = [];
            } else {
                this.attachedImages.reply = [];
            }
            this.updateImagePreview(type);
        };

        window.createTicket = async function() {
            // Ensure elements are initialized
            if (!TicketSystem.elements.subjectInput || !TicketSystem.elements.messageInput) {
                TicketSystem.init();
            }
            
            const subject = TicketSystem.elements.subjectInput ? TicketSystem.elements.subjectInput.value.trim() : '';
            const message = TicketSystem.elements.messageInput ? TicketSystem.elements.messageInput.value.trim() : '';

            // Validation
            if (!subject) {
                TicketSystem.showError('Subject is required');
                return;
            }

            if (!message && TicketSystem.attachedImages.creation.length === 0 && !TicketSystem.voiceRecording.creation) {
                TicketSystem.showError('Message, image, or voice recording is required');
                return;
            }

            if (!firebaseInitialized || !database) {
                TicketSystem.showError('Firebase not initialized. Please refresh the page.');
                return;
            }

            try {
                TicketSystem.hideError();
                
                // Disable button during creation
                const createBtn = document.querySelector('#ticketCreationModal .ticket-send-btn');
                if (createBtn) {
                    createBtn.disabled = true;
                    createBtn.textContent = 'Creating...';
                }
                
                const ticketId = 'ticket-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                let ip = 'unknown';
                try {
                    ip = await getClientIP();
                } catch (e) {
                    console.warn('Could not get IP:', e);
                }
                
                const ticketData = {
                    id: ticketId,
                    subject,
                    status: 'open',
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    userIp: ip,
                    userAgent: navigator.userAgent || 'unknown'
                };

                await database.ref(`tickets/${ticketId}`).set(ticketData);

                // Create initial message
                const messageData = {
                    ticketId,
                    message: message || '',
                    sender: 'user',
                    timestamp: Date.now(),
                    images: TicketSystem.attachedImages.creation.map(img => ({
                        name: img.name,
                        data: img.data
                    })),
                    voice: TicketSystem.voiceRecording.creation ? {
                        data: TicketSystem.voiceRecording.creation.data,
                        duration: TicketSystem.voiceRecording.creation.duration
                    } : null
                };

                await database.ref(`ticketMessages/${ticketId}/${Date.now()}`).set(messageData);

                // Store ticket ID in localStorage for persistence
                const storedTickets = JSON.parse(localStorage.getItem('user_ticket_ids') || '[]');
                if (!storedTickets.includes(ticketId)) {
                    storedTickets.push(ticketId);
                    localStorage.setItem('user_ticket_ids', JSON.stringify(storedTickets));
                }

                // Clear images, voice, and form
                TicketSystem.clearImages('creation');
                TicketSystem.clearVoice('creation');
                if (TicketSystem.elements.subjectInput) TicketSystem.elements.subjectInput.value = '';
                if (TicketSystem.elements.messageInput) TicketSystem.elements.messageInput.value = '';

                // Success
                TicketSystem.closeCreationModal();
                await loadUserTickets();
                alert('✅ Ticket created successfully!\nTicket ID: ' + ticketId);
            } catch (error) {
                console.error('Error creating ticket:', error);
                TicketSystem.showError('Failed to create ticket: ' + (error.message || 'Unknown error'));
            } finally {
                // Re-enable button
                const createBtn = document.querySelector('#ticketCreationModal .ticket-send-btn');
                if (createBtn) {
                    createBtn.disabled = false;
                    createBtn.textContent = 'Create Ticket';
                }
            }
        }

        function setupUserTicketsListener() {
            if (!firebaseInitialized || !database) {
                // Retry after a delay if Firebase isn't ready
                setTimeout(setupUserTicketsListener, 1000);
                return;
            }
            
            // Initialize ticket system
            TicketSystem.init();
            
            // Load tickets
            loadUserTickets();
        }

        window.loadUserTickets = async function() {
            const content = document.getElementById('userTicketsContent');
            if (!content) return;

            try {
                // Get stored ticket IDs from localStorage
                const storedTicketIds = JSON.parse(localStorage.getItem('user_ticket_ids') || '[]');
                
                // Get current IP for additional filtering
                let currentIp = null;
                try {
                    currentIp = await getClientIP();
                } catch (e) {
                    console.warn('Could not get IP address:', e);
                }

                const snapshot = await database.ref('tickets').once('value');
                
                if (!snapshot.exists() && storedTicketIds.length === 0) {
                    content.innerHTML = '<div class="changelog-empty">No tickets created yet</div>';
                    return;
                }

                const allTickets = snapshot.exists() ? snapshot.val() : {};
                const ticketEntries = Object.entries(allTickets).map(([id, ticket]) => ({ id, ...ticket }));
                
                // Filter tickets: include if ticket ID is in localStorage OR if IP matches
                const userTickets = ticketEntries.filter(ticket => {
                    // Include if ticket ID is stored in localStorage
                    if (storedTicketIds.includes(ticket.id)) {
                        return true;
                    }
                    // Include if IP matches (for backward compatibility)
                    if (currentIp && ticket.userIp === currentIp) {
                        // Also add to localStorage if not already there
                        if (!storedTicketIds.includes(ticket.id)) {
                            storedTicketIds.push(ticket.id);
                            localStorage.setItem('user_ticket_ids', JSON.stringify(storedTicketIds));
                        }
                        return true;
                    }
                    return false;
                }).sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));

                if (userTickets.length === 0) {
                    content.innerHTML = '<div class="changelog-empty">No tickets created yet</div>';
                    return;
                }

                const html = userTickets.map(ticket => {
                    const date = new Date(ticket.createdAt);
                    return `
                        <div class="ticket-item">
                            <div class="ticket-content" onclick="viewUserTicket('${ticket.id}')">
                                <div class="ticket-header">
                                    <div class="ticket-id">${escapeHtml(ticket.id)}</div>
                                    <div class="ticket-status ${ticket.status}">${ticket.status}</div>
                                </div>
                                <div class="ticket-title">${escapeHtml(ticket.subject)}</div>
                                <div class="ticket-meta">
                                    <span>Created: ${date.toLocaleString()}</span>
                                    <span>Updated: ${new Date(ticket.updatedAt).toLocaleString()}</span>
                                </div>
                            </div>
                            <div class="ticket-actions">
                                <button class="ticket-action-btn view-btn" onclick="event.stopPropagation(); viewUserTicket('${ticket.id}')" title="View Ticket">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                                <button class="ticket-action-btn delete-btn" onclick="event.stopPropagation(); deleteUserTicket('${ticket.id}')" title="Delete Ticket">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                content.innerHTML = html;
            } catch (error) {
                console.error('Error loading tickets:', error);
                content.innerHTML = '<div class="changelog-empty">Error loading tickets</div>';
            }
        }

        // Enhanced viewUserTicket with better error handling
        TicketSystem.view = async function(ticketId) {
            if (!ticketId || typeof ticketId !== 'string') {
                alert('Invalid ticket ID');
                return;
            }
            
            // Get elements safely
            const modal = this.getElement('ticketViewModal');
            if (!modal) {
                alert('Ticket modal not found. Please refresh the page.');
                return;
            }
            
            if (!firebaseInitialized || !database) {
                alert('Firebase not initialized. Please refresh the page.');
                return;
            }
            
            try {
                // Show modal and loading
                modal.classList.add('active');
                const messagesContainer = this.getElement('ticketMessagesContainer');
                if (messagesContainer) {
                    messagesContainer.innerHTML = '<div style="color: #888; text-align: center; padding: 40px;">Loading ticket...</div>';
                }
                
                // Load ticket
                const ticketSnapshot = await database.ref(`tickets/${ticketId}`).once('value');
                if (!ticketSnapshot.exists()) {
                    alert('Ticket not found');
                    this.closeViewModal();
                    return;
                }
                
                const ticket = ticketSnapshot.val();
                if (!ticket) {
                    alert('Invalid ticket data');
                    this.closeViewModal();
                    return;
                }
                
                // Update UI safely
                const titleEl = this.getElement('ticketViewTitle');
                const idEl = this.getElement('ticketViewId');
                
                if (titleEl) titleEl.textContent = ticket.subject || 'No Subject';
                if (idEl) idEl.textContent = ticket.id || ticketId;
                
                // Load messages
                await this.loadMessages(ticketId);
                
                // Setup listener
                this.setupListener(ticketId);
                
                this.currentTicketId = ticketId;
                
                // Focus input
                const replyInput = this.getElement('ticketReplyInput');
                if (replyInput) {
                    setTimeout(() => replyInput.focus(), 100);
                }
            } catch (error) {
                console.error('Error loading ticket:', error);
                alert('Error loading ticket: ' + (error.message || 'Unknown error'));
                this.closeViewModal();
            }
        };
        
        // Get element safely
        TicketSystem.getElement = function(id) {
            const el = document.getElementById(id);
            if (!el) {
                console.error(`Element not found: ${id}`);
            }
            return el;
        };
        
        // Load messages
        TicketSystem.loadMessages = async function(ticketId) {
            const container = this.getElement('ticketMessagesContainer');
            if (!container) return;
            
            try {
                const snapshot = await database.ref(`ticketMessages/${ticketId}`).once('value');
                const messages = snapshot.exists() ? snapshot.val() : {};
                const messagesArray = Object.entries(messages)
                    .map(([ts, msg]) => {
                        try {
                            return {
                                timestamp: parseInt(ts) || Date.now(),
                                message: (msg && msg.message) ? String(msg.message) : '',
                                sender: (msg && msg.sender) ? String(msg.sender) : 'user',
                                images: Array.isArray(msg.images) ? msg.images : [],
                                voice: msg.voice || null
                            };
                        } catch (e) {
                            return null;
                        }
                    })
                    .filter(m => m !== null && (m.message || (Array.isArray(m.images) && m.images.length > 0) || (m.voice && m.voice.data)))
                    .sort((a, b) => a.timestamp - b.timestamp);
                
                this.renderMessages(messagesArray, container);
            } catch (error) {
                console.error('Error loading messages:', error);
                container.innerHTML = '<div style="color: #ef4444; text-align: center; padding: 40px;">Error loading messages</div>';
            }
        };
        
        // Render messages
        TicketSystem.renderMessages = async function(messages, container) {
            if (!container) return;
            
            if (!Array.isArray(messages) || messages.length === 0) {
                container.innerHTML = '<div style="color: #888; text-align: center; padding: 40px;">No messages yet</div>';
                return;
            }
            
            try {
                // Load user profile if this is a user message
                const userProfile = userProfileId ? await getUserProfileForTicket(userProfileId) : null;
                
                const html = await Promise.all(messages.map(async (msg) => {
                    try {
                        const date = new Date(msg.timestamp || Date.now());
                        const isUser = msg.sender === 'user';
                        const messageText = escapeHtml(String(msg.message || ''));
                        const images = Array.isArray(msg.images) ? msg.images : [];
                        const voice = msg.voice || null;
                        
                        // Get profile info for user messages
                        let profileInfo = '';
                        if (isUser && userProfile) {
                            const avatarSrc = userProfile.avatar || `data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22%3E%3Ccircle cx=%2212%22 cy=%2212%22 r=%2212%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2212%22 y=%2216%22 font-size=%2210%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E${encodeURIComponent((userProfile.username || '?').charAt(0).toUpperCase())}%3C/text%3E%3C/svg%3E`;
                            profileInfo = `
                                <div class="ticket-message-user-info">
                                    <img class="ticket-message-avatar" src="${escapeHtml(avatarSrc)}" alt="${escapeHtml(userProfile.username || 'User')}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22%3E%3Ccircle cx=%2212%22 cy=%2212%22 r=%2212%22 fill=%22%233a3a3a%22/%3E%3C/svg%3E'">
                                    <span class="ticket-message-username">${escapeHtml(userProfile.username || 'You')}</span>
                                </div>
                            `;
                        } else if (isUser) {
                            profileInfo = '<span class="ticket-message-username">You</span>';
                        } else {
                            profileInfo = '<span class="ticket-message-username">Admin</span>';
                        }
                        
                        let imagesHtml = '';
                        if (images.length > 0) {
                            imagesHtml = images.map(img => `
                                <div class="ticket-message-image">
                                    <img src="${escapeHtml(img.data)}" alt="${escapeHtml(img.name || 'Image')}" onclick="window.openImageModal('${escapeHtml(img.data)}')">
                                </div>
                            `).join('');
                        }
                        
                        let voiceHtml = '';
                        if (voice && voice.data) {
                            const voiceId = `voice_${msg.timestamp}_${Math.random().toString(36).substr(2, 9)}`;
                            voiceHtml = `
                                <div class="ticket-voice-message">
                                    <div class="ticket-voice-player">
                                        <button class="ticket-voice-play-btn" onclick="TicketSystem.playVoice('${voiceId}', '${escapeHtml(voice.data)}')" id="${voiceId}_btn">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </button>
                                        <span class="ticket-voice-duration" id="${voiceId}_duration">Voice Message</span>
                                    </div>
                                </div>
                            `;
                        }
                        
                        return `
                            <div class="ticket-message ${isUser ? 'user' : 'admin'}">
                                <div class="ticket-message-header">
                                    ${profileInfo}
                                    <span style="color: #666;">•</span>
                                    <span>${date.toLocaleString()}</span>
                                </div>
                                ${messageText ? `<div class="ticket-message-text">${messageText}</div>` : ''}
                                ${imagesHtml}
                                ${voiceHtml}
                            </div>
                        `;
                    } catch (e) {
                        return '';
                    }
                }));
                
                container.innerHTML = html.filter(h => h).join('') || '<div style="color: #888; text-align: center; padding: 40px;">No valid messages</div>';
                setTimeout(() => {
                    container.scrollTop = container.scrollHeight;
                }, 50);
            } catch (error) {
                console.error('Error rendering messages:', error);
                container.innerHTML = '<div style="color: #ef4444; text-align: center; padding: 40px;">Error displaying messages</div>';
            }
        };
        
        window.openImageModal = function(imageSrc) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 20000; display: flex; align-items: center; justify-content: center; cursor: pointer;';
            modal.onclick = () => document.body.removeChild(modal);
            modal.innerHTML = `<img src="${escapeHtml(imageSrc)}" style="max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">`;
            document.body.appendChild(modal);
        };
        
        TicketSystem.playVoice = function(voiceId, audioData) {
            const btn = document.getElementById(voiceId + '_btn');
            const durationEl = document.getElementById(voiceId + '_duration');
            
            if (!btn || !audioData) return;
            
            // Create audio element
            const audio = new Audio(audioData);
            
            // Update button to show playing state
            btn.innerHTML = `
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            `;
            btn.disabled = true;
            
            // Update duration while playing
            audio.addEventListener('loadedmetadata', () => {
                if (durationEl) {
                    const duration = Math.round(audio.duration);
                    durationEl.textContent = `${duration}s`;
                }
            });
            
            // Reset button when done
            audio.addEventListener('ended', () => {
                btn.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                `;
                btn.disabled = false;
            });
            
            audio.play().catch(err => {
                console.error('Error playing audio:', err);
                btn.disabled = false;
            });
        };
        
        // Setup listener
        TicketSystem.setupListener = function(ticketId) {
            // Clean up previous
            if (this.messageListener && this.currentTicketId) {
                try {
                    database.ref(`ticketMessages/${this.currentTicketId}`).off('value', this.messageListener);
                } catch (e) {
                    console.warn('Error removing listener:', e);
                }
            }
            
            this.messageListener = (snapshot) => {
                const container = this.getElement('ticketMessagesContainer');
                if (!container) return;
                
                try {
                    const msgs = snapshot.exists() ? snapshot.val() : {};
                    const msgsArray = Object.entries(msgs)
                        .map(([ts, msg]) => {
                            try {
                                return {
                                    timestamp: parseInt(ts) || Date.now(),
                                    message: (msg && msg.message) ? String(msg.message) : '',
                                    sender: (msg && msg.sender) ? String(msg.sender) : 'user',
                                    images: Array.isArray(msg.images) ? msg.images : [],
                                    voice: msg.voice || null
                                };
                            } catch (e) {
                                return null;
                            }
                        })
                        .filter(m => m !== null && (m.message || (Array.isArray(m.images) && m.images.length > 0) || (m.voice && m.voice.data)))
                        .sort((a, b) => a.timestamp - b.timestamp);
                    
                    this.renderMessages(msgsArray, container);
                } catch (error) {
                    console.error('Error in listener:', error);
                }
            };
            
            try {
                database.ref(`ticketMessages/${ticketId}`).on('value', this.messageListener);
            } catch (error) {
                console.error('Error setting up listener:', error);
            }
        };
        
        // Close view modal
        TicketSystem.closeViewModal = function() {
            if (this.messageListener && this.currentTicketId) {
                try {
                    database.ref(`ticketMessages/${this.currentTicketId}`).off('value', this.messageListener);
                } catch (e) {
                    console.warn('Error removing listener:', e);
                }
            }
            
            this.currentTicketId = null;
            this.messageListener = null;
            
            const modal = this.getElement('ticketViewModal');
            if (modal) {
                modal.classList.remove('active');
            }
            
            const input = this.getElement('ticketReplyInput');
            if (input) {
                input.value = '';
            }
        };
        
        // Global function
        window.viewUserTicket = function(ticketId) {
            TicketSystem.view(ticketId);
        };

        window.deleteUserTicket = async function(ticketId) {
            if (!ticketId) {
                alert('Invalid ticket ID');
                return;
            }

            // Confirm deletion
            if (!confirm('Are you sure you want to delete this ticket? This action cannot be undone.')) {
                return;
            }

            if (!firebaseInitialized || !database) {
                alert('Firebase not initialized. Please refresh the page.');
                return;
            }

            try {
                // Delete ticket from Firebase
                await database.ref(`tickets/${ticketId}`).remove();
                
                // Delete all messages for this ticket
                await database.ref(`ticketMessages/${ticketId}`).remove();
                
                // Remove from localStorage
                const storedTickets = JSON.parse(localStorage.getItem('user_ticket_ids') || '[]');
                const updatedTickets = storedTickets.filter(id => id !== ticketId);
                localStorage.setItem('user_ticket_ids', JSON.stringify(updatedTickets));
                
                // If this ticket was being viewed, close the modal
                if (TicketSystem.currentTicketId === ticketId) {
                    closeTicketViewModal();
                }
                
                // Reload ticket list
                await loadUserTickets();
                
                alert('✅ Ticket deleted successfully');
            } catch (error) {
                console.error('Error deleting ticket:', error);
                alert('Failed to delete ticket: ' + (error.message || 'Unknown error'));
            }
        }

        // renderTicketMessages is now part of TicketSystem.renderMessages above
        window.renderTicketMessages = function(messages, container) {
            TicketSystem.renderMessages(messages, container);
        };

        window.closeTicketViewModal = function() {
            TicketSystem.closeViewModal();
        };

        // Send message function
        TicketSystem.sendMessage = async function() {
            const input = this.getElement('ticketReplyInput');
            if (!input) return;
            
            const message = String(input.value || '').trim();
            const images = this.attachedImages.reply || [];
            const voice = this.voiceRecording.reply || null;
            
            if (!message && images.length === 0 && !voice) {
                alert('Please enter a message, attach an image, or record a voice message');
                return;
            }
            
            if (!this.currentTicketId) {
                alert('No ticket selected');
                return;
            }
            
            if (!firebaseInitialized || !database) {
                alert('Firebase not initialized');
                return;
            }
            
            const sendBtn = this.getElement('ticketSendBtn');
            try {
                if (sendBtn) {
                    sendBtn.disabled = true;
                    sendBtn.textContent = 'Sending...';
                }
                
                const messageData = {
                    ticketId: this.currentTicketId,
                    message: message || '',
                    sender: 'user',
                    timestamp: Date.now(),
                    images: images.map(img => ({
                        name: img.name,
                        data: img.data
                    })),
                    voice: voice ? {
                        data: voice.data,
                        duration: voice.duration || 0
                    } : null
                };
                
                await database.ref(`ticketMessages/${this.currentTicketId}/${Date.now()}`).set(messageData);
                await database.ref(`tickets/${this.currentTicketId}/updatedAt`).set(Date.now());
                
                input.value = '';
                this.clearImages('reply');
                this.clearVoice('reply');
                await loadUserTickets();
            } catch (error) {
                console.error('Error sending message:', error);
                alert('Failed to send message: ' + (error.message || 'Unknown error'));
            } finally {
                if (sendBtn) {
                    sendBtn.disabled = false;
                    sendBtn.textContent = 'Send';
                }
            }
        };
        
        window.sendTicketMessage = function() {
            TicketSystem.sendMessage();
        };

        // Utility function to escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Glitch effect for brand title
        function initGlitchEffect() {
            const brandTitle = document.getElementById('brandTitle');
            if (!brandTitle) return;
            
            const originalText = brandTitle.textContent;
            const glitchChars = '#%@$=+^*&!?<>[]{}|\\/~`';
            
            function generateGlitchChar() {
                return glitchChars[Math.floor(Math.random() * glitchChars.length)];
            }
            
            function changeCharacterByCharacter(textArray, targetArray, callback) {
                let currentIndex = 0;
                const charDelay = 80; // Delay between each character change (ms)
                
                function changeNextChar() {
                    if (currentIndex < textArray.length) {
                        // Skip spaces and hyphens
                        if (textArray[currentIndex] === ' ' || textArray[currentIndex] === '-') {
                            currentIndex++;
                            changeNextChar();
                            return;
                        }
                        
                        // Change this character
                        textArray[currentIndex] = targetArray[currentIndex];
                        brandTitle.textContent = textArray.join('');
                        currentIndex++;
                        
                        // Continue with next character
                        setTimeout(changeNextChar, charDelay);
                    } else {
                        // All characters changed, call callback
                        if (callback) callback();
                    }
                }
                
                changeNextChar();
            }
            
            function triggerGlitch() {
                // Random interval between 3-20 seconds
                const delay = Math.random() * 17000 + 3000;
                
                setTimeout(() => {
                    // Add glitching class first for smooth transition
                    brandTitle.classList.add('glitching');
                    
                    // Small delay to let CSS transition start
                    setTimeout(() => {
                        // Generate glitch text
                        let glitchTextArray = [];
                        for (let i = 0; i < originalText.length; i++) {
                            if (originalText[i] === ' ' || originalText[i] === '-') {
                                glitchTextArray.push(originalText[i]);
                            } else {
                                glitchTextArray.push(generateGlitchChar());
                            }
                        }
                        
                        // Get current text as array
                        let currentTextArray = originalText.split('');
                        
                        // Change characters one by one to glitch
                        changeCharacterByCharacter(currentTextArray, glitchTextArray, () => {
                            // After all characters glitched, wait a bit then change back
                            setTimeout(() => {
                                // Change back to original one by one
                                let originalTextArray = originalText.split('');
                                changeCharacterByCharacter(currentTextArray, originalTextArray, () => {
                                    // Remove glitching class after transition
                                    setTimeout(() => {
                                        brandTitle.classList.remove('glitching');
                                        
                                        // Trigger next glitch
                                        triggerGlitch();
                                    }, 200);
                                });
                            }, 400); // Hold glitch for a moment
                        });
                    }, 50);
                }, delay);
            }
            
            // Start glitch effect after initial animation
            setTimeout(() => {
                triggerGlitch();
            }, 2000);
        }

        async function trackUserVisit() {
            if (!firebaseInitialized || !database) return;
            
            try {
                // Check if user is blacklisted
                const ip = await getClientIP();
                const blacklistSnapshot = await database.ref('blacklist').once('value');
                const blacklist = blacklistSnapshot.exists() ? blacklistSnapshot.val() : {};
                const ipKey = ip.replace(/\./g, '_');
                
                if (blacklist[ipKey]) {
                    // User is blacklisted - could redirect or show message
                    console.warn('Blacklisted user detected:', ip);
                    return;
                }

                const userAgent = navigator.userAgent;
                const timestamp = Date.now();
                const visitId = `visit_${timestamp}_${Math.random().toString(36).substr(2, 9)}`;

                const visitData = {
                    ip: ip,
                    userAgent: userAgent,
                    timestamp: timestamp,
                    date: new Date().toISOString(),
                    url: window.location.href
                };

                await database.ref(`visits/${visitId}`).set(visitData);
            } catch (error) {
                console.error('Error tracking visit:', error);
            }
        }

        // Get client IP
        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                // Fallback to a generated ID
                return 'unknown_' + Math.random().toString(36).substr(2, 9);
            }
        }

        // ============================================
        // USER PROFILE SYSTEM
        // ============================================
        // Variables declared above with Firebase initialization

        // Simple password hash (for basic security)
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash).toString(36);
        }

        // Initialize profile system
        async function initializeProfileSystem() {
            if (!firebaseInitialized || !database) {
                console.warn('Firebase not initialized, profile system disabled');
                return;
            }

            try {
                // Check for auth token - if not found, user needs to login
                const authToken = localStorage.getItem(AUTH_TOKEN_KEY);
                userProfileId = localStorage.getItem(USER_PROFILE_ID_KEY);
                
                if (!authToken || !userProfileId) {
                    // No auth token or profile ID - show login/signup modal
                    setTimeout(() => {
                        showProfileModal(true);
                    }, 1000);
                    return;
                }

                // Verify auth token matches stored profile
                const profileSnapshot = await database.ref(`userProfiles/${userProfileId}`).once('value');
                if (profileSnapshot.exists()) {
                    const profile = profileSnapshot.val();
                    // Verify token matches (simple check - token is userId + timestamp hash)
                    const expectedToken = hashPassword(userProfileId + (profile.createdAt || ''));
                    if (authToken === expectedToken || authToken === userProfileId) {
                        currentUserProfile = profile;
                        displayUserProfile();
                    } else {
                        // Invalid token - clear and show login
                        localStorage.removeItem(AUTH_TOKEN_KEY);
                        localStorage.removeItem(USER_PROFILE_ID_KEY);
                        userProfileId = null;
                        setTimeout(() => {
                            showProfileModal(true);
                        }, 1000);
                    }
                } else {
                    // Profile doesn't exist - clear auth and show signup
                    localStorage.removeItem(AUTH_TOKEN_KEY);
                    localStorage.removeItem(USER_PROFILE_ID_KEY);
                    userProfileId = null;
                    setTimeout(() => {
                        showProfileModal(true);
                    }, 1000);
                }
            } catch (error) {
                console.error('Error initializing profile system:', error);
            }
        }

        // Switch between signup and login tabs (global)
        window.switchProfileTab = function(tab) {
            const signupForm = document.getElementById('profileSignupForm');
            const loginForm = document.getElementById('profileLoginForm');
            const editForm = document.getElementById('profileEditForm');
            const signupTab = document.getElementById('profileSignupTab');
            const loginTab = document.getElementById('profileLoginTab');
            
            if (tab === 'signup') {
                if (signupForm) signupForm.style.display = 'block';
                if (loginForm) loginForm.style.display = 'none';
                if (editForm) editForm.style.display = 'none';
                if (signupTab) signupTab.classList.add('active');
                if (loginTab) loginTab.classList.remove('active');
            } else if (tab === 'login') {
                if (signupForm) signupForm.style.display = 'none';
                if (loginForm) loginForm.style.display = 'block';
                if (editForm) editForm.style.display = 'none';
                if (signupTab) signupTab.classList.remove('active');
                if (loginTab) loginTab.classList.add('active');
            }
        }

        // Show profile modal (for signup/login)
        function showProfileModal(isFirstTime = false) {
            const modal = document.getElementById('profileModalOverlay');
            const closeBtn = document.getElementById('profileModalCloseBtn');
            const title = document.getElementById('profileModalTitle');
            
            isFirstTimeProfile = isFirstTime;
            
            if (modal) {
                // Show signup/login forms, hide edit form
                const signupForm = document.getElementById('profileSignupForm');
                const loginForm = document.getElementById('profileLoginForm');
                const editForm = document.getElementById('profileEditForm');
                const tabSwitcher = document.getElementById('profileTabSwitcher');
                const signupTab = document.getElementById('profileSignupTab');
                const loginTab = document.getElementById('profileLoginTab');
                
                // Show tabs for signup/login
                if (tabSwitcher) tabSwitcher.style.display = 'flex';
                if (signupTab) signupTab.style.display = 'block';
                if (loginTab) loginTab.style.display = 'block';
                
                if (signupForm) signupForm.style.display = 'block';
                if (loginForm) loginForm.style.display = 'none';
                if (editForm) editForm.style.display = 'none';
                
                // Reset to signup tab
                switchProfileTab('signup');
                
                if (title) title.textContent = 'Sign Up / Login';
                
                // Clear form fields
                const usernameInput = document.getElementById('profileUsernameInput');
                const passwordInput = document.getElementById('profilePasswordInput');
                const loginUsernameInput = document.getElementById('loginUsernameInput');
                const loginPasswordInput = document.getElementById('loginPasswordInput');
                const bioInput = document.getElementById('profileBioInput');
                const avatarPreview = document.getElementById('profileAvatarPreview');
                
                if (usernameInput) usernameInput.value = '';
                if (passwordInput) passwordInput.value = '';
                if (loginUsernameInput) loginUsernameInput.value = '';
                if (loginPasswordInput) loginPasswordInput.value = '';
                if (bioInput) bioInput.value = '';
                if (avatarPreview) {
                    avatarPreview.src = 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Ccircle cx=%2260%22 cy=%2260%22 r=%2260%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2260%22 y=%2275%22 font-size=%2240%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E?%3C/text%3E%3C/svg%3E';
                }
                
                if (isFirstTime) {
                    // Hide close button for first-time users
                    if (closeBtn) closeBtn.style.display = 'none';
                    // Prevent closing by clicking outside
                    modal.onclick = function(e) {
                        if (e.target === modal) {
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        }
                    };
                    // Prevent Escape key
                    const escapeHandler = function(e) {
                        if (e.key === 'Escape' && isFirstTimeProfile) {
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        }
                    };
                    document.addEventListener('keydown', escapeHandler);
                    modal._escapeHandler = escapeHandler;
                } else {
                    // Show close button
                    if (closeBtn) closeBtn.style.display = 'flex';
                    // Allow closing by clicking outside
                    modal.onclick = function(e) {
                        if (e.target === modal) {
                            hideProfileModal();
                        }
                    };
                    // Remove escape handler if it exists
                    if (modal._escapeHandler) {
                        document.removeEventListener('keydown', modal._escapeHandler);
                        modal._escapeHandler = null;
                    }
                }
                modal.classList.add('active');
            }
        }

        // Show edit profile modal (for logged-in users) (global)
        window.showEditProfileModal = async function() {
            // Check if user is logged in by checking auth token and profile ID
            const authToken = localStorage.getItem(AUTH_TOKEN_KEY);
            const storedProfileId = localStorage.getItem(USER_PROFILE_ID_KEY);
            
            // If not logged in, show signup/login instead
            if (!authToken || !storedProfileId || !currentUserProfile || !userProfileId) {
                // User is not logged in, show signup/login
                showProfileModal(false);
                return;
            }
            
            // Ensure we have the latest profile data
            if (!currentUserProfile && userProfileId && firebaseInitialized && database) {
                try {
                    const profileSnapshot = await database.ref(`userProfiles/${userProfileId}`).once('value');
                    if (profileSnapshot.exists()) {
                        currentUserProfile = profileSnapshot.val();
                    } else {
                        // Profile doesn't exist, show signup/login
                        showProfileModal(false);
                        return;
                    }
                } catch (error) {
                    console.error('Error loading profile:', error);
                    showProfileModal(false);
                    return;
                }
            }

            const modal = document.getElementById('profileModalOverlay');
            const closeBtn = document.getElementById('profileModalCloseBtn');
            const title = document.getElementById('profileModalTitle');
            
            if (modal) {
                // Hide signup/login forms, show edit form
                const signupForm = document.getElementById('profileSignupForm');
                const loginForm = document.getElementById('profileLoginForm');
                const editForm = document.getElementById('profileEditForm');
                const signupTab = document.getElementById('profileSignupTab');
                const loginTab = document.getElementById('profileLoginTab');
                
                // Hide tabs
                if (signupTab) signupTab.style.display = 'none';
                if (loginTab) loginTab.style.display = 'none';
                
                // Hide signup/login forms, show edit form
                if (signupForm) signupForm.style.display = 'none';
                if (loginForm) loginForm.style.display = 'none';
                if (editForm) editForm.style.display = 'block';
                
                if (title) title.textContent = 'Edit Profile';
                if (closeBtn) closeBtn.style.display = 'flex';
                
                // Load current profile data
                const usernameInput = document.getElementById('editUsernameInput');
                const bioInput = document.getElementById('editBioInput');
                const avatarPreview = document.getElementById('editAvatarPreview');
                
                if (usernameInput) usernameInput.value = currentUserProfile.username || '';
                if (bioInput) bioInput.value = currentUserProfile.bio || '';
                if (avatarPreview) {
                    if (currentUserProfile.avatar) {
                        avatarPreview.src = currentUserProfile.avatar;
                    } else {
                        const initial = (currentUserProfile.username || '?').charAt(0).toUpperCase();
                        avatarPreview.src = `data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Ccircle cx=%2260%22 cy=%2260%22 r=%2260%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2260%22 y=%2275%22 font-size=%2240%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E${encodeURIComponent(initial)}%3C/text%3E%3C/svg%3E`;
                    }
                }
                
                // Allow closing
                modal.onclick = function(e) {
                    if (e.target === modal) {
                        hideProfileModal();
                    }
                };
                
                // Remove escape handler if it exists
                if (modal._escapeHandler) {
                    document.removeEventListener('keydown', modal._escapeHandler);
                    modal._escapeHandler = null;
                }
                
                modal.classList.add('active');
            }
        }

        // Hide profile modal
        function hideProfileModal() {
            // Don't allow closing if it's a first-time profile creation
            if (isFirstTimeProfile) {
                return;
            }
            
            const modal = document.getElementById('profileModalOverlay');
            if (modal) {
                modal.classList.remove('active');
            }
            const errorMsg = document.getElementById('profileErrorMessage');
            if (errorMsg) {
                errorMsg.classList.remove('show');
            }
        }

        // Handle profile avatar upload
        function handleProfileAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showProfileError('Please select an image file');
                return;
            }

            if (file.size > 2 * 1024 * 1024) {
                showProfileError('Image size must be less than 2MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const avatarPreview = document.getElementById('profileAvatarPreview');
                if (avatarPreview) {
                    avatarPreview.src = e.target.result;
                }
            };
            reader.readAsDataURL(file);
        }

        // Handle edit avatar upload (global)
        window.handleEditAvatarUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showProfileError('Please select an image file');
                return;
            }

            if (file.size > 2 * 1024 * 1024) {
                showProfileError('Image size must be less than 2MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const avatarPreview = document.getElementById('editAvatarPreview');
                if (avatarPreview) {
                    avatarPreview.src = e.target.result;
                }
            };
            reader.readAsDataURL(file);
        }

        // Show profile error
        function showProfileError(message) {
            const errorDiv = document.getElementById('profileErrorMessage');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.add('show');
                setTimeout(() => {
                    errorDiv.classList.remove('show');
                }, 5000);
            }
        }

        // Check if username is already taken
        async function isUsernameTaken(username, excludeUserId = null) {
            if (!firebaseInitialized || !database) return false;
            
            try {
                const profilesSnapshot = await database.ref('userProfiles').once('value');
                if (!profilesSnapshot.exists()) {
                    return false;
                }
                
                const profiles = profilesSnapshot.val();
                const usernameLower = username.toLowerCase().trim();
                
                for (const [userId, profile] of Object.entries(profiles)) {
                    // Skip the current user's profile if editing
                    if (excludeUserId && userId === excludeUserId) {
                        continue;
                    }
                    
                    const existingUsername = (profile.username || '').toLowerCase().trim();
                    if (existingUsername === usernameLower) {
                        return true;
                    }
                }
                
                return false;
            } catch (error) {
                console.error('Error checking username:', error);
                return false;
            }
        }

        // Signup new profile (global)
        window.signupProfile = async function() {
            if (!firebaseInitialized || !database) {
                showProfileError('Database not available. Please refresh the page.');
                return;
            }

            const usernameInput = document.getElementById('profileUsernameInput');
            const passwordInput = document.getElementById('profilePasswordInput');
            const bioInput = document.getElementById('profileBioInput');
            const avatarPreview = document.getElementById('profileAvatarPreview');
            const submitBtn = document.getElementById('profileSubmitBtn');

            if (!usernameInput || !passwordInput) return;

            const username = usernameInput.value.trim();
            const password = passwordInput.value;

            if (!username) {
                showProfileError('Please enter a username');
                return;
            }

            if (username.length < 3) {
                showProfileError('Username must be at least 3 characters');
                return;
            }

            if (username.length > 30) {
                showProfileError('Username must be less than 30 characters');
                return;
            }

            if (!password || password.length < 6) {
                showProfileError('Password must be at least 6 characters');
                return;
            }

            // Check if username is already taken
            const usernameTaken = await isUsernameTaken(username);
            if (usernameTaken) {
                showProfileError('This username is already taken. Please choose another one.');
                return;
            }

            try {
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Creating Account...';
                }

                // Generate new user ID
                userProfileId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const passwordHash = hashPassword(password);

                const profileData = {
                    username: username,
                    passwordHash: passwordHash,
                    bio: (bioInput ? bioInput.value.trim() : '') || '',
                    avatar: (avatarPreview && avatarPreview.src && !avatarPreview.src.includes('data:image/svg')) ? avatarPreview.src : null,
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    userId: userProfileId
                };

                await database.ref(`userProfiles/${userProfileId}`).set(profileData);
                currentUserProfile = profileData;

                // Store auth token
                const authToken = hashPassword(userProfileId + profileData.createdAt);
                localStorage.setItem(AUTH_TOKEN_KEY, authToken);
                localStorage.setItem(USER_PROFILE_ID_KEY, userProfileId);

                // Update display
                displayUserProfile();

                // Hide modal
                isFirstTimeProfile = false;
                const modal = document.getElementById('profileModalOverlay');
                const closeBtn = document.getElementById('profileModalCloseBtn');
                if (modal) {
                    modal.classList.remove('active');
                    if (closeBtn) closeBtn.style.display = 'flex';
                    modal.onclick = function(e) {
                        if (e.target === modal) {
                            hideProfileModal();
                        }
                    };
                    if (modal._escapeHandler) {
                        document.removeEventListener('keydown', modal._escapeHandler);
                        modal._escapeHandler = null;
                    }
                }

                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Sign Up';
                }
            } catch (error) {
                console.error('Error signing up:', error);
                showProfileError('Error creating account. Please try again.');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Sign Up';
                }
            }
        }

        // Login to existing profile (global)
        window.loginProfile = async function() {
            if (!firebaseInitialized || !database) {
                showProfileError('Database not available. Please refresh the page.');
                return;
            }

            const usernameInput = document.getElementById('loginUsernameInput');
            const passwordInput = document.getElementById('loginPasswordInput');
            const loginBtn = document.getElementById('profileLoginBtn');

            if (!usernameInput || !passwordInput) return;

            const username = usernameInput.value.trim();
            const password = passwordInput.value;

            if (!username) {
                showProfileError('Please enter your username');
                return;
            }

            if (!password) {
                showProfileError('Please enter your password');
                return;
            }

            try {
                if (loginBtn) {
                    loginBtn.disabled = true;
                    loginBtn.textContent = 'Logging in...';
                }

                // Find user by username
                const profilesSnapshot = await database.ref('userProfiles').once('value');
                if (!profilesSnapshot.exists()) {
                    showProfileError('Invalid username or password');
                    if (loginBtn) {
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Login';
                    }
                    return;
                }

                const profiles = profilesSnapshot.val();
                let foundProfile = null;
                let foundUserId = null;

                for (const [userId, profile] of Object.entries(profiles)) {
                    if ((profile.username || '').toLowerCase().trim() === username.toLowerCase().trim()) {
                        foundProfile = profile;
                        foundUserId = userId;
                        break;
                    }
                }

                if (!foundProfile) {
                    showProfileError('Invalid username or password');
                    if (loginBtn) {
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Login';
                    }
                    return;
                }

                // Verify password
                const passwordHash = hashPassword(password);
                if (foundProfile.passwordHash !== passwordHash) {
                    showProfileError('Invalid username or password');
                    if (loginBtn) {
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Login';
                    }
                    return;
                }

                // Login successful
                userProfileId = foundUserId;
                currentUserProfile = foundProfile;

                // Store auth token
                const authToken = hashPassword(userProfileId + (foundProfile.createdAt || ''));
                localStorage.setItem(AUTH_TOKEN_KEY, authToken);
                localStorage.setItem(USER_PROFILE_ID_KEY, userProfileId);

                // Update display
                displayUserProfile();

                // Hide modal
                isFirstTimeProfile = false;
                const modal = document.getElementById('profileModalOverlay');
                const closeBtn = document.getElementById('profileModalCloseBtn');
                if (modal) {
                    modal.classList.remove('active');
                    if (closeBtn) closeBtn.style.display = 'flex';
                    modal.onclick = function(e) {
                        if (e.target === modal) {
                            hideProfileModal();
                        }
                    };
                    if (modal._escapeHandler) {
                        document.removeEventListener('keydown', modal._escapeHandler);
                        modal._escapeHandler = null;
                    }
                }

                if (loginBtn) {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Login';
                }
            } catch (error) {
                console.error('Error logging in:', error);
                showProfileError('Error logging in. Please try again.');
                if (loginBtn) {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Login';
                }
            }
        }

        // Logout function (global)
        window.logoutProfile = function() {
            // Clear auth data
            localStorage.removeItem(AUTH_TOKEN_KEY);
            localStorage.removeItem(USER_PROFILE_ID_KEY);
            currentUserProfile = null;
            userProfileId = null;
            isFirstTimeProfile = false;
            
            // Hide profile button
            const container = document.getElementById('userProfileContainer');
            if (container) container.style.display = 'none';
            
            // Close any open modals
            const modal = document.getElementById('profileModalOverlay');
            if (modal) {
                modal.classList.remove('active');
                // Remove any escape handlers
                if (modal._escapeHandler) {
                    document.removeEventListener('keydown', modal._escapeHandler);
                    modal._escapeHandler = null;
                }
            }
            
            // Show login/signup modal (not mandatory, user can close it)
            setTimeout(() => {
                showProfileModal(false);
            }, 300);
        }

        // Display user profile in header
        function displayUserProfile() {
            if (!currentUserProfile) return;

            const container = document.getElementById('userProfileContainer');
            const avatar = document.getElementById('userProfileAvatar');
            const name = document.getElementById('userProfileName');

            if (container) container.style.display = 'block';
            if (avatar) {
                if (currentUserProfile.avatar) {
                    avatar.src = currentUserProfile.avatar;
                } else {
                    // Generate initial avatar
                    const initial = (currentUserProfile.username || '?').charAt(0).toUpperCase();
                    avatar.src = `data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2232%22 height=%2232%22%3E%3Ccircle cx=%2216%22 cy=%2216%22 r=%2216%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2216%22 y=%2220%22 font-size=%2214%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E${encodeURIComponent(initial)}%3C/text%3E%3C/svg%3E`;
                }
            }
            if (name) name.textContent = currentUserProfile.username || 'Profile';
        }

        // Update profile (for editing existing profile) (global)
        window.updateProfile = async function() {
            if (!firebaseInitialized || !database || !userProfileId) {
                showProfileError('Database not available. Please refresh the page.');
                return;
            }

            const usernameInput = document.getElementById('editUsernameInput');
            const bioInput = document.getElementById('editBioInput');
            const avatarPreview = document.getElementById('editAvatarPreview');
            const submitBtn = document.getElementById('profileEditBtn');

            if (!usernameInput) return;

            const username = usernameInput.value.trim();
            if (!username) {
                showProfileError('Please enter a username');
                return;
            }

            if (username.length < 3) {
                showProfileError('Username must be at least 3 characters');
                return;
            }

            if (username.length > 30) {
                showProfileError('Username must be less than 30 characters');
                return;
            }

            // Check if username is already taken (excluding current user)
            const usernameTaken = await isUsernameTaken(username, userProfileId);
            if (usernameTaken) {
                showProfileError('This username is already taken. Please choose another one.');
                return;
            }

            try {
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Saving...';
                }

                const profileData = {
                    ...currentUserProfile,
                    username: username,
                    bio: (bioInput ? bioInput.value.trim() : '') || '',
                    avatar: (avatarPreview && avatarPreview.src && !avatarPreview.src.includes('data:image/svg')) ? avatarPreview.src : currentUserProfile.avatar,
                    updatedAt: Date.now()
                };

                await database.ref(`userProfiles/${userProfileId}`).update(profileData);
                currentUserProfile = profileData;

                // Update display
                displayUserProfile();

                // Hide modal
                hideProfileModal();

                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Save Changes';
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                showProfileError('Error updating profile. Please try again.');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Save Changes';
                }
            }
        }

        // Get user profile for ticket messages
        async function getUserProfileForTicket(userId) {
            if (!firebaseInitialized || !database) return null;
            
            try {
                const profileSnapshot = await database.ref(`userProfiles/${userId}`).once('value');
                if (profileSnapshot.exists()) {
                    return profileSnapshot.val();
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
            return null;
        }

        // View user profile from review click (global function)
        window.viewUserProfileFromReview = async function(userId) {
            if (!firebaseInitialized || !database) {
                alert('Unable to load profile. Please try again later.');
                return;
            }

            try {
                const profileSnapshot = await database.ref(`userProfiles/${userId}`).once('value');
                if (!profileSnapshot.exists()) {
                    alert('Profile not found');
                    return;
                }

                const profile = profileSnapshot.val();
                const avatarSrc = profile.avatar || `data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Ccircle cx=%2260%22 cy=%2260%22 r=%2260%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2260%22 y=%2275%22 font-size=%2240%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E${encodeURIComponent((profile.username || '?').charAt(0).toUpperCase())}%3C/text%3E%3C/svg%3E`;
                const createdDate = profile.createdAt ? new Date(profile.createdAt).toLocaleString() : 'Unknown';
                const updatedDate = profile.updatedAt ? new Date(profile.updatedAt).toLocaleString() : 'Unknown';

                // Create modal to display profile
                const modal = document.createElement('div');
                modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 20000; display: flex; align-items: center; justify-content: center;';
                modal.onclick = function(e) {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                };

                modal.innerHTML = `
                    <div style="background: #0a0a0a; border: 1px solid #1a1a1a; border-radius: 12px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; padding: 24px; position: relative;">
                        <button onclick="this.closest('div[style*=\\'position: fixed\\']').remove()" style="position: absolute; top: 16px; right: 16px; background: none; border: none; color: #888; font-size: 28px; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; transition: all 0.3s;" onmouseover="this.style.color='#ef4444'; this.style.transform='rotate(90deg)'" onmouseout="this.style.color='#888'; this.style.transform='rotate(0deg)'">×</button>
                        <div style="text-align: center; margin-bottom: 24px;">
                            <img src="${escapeHtml(avatarSrc)}" alt="${escapeHtml(profile.username || 'User')}" 
                                 style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid rgba(74, 74, 74, 0.5); margin-bottom: 16px;"
                                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Ccircle cx=%2260%22 cy=%2260%22 r=%2260%22 fill=%22%233a3a3a%22/%3E%3C/svg%3E'">
                            <h3 style="margin: 0 0 8px 0; color: #e5e5e5; font-size: 24px;">${escapeHtml(profile.username || 'Unknown')}</h3>
                            <p style="color: #888; margin: 0; font-size: 12px;">User ID: ${escapeHtml(userId)}</p>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <strong style="color: #c0c0c0; display: block; margin-bottom: 8px;">Bio:</strong>
                            <p style="color: #e5e5e5; margin: 0; line-height: 1.6;">${escapeHtml(profile.bio || 'No bio provided')}</p>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <strong style="color: #c0c0c0; display: block; margin-bottom: 8px;">Member Since:</strong>
                            <p style="color: #e5e5e5; margin: 0;">${createdDate}</p>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <strong style="color: #c0c0c0; display: block; margin-bottom: 8px;">Last Updated:</strong>
                            <p style="color: #e5e5e5; margin: 0;">${updatedDate}</p>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            } catch (error) {
                console.error('Error viewing profile:', error);
                alert('Error loading profile: ' + (error.message || 'Unknown error'));
            }
        }

        // Real-time listeners for blacklist and maintenance
        let blacklistListener = null;
        let maintenanceListener = null;
        let currentMaintenanceState = null;

        // Setup real-time blacklist listener
        async function setupBlacklistListener() {
            if (!firebaseInitialized || !database) return;
            
            try {
                // Check if user is admin first (admins can always access)
                const isAdmin = sessionStorage.getItem('recon_admin_session') === 'true';
                if (isAdmin) return; // Admins bypass blacklist
                
                // Don't setup listener if already on blacklist page
                if (window.location.pathname.includes('blacklist') || window.location.pathname.includes('/blacklist')) {
                    return;
                }
                
                const ip = await getClientIP();
                const ipKey = ip.replace(/\./g, '_');
                
                // Remove existing listener if any
                if (blacklistListener) {
                    database.ref('blacklist').off('value', blacklistListener);
                }
                
                // Setup real-time listener
                blacklistListener = database.ref('blacklist').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const blacklist = snapshot.val();
                        
                        if (blacklist[ipKey]) {
                            // User is blacklisted - redirect to blacklist page
                            window.location.href = '/blacklist';
                        }
                    }
                });
                
                console.log('✅ Real-time blacklist listener active');
            } catch (error) {
                console.error('Error setting up blacklist listener:', error);
            }
        }

        // Setup real-time maintenance mode listener
        function setupMaintenanceListener() {
            if (!firebaseInitialized || !database) return;
            
            try {
                // Remove existing listener if any
                if (maintenanceListener) {
                    database.ref('maintenance').off('value', maintenanceListener);
                }
                
                // Setup real-time listener
                maintenanceListener = database.ref('maintenance').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const maintenance = snapshot.val();
                        
                        // Check if user is admin
                        const isAdmin = sessionStorage.getItem('recon_admin_session') === 'true';
                        
                        if (maintenance.enabled && !isAdmin) {
                            // Maintenance is enabled - show maintenance page
                            if (!currentMaintenanceState || currentMaintenanceState.enabled !== maintenance.enabled) {
                                showMaintenancePage(maintenance);
                                currentMaintenanceState = maintenance;
                            }
                        } else {
                            // Maintenance is disabled or user is admin - hide maintenance page if it was shown
                            if (currentMaintenanceState && currentMaintenanceState.enabled) {
                                // Reload page to show normal content
                                window.location.reload();
                            }
                            currentMaintenanceState = maintenance;
                        }
                    } else {
                        // No maintenance data - ensure page is normal
                        if (currentMaintenanceState && currentMaintenanceState.enabled) {
                            window.location.reload();
                        }
                        currentMaintenanceState = null;
                    }
                });
                
                console.log('✅ Real-time maintenance listener active');
            } catch (error) {
                console.error('Error setting up maintenance listener:', error);
            }
        }

        // Legacy function for initial check (kept for compatibility)
        async function checkBlacklist() {
            if (!firebaseInitialized || !database) return false;
            
            try {
                const isAdmin = sessionStorage.getItem('recon_admin_session') === 'true';
                if (isAdmin) return false;
                
                if (window.location.pathname.includes('blacklist') || window.location.pathname.includes('/blacklist')) {
                    return false;
                }
                
                const ip = await getClientIP();
                const ipKey = ip.replace(/\./g, '_');
                const blacklistSnapshot = await database.ref('blacklist').once('value');
                
                if (blacklistSnapshot.exists()) {
                    const blacklist = blacklistSnapshot.val();
                    if (blacklist[ipKey]) {
                        window.location.href = '/blacklist';
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('Error checking blacklist:', error);
                return false;
            }
        }

        // Legacy function for initial check (kept for compatibility)
        async function checkMaintenanceMode() {
            if (!firebaseInitialized || !database) return;
            
            try {
                const snapshot = await database.ref('maintenance').once('value');
                if (snapshot.exists()) {
                    const maintenance = snapshot.val();
                    if (maintenance.enabled) {
                        const isAdmin = sessionStorage.getItem('recon_admin_session') === 'true';
                        if (!isAdmin) {
                            showMaintenancePage(maintenance);
                            currentMaintenanceState = maintenance;
                        }
                    }
                }
            } catch (error) {
                console.error('Error checking maintenance mode:', error);
            }
        }

        // Show maintenance page
        function showMaintenancePage(maintenance) {
            document.body.innerHTML = `
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    body {
                        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
                        color: #e5e5e5;
                        min-height: 100vh;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 20px;
                    }
                    .maintenance-container {
                        text-align: center;
                        max-width: 600px;
                        background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(37, 37, 37, 0.95) 100%);
                        border: 1px solid rgba(59, 130, 246, 0.2);
                        border-radius: 20px;
                        padding: 60px 40px;
                        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8);
                    }
                    .maintenance-icon {
                        font-size: 80px;
                        margin-bottom: 30px;
                        animation: pulse 2s ease infinite;
                    }
                    @keyframes pulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.1); }
                    }
                    .maintenance-title {
                        font-size: 32px;
                        font-weight: 800;
                        margin-bottom: 20px;
                        background: linear-gradient(135deg, #ffffff 0%, #a0a0a0 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    .maintenance-message {
                        font-size: 18px;
                        color: #888;
                        line-height: 1.6;
                        margin-bottom: 30px;
                    }
                    .maintenance-time {
                        font-size: 14px;
                        color: #666;
                        margin-top: 20px;
                    }
                    .admin-login-link {
                        display: inline-block;
                        margin-top: 30px;
                        padding: 12px 24px;
                        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                        color: white;
                        text-decoration: none;
                        border-radius: 8px;
                        font-weight: 600;
                        transition: all 0.3s;
                        border: 1px solid rgba(59, 130, 246, 0.3);
                    }
                    .admin-login-link:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
                    }
                    .admin-modal-overlay {
                        display: none;
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.9);
                        z-index: 10000;
                        align-items: center;
                        justify-content: center;
                        backdrop-filter: blur(10px);
                    }
                    .admin-modal-overlay.active {
                        display: flex;
                    }
                    .admin-modal {
                        background: linear-gradient(135deg, rgba(26, 26, 26, 0.98) 0%, rgba(37, 37, 37, 0.98) 100%);
                        border: 1px solid rgba(59, 130, 246, 0.3);
                        border-radius: 20px;
                        padding: 30px;
                        max-width: 400px;
                        width: 90%;
                        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8);
                    }
                    .admin-modal-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px;
                    }
                    .admin-modal-header h2 {
                        color: #e5e5e5;
                        font-size: 24px;
                        margin: 0;
                    }
                    .admin-modal-close {
                        background: rgba(239, 68, 68, 0.1);
                        border: 1px solid rgba(239, 68, 68, 0.3);
                        border-radius: 8px;
                        width: 36px;
                        height: 36px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        color: #ef4444;
                        font-size: 24px;
                        transition: all 0.2s;
                    }
                    .admin-modal-close:hover {
                        background: rgba(239, 68, 68, 0.2);
                    }
                    .admin-form-group {
                        margin-bottom: 20px;
                    }
                    .admin-form-group label {
                        display: block;
                        color: #e5e5e5;
                        font-size: 14px;
                        margin-bottom: 8px;
                        font-weight: 600;
                    }
                    .admin-form-input {
                        width: 100%;
                        padding: 12px 16px;
                        background: rgba(0, 0, 0, 0.4);
                        border: 1px solid rgba(74, 74, 74, 0.6);
                        border-radius: 8px;
                        color: #e5e5e5;
                        font-size: 14px;
                        transition: all 0.3s;
                    }
                    .admin-form-input:focus {
                        outline: none;
                        border-color: #3b82f6;
                        background: rgba(0, 0, 0, 0.6);
                        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
                    }
                    .admin-submit-btn {
                        width: 100%;
                        padding: 14px;
                        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                        border: 1px solid rgba(59, 130, 246, 0.3);
                        border-radius: 10px;
                        color: white;
                        font-size: 15px;
                        font-weight: 700;
                        cursor: pointer;
                        transition: all 0.3s;
                        margin-top: 10px;
                    }
                    .admin-submit-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
                    }
                    .admin-error-message {
                        color: #ef4444;
                        font-size: 13px;
                        margin-bottom: 16px;
                        display: none;
                    }
                    .admin-error-message.show {
                        display: block;
                    }
                </style>
                <div class="maintenance-container">
                    <div class="maintenance-icon">🔧</div>
                    <h1 class="maintenance-title">Under Maintenance</h1>
                    <p class="maintenance-message">${escapeHtml(maintenance.message || 'We\'re currently performing scheduled maintenance. We\'ll be back shortly!')}</p>
                    ${maintenance.returnTime ? '<p class="maintenance-time">Estimated return: ' + new Date(maintenance.returnTime).toLocaleString() + '</p>' : ''}
                    <a href="#" class="admin-login-link" onclick="event.preventDefault(); window.showMaintenanceAdminLogin();">Admin Login</a>
                </div>
                
                <!-- Admin Login Modal -->
                <div class="admin-modal-overlay" id="maintenanceAdminModal">
                    <div class="admin-modal">
                        <div class="admin-modal-header">
                            <h2>Admin Login</h2>
                            <button class="admin-modal-close" onclick="window.hideMaintenanceAdminLogin()">×</button>
                        </div>
                        <div class="admin-modal-body">
                            <div class="admin-form-group">
                            <p style="color: #888; font-size: 14px; margin-bottom: 16px;">Admin access is restricted to authorized IP addresses only.</p>
                            </div>
                            <div class="admin-error-message" id="maintenanceAdminError"></div>
                            <button class="admin-submit-btn" onclick="window.handleMaintenanceAdminLogin()">Login</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize maintenance admin login functions (IP-based)
            (function() {
                const ALLOWED_ADMIN_IPS = ['172.56.41.249', '74.14.72.29'];
                
                async function checkMaintenanceAdminIP() {
                    try {
                        const ip = await getClientIP();
                        return ALLOWED_ADMIN_IPS.includes(ip);
                    } catch (error) {
                        console.error('Error checking admin IP:', error);
                        return false;
                    }
                }
                
                window.showMaintenanceAdminLogin = function() {
                    const modal = document.getElementById('maintenanceAdminModal');
                    if (modal) {
                        modal.classList.add('active');
                    }
                };
                
                window.hideMaintenanceAdminLogin = function() {
                    const modal = document.getElementById('maintenanceAdminModal');
                    const errorDiv = document.getElementById('maintenanceAdminError');
                    if (modal) modal.classList.remove('active');
                    if (errorDiv) errorDiv.classList.remove('show');
                };
                
                window.handleMaintenanceAdminLogin = async function() {
                    const errorDiv = document.getElementById('maintenanceAdminError');
                    
                    if (!errorDiv) return;
                    
                    try {
                        const isAllowedIP = await checkMaintenanceAdminIP();
                        
                        if (isAllowedIP) {
                            sessionStorage.setItem('recon_admin_session', 'true');
                            window.hideMaintenanceAdminLogin();
                            window.location.reload();
                        } else {
                            const ip = await getClientIP();
                            errorDiv.textContent = `Access denied. Your IP (${ip}) is not authorized.`;
                            errorDiv.classList.add('show');
                            console.warn('❌ Maintenance admin login denied - IP not in allowed list:', ip);
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        errorDiv.textContent = 'Error verifying IP address. Please try again.';
                        errorDiv.classList.add('show');
                    }
                };
            })();
        }

        // ============================================
        // FEATURE #18: Multi-Language Support
        // ============================================
        const TRANSLATIONS_PATH = 'translations';
        const LANGUAGE_KEY = 'recon_language';
        let currentLanguage = localStorage.getItem(LANGUAGE_KEY) || 'en';
        let translations = {};

        // Default translations (fallback)
        const defaultTranslations = {
            en: {
                'changelog.title': 'What\'s New',
                'changelog.subtitle': 'Latest updates and improvements',
                'changelog.loading': 'Loading changelog...',
                'changelog.empty': 'No changelog entries yet.',
                'changelog.error': 'Unable to load changelog.',
                'hero.title': 'RECON-SPOOFER',
                'hero.tagline': 'Simple. Secure. Reliable.',
                'hero.download': 'Download Installer',
                'hero.downloads': 'Downloads',
                'hero.rating': 'Rating',
                'features.title': 'Key Features',
                'features.subtitle': 'Everything you need in one powerful package'
            },
            es: {
                'changelog.title': 'Novedades',
                'changelog.subtitle': 'Últimas actualizaciones y mejoras',
                'changelog.loading': 'Cargando historial...',
                'changelog.empty': 'Aún no hay entradas en el historial.',
                'changelog.error': 'No se pudo cargar el historial.',
                'hero.title': 'RECON-SPOOFER',
                'hero.tagline': 'Simple. Seguro. Confiable.',
                'hero.download': 'Descargar Instalador',
                'hero.downloads': 'Descargas',
                'hero.rating': 'Calificación',
                'features.title': 'Características Principales',
                'features.subtitle': 'Todo lo que necesitas en un paquete poderoso'
            },
            fr: {
                'changelog.title': 'Nouveautés',
                'changelog.subtitle': 'Dernières mises à jour et améliorations',
                'changelog.loading': 'Chargement du journal...',
                'changelog.empty': 'Aucune entrée dans le journal pour le moment.',
                'changelog.error': 'Impossible de charger le journal.',
                'hero.title': 'RECON-SPOOFER',
                'hero.tagline': 'Simple. Sécurisé. Fiable.',
                'hero.download': 'Télécharger l\'Installateur',
                'hero.downloads': 'Téléchargements',
                'hero.rating': 'Note',
                'features.title': 'Fonctionnalités Clés',
                'features.subtitle': 'Tout ce dont vous avez besoin dans un package puissant'
            },
            de: {
                'changelog.title': 'Was ist neu',
                'changelog.subtitle': 'Neueste Updates und Verbesserungen',
                'changelog.loading': 'Lade Änderungsprotokoll...',
                'changelog.empty': 'Noch keine Einträge im Änderungsprotokoll.',
                'changelog.error': 'Änderungsprotokoll konnte nicht geladen werden.',
                'hero.title': 'RECON-SPOOFER',
                'hero.tagline': 'Einfach. Sicher. Zuverlässig.',
                'hero.download': 'Installer herunterladen',
                'hero.downloads': 'Downloads',
                'hero.rating': 'Bewertung',
                'features.title': 'Hauptfunktionen',
                'features.subtitle': 'Alles was Sie brauchen in einem leistungsstarken Paket'
            },
            pt: {
                'changelog.title': 'Novidades',
                'changelog.subtitle': 'Últimas atualizações e melhorias',
                'changelog.loading': 'Carregando changelog...',
                'changelog.empty': 'Ainda não há entradas no changelog.',
                'changelog.error': 'Não foi possível carregar o changelog.',
                'hero.title': 'RECON-SPOOFER',
                'hero.tagline': 'Simples. Seguro. Confiável.',
                'hero.download': 'Baixar Instalador',
                'hero.downloads': 'Downloads',
                'hero.rating': 'Avaliação',
                'features.title': 'Recursos Principais',
                'features.subtitle': 'Tudo que você precisa em um pacote poderoso'
            }
        };

        async function loadTranslations(lang) {
            if (!firebaseInitialized || !database) {
                translations[lang] = defaultTranslations[lang] || defaultTranslations.en;
                updateTranslations();
                return;
            }

            try {
                const snapshot = await database.ref(`${TRANSLATIONS_PATH}/${lang}`).once('value');
                if (snapshot.exists()) {
                    translations[lang] = { ...defaultTranslations[lang], ...snapshot.val() };
                } else {
                    translations[lang] = defaultTranslations[lang] || defaultTranslations.en;
                }
                updateTranslations();
            } catch (error) {
                console.error('Error loading translations:', error);
                translations[lang] = defaultTranslations[lang] || defaultTranslations.en;
                updateTranslations();
            }
        }

        function updateTranslations() {
            const lang = currentLanguage;
            const langTranslations = translations[lang] || defaultTranslations[lang] || defaultTranslations.en;

            console.log('📝 Updating translations for language:', lang);
            console.log('📝 Available translations:', Object.keys(langTranslations));

            // Update all elements with data-i18n attribute
            const elements = document.querySelectorAll('[data-i18n]');
            console.log('📝 Found', elements.length, 'elements with data-i18n attribute');
            
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = langTranslations[key];
                if (translation) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translation;
                    } else {
                        element.textContent = translation;
                    }
                    console.log('✅ Updated:', key, '=', translation);
                } else {
                    console.warn('⚠️ No translation found for key:', key);
                }
            });

            // Update language button
            const langBtn = document.getElementById('currentLang');
            if (langBtn) {
                langBtn.textContent = lang.toUpperCase();
            }

            // Update active language option
            document.querySelectorAll('.lang-option').forEach(option => {
                if (option.getAttribute('data-lang') === lang) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        }

        function changeLanguage(lang) {
            console.log('🔄 Changing language to:', lang);
            currentLanguage = lang;
            localStorage.setItem(LANGUAGE_KEY, lang);
            loadTranslations(lang);
        }

        // Initialize language system
        function initLanguageSystem() {
            console.log('🌍 Initializing language system, current language:', currentLanguage);
            
            // Load current language translations
            loadTranslations(currentLanguage);

            // Setup language switcher
            const langBtn = document.getElementById('langBtn');
            const langDropdown = document.getElementById('langDropdown');

            if (!langBtn || !langDropdown) {
                console.error('❌ Language switcher elements not found!');
                return;
            }

            console.log('✅ Language switcher elements found');

            langBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                langDropdown.classList.toggle('show');
                console.log('🔘 Language dropdown toggled');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!langBtn.contains(e.target) && !langDropdown.contains(e.target)) {
                    langDropdown.classList.remove('show');
                }
            });

            // Language option clicks
            document.querySelectorAll('.lang-option').forEach(option => {
                option.addEventListener('click', () => {
                    const lang = option.getAttribute('data-lang');
                    console.log('🌐 Language changed to:', lang);
                    changeLanguage(lang);
                    langDropdown.classList.remove('show');
                });
            });
        }

        // Download tracking with Firebase (global counter)
        const DOWNLOAD_COUNT_PATH = 'downloads/count';
        
        // Get download count from Firebase
        async function getDownloadCount() {
            if (!firebaseInitialized || !database) {
                // Fallback to localStorage if Firebase not configured
                const count = localStorage.getItem('recon_spoofer_downloads');
                return count ? parseInt(count, 10) : 0;
            }

            try {
                const snapshot = await database.ref(DOWNLOAD_COUNT_PATH).once('value');
                const count = snapshot.val();
                return count ? parseInt(count, 10) : 0;
            } catch (error) {
                console.error('Error getting download count:', error);
                return 0;
            }
        }
        
        // Increment download count in Firebase
        async function incrementDownloadCount() {
            if (!firebaseInitialized || !database) {
                // Fallback to localStorage
                const currentCount = parseInt(localStorage.getItem('recon_spoofer_downloads') || '0', 10);
                const newCount = currentCount + 1;
                localStorage.setItem('recon_spoofer_downloads', newCount.toString());
                return newCount;
            }

            try {
                // Get current count first
                const currentSnapshot = await database.ref(DOWNLOAD_COUNT_PATH).once('value');
                const currentCount = currentSnapshot.val() || 0;
                const newCount = currentCount + 1;
                
                // Set the new value (Security Rules will validate it's only +1)
                await database.ref(DOWNLOAD_COUNT_PATH).set(newCount);
                
                // If using rate-limited rules, update lastWrite timestamp
                try {
                    await database.ref('downloads/lastWrite').set(Date.now());
                } catch (e) {
                    // Ignore if lastWrite doesn't exist (not using rate-limited rules)
                }
                
                return newCount;
            } catch (error) {
                console.error('Error incrementing download count:', error);
                // If security rules reject it, fallback to localStorage
                const currentCount = parseInt(localStorage.getItem('recon_spoofer_downloads') || '0', 10);
                const newCount = currentCount + 1;
                localStorage.setItem('recon_spoofer_downloads', newCount.toString());
                return newCount;
            }
        }
        
        // Listen for real-time updates to download count
        function setupDownloadCountListener() {
            if (!firebaseInitialized || !database) {
                return;
            }

            try {
                const counterElement = document.getElementById('downloadCount');
                if (!counterElement) return;

                database.ref(DOWNLOAD_COUNT_PATH).on('value', (snapshot) => {
                    const count = snapshot.val() || 0;
                    const oldCount = parseInt(counterElement.getAttribute('data-count') || '0', 10);
                    
                    if (count !== oldCount) {
                        counterElement.setAttribute('data-count', count);
                        animateCounterFromTo(counterElement, oldCount, count);
                    }
                }, (error) => {
                    console.error('Error listening to download count:', error);
                });
            } catch (error) {
                console.error('Error setting up download count listener:', error);
            }
        }
        
        // Update download counter display
        async function updateDownloadCounterDisplay() {
            const count = await getDownloadCount();
            const counterElement = document.getElementById('downloadCount');
            if (counterElement) {
                counterElement.setAttribute('data-count', count);
                // Only animate if this is the initial load
                if (!counterElement.hasAttribute('data-initialized')) {
                    animateCounter(counterElement);
                    counterElement.setAttribute('data-initialized', 'true');
                }
            }
        }

        // Rating System
        const RATINGS_PATH = 'ratings';
        const RATING_STORAGE_KEY = 'recon_spoofer_rated';
        let selectedRating = 0;
        let hasRated = false;

        // Check if user has already rated
        function checkIfRated() {
            hasRated = localStorage.getItem(RATING_STORAGE_KEY) === 'true';
            if (hasRated) {
                const starInputs = document.querySelectorAll('.star-input');
                starInputs.forEach(star => {
                    star.style.pointerEvents = 'none';
                    star.style.opacity = '0.5';
                });
                document.getElementById('ratingSubmitBtn').disabled = true;
                document.getElementById('ratingSubmitBtn').textContent = 'Already Rated';
            }
        }

        // Get average rating from Firebase
        async function getAverageRating() {
            if (!firebaseInitialized || !database) {
                return { average: 0, count: 0 };
            }

            try {
                const snapshot = await database.ref(RATINGS_PATH).once('value');
                if (!snapshot.exists()) {
                    return { average: 0, count: 0 };
                }

                const ratings = snapshot.val();
                const ratingValues = Object.values(ratings).map(r => r.rating || r);
                const sum = ratingValues.reduce((a, b) => a + b, 0);
                const count = ratingValues.length;
                const average = count > 0 ? sum / count : 0;

                return { average: parseFloat(average.toFixed(1)), count };
            } catch (error) {
                console.error('Error getting average rating:', error);
                return { average: 0, count: 0 };
            }
        }

        // Update rating display
        async function updateRatingDisplay() {
            const { average, count } = await getAverageRating();
            
            // Update stats bar
            const ratingDisplay = document.getElementById('ratingDisplay');
            if (ratingDisplay) {
                ratingDisplay.setAttribute('data-count', average);
                if (!ratingDisplay.hasAttribute('data-initialized')) {
                    animateCounter(ratingDisplay);
                    ratingDisplay.setAttribute('data-initialized', 'true');
                } else {
                    const oldValue = parseFloat(ratingDisplay.getAttribute('data-count') || '0');
                    if (oldValue !== average) {
                        animateCounterFromTo(ratingDisplay, oldValue, average);
                    }
                }
            }

            // Update rating section
            const ratingValue = document.getElementById('ratingValue');
            const ratingCount = document.getElementById('ratingCount');
            const ratingStarsDisplay = document.getElementById('ratingStarsDisplay');

            if (ratingValue) ratingValue.textContent = average.toFixed(1);
            if (ratingCount) ratingCount.textContent = `(${count} ${count === 1 ? 'rating' : 'ratings'})`;

            if (ratingStarsDisplay) {
                const stars = ratingStarsDisplay.querySelectorAll('.star');
                const fullStars = Math.floor(average);
                const hasHalfStar = (average % 1) >= 0.5;

                stars.forEach((star, index) => {
                    star.classList.remove('filled', 'half');
                    if (index < fullStars) {
                        star.classList.add('filled');
                    } else if (index === fullStars && hasHalfStar) {
                        star.classList.add('half');
                    }
                });
            }
        }

        // Submit rating
        async function submitRating(rating) {
            if (!firebaseInitialized || !database) {
                showRatingMessage('Error: Firebase not connected', 'error');
                return;
            }

            if (hasRated) {
                showRatingMessage('You have already submitted a rating', 'error');
                return;
            }

            try {
                let reviewText = document.getElementById('reviewText').value.trim();
                
                // Filter review text before submission
                if (reviewText && reviewText.length > 0) {
                    const filterResult = filterText(reviewText);
                    if (filterResult.filtered) {
                        let errorMsg = 'Your review contains inappropriate content.';
                        switch (filterResult.reason) {
                            case 'spam_pattern':
                                errorMsg = 'Your review contains spam patterns. Please write a genuine review.';
                                break;
                            case 'excessive_special_chars':
                                errorMsg = 'Your review contains too many special characters.';
                                break;
                            case 'word_repetition':
                                errorMsg = 'Your review contains excessive word repetition.';
                                break;
                            case 'character_repetition':
                                errorMsg = 'Your review contains suspicious character patterns.';
                                break;
                            case 'excessive_caps':
                                errorMsg = 'Your review contains excessive capitalization.';
                                break;
                            case 'suspicious_pattern':
                                errorMsg = 'Your review contains suspicious patterns.';
                                break;
                            case 'too_short':
                                errorMsg = 'Your review is too short. Please write a meaningful review.';
                                break;
                            case 'inappropriate_language':
                            default:
                                errorMsg = 'Your review contains inappropriate content. Please keep it professional.';
                                break;
                        }
                        showRatingMessage(errorMsg, 'error');
                        return;
                    }
                    reviewText = filterResult.text;
                }
                
                // Generate unique rating ID
                const ratingId = 'rating_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const ratingRef = database.ref(RATINGS_PATH + '/' + ratingId);

                const ratingData = {
                    rating: rating,
                    timestamp: Date.now(),
                    userId: userProfileId || null  // Link review to user profile
                };

                // Only add review text if provided
                if (reviewText && reviewText.length > 0) {
                    ratingData.review = reviewText;
                }

                await ratingRef.set(ratingData);

                // Mark as rated
                localStorage.setItem(RATING_STORAGE_KEY, 'true');
                hasRated = true;

                // Update UI
                checkIfRated();
                await updateRatingDisplay();
                showRatingMessage('Thank you for your rating!', 'success');

                // Reset selection
                selectedRating = 0;
                document.getElementById('reviewText').value = '';
                document.getElementById('reviewCharCount').textContent = '0';
                document.querySelectorAll('.star-input').forEach(star => {
                    star.classList.remove('active');
                });
                document.getElementById('ratingSubmitBtn').disabled = true;

                // Reload review stream if review text was provided
                if (reviewText && reviewText.length > 0) {
                    loadReviewBubbles();
                }

            } catch (error) {
                console.error('Error submitting rating:', error);
                showRatingMessage('Failed to submit rating. Please try again.', 'error');
            }
        }

        // Show rating message
        function showRatingMessage(message, type) {
            const messageEl = document.getElementById('ratingMessage');
            if (messageEl) {
                messageEl.textContent = message;
                messageEl.className = 'rating-message ' + (type || '');
                setTimeout(() => {
                    messageEl.textContent = '';
                    messageEl.className = 'rating-message';
                }, 3000);
            }
        }

        // Setup rating system
        function setupRatingSystem() {
            // Star input interaction
            const starInputs = document.querySelectorAll('.star-input');
            const submitBtn = document.getElementById('ratingSubmitBtn');

            starInputs.forEach(star => {
                star.addEventListener('click', () => {
                    if (hasRated) return;
                    selectedRating = parseInt(star.getAttribute('data-rating'));
                    
                    // Update visual state
                    starInputs.forEach((s, index) => {
                        if (index < selectedRating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });

                    submitBtn.disabled = false;
                });

                star.addEventListener('mouseenter', () => {
                    if (hasRated) return;
                    const hoverRating = parseInt(star.getAttribute('data-rating'));
                    starInputs.forEach((s, index) => {
                        if (index < hoverRating) {
                            s.style.color = '#ffd700';
                        } else {
                            s.style.color = '#4a4a4a';
                        }
                    });
                });
            });

            // Reset on mouse leave
            document.getElementById('starRating').addEventListener('mouseleave', () => {
                if (hasRated) return;
                starInputs.forEach((s, index) => {
                    if (index < selectedRating) {
                        s.style.color = '#ffd700';
                    } else {
                        s.style.color = '#4a4a4a';
                    }
                });
            });

            // Submit button
            submitBtn.addEventListener('click', () => {
                if (selectedRating > 0 && !hasRated) {
                    submitRating(selectedRating);
                }
            });

            // Check if already rated
            checkIfRated();

            // Load and display current rating
            updateRatingDisplay();

            // Listen for rating updates
            if (firebaseInitialized && database) {
                database.ref(RATINGS_PATH).on('value', () => {
                    updateRatingDisplay();
                    loadReviewBubbles();
                });
            }

            // Character counter for review text
            const reviewTextInput = document.getElementById('reviewText');
            const reviewCharCount = document.getElementById('reviewCharCount');
            if (reviewTextInput && reviewCharCount) {
                reviewTextInput.addEventListener('input', () => {
                    const length = reviewTextInput.value.length;
                    reviewCharCount.textContent = length;
                    if (length > 200) {
                        reviewCharCount.style.color = '#ff6b6b';
                    } else {
                        reviewCharCount.style.color = '#666';
                    }
                });
            }
        }

        // Word Filter System - Comprehensive list
        const FILTERED_WORDS = [
            // Profanity (common)
            'fuck', 'fucking', 'fucked', 'fucker', 'fuckers', 'fuckin', 'fuk', 'fuking', 'fuker',
            'shit', 'shitting', 'shitted', 'shits', 'shitty', 'shyt', 'sht',
            'damn', 'damned', 'dammit', 'dmn',
            'hell', 'hells', 'hll',
            'ass', 'asses', 'asshole', 'assholes', 'arse', 'arses', 'arsehole',
            'bitch', 'bitches', 'bitching', 'bich', 'btch', 'biatch',
            'bastard', 'bastards', 'basterd',
            'crap', 'crappy', 'crp',
            'piss', 'pissing', 'pissed', 'pss',
            'dick', 'dicks', 'dickhead', 'dik', 'dck',
            'cock', 'cocks', 'cok',
            'pussy', 'pussies', 'puss', 'pssy',
            'tits', 'titties', 'tities', 'titty',
            'slut', 'sluts', 'slutty', 'slt',
            'whore', 'whores', 'whre',
            'nigger', 'niggers', 'nigga', 'niggas', 'niga', 'niger', 'ngga',
            'retard', 'retarded', 'retards', 'rtard', 'tard',
            'gay', 'gays', 'fag', 'fags', 'faggot', 'faggots', 'fagot',
            // Inappropriate/Offensive
            'kill', 'killing', 'killed', 'killer', 'killers', 'kil', 'kilz',
            'die', 'dying', 'died', 'death', 'dead', 'dye',
            'hate', 'hating', 'hated', 'hater', 'haters', 'hte',
            'stupid', 'stupidity', 'stupidly', 'stpid', 'stupd',
            'idiot', 'idiots', 'idiotic', 'idot', 'idit',
            'moron', 'morons', 'moronic', 'mron',
            'dumb', 'dumber', 'dumbest', 'dumbass', 'dmb',
            'loser', 'losers', 'losr',
            'suck', 'sucks', 'sucking', 'sucked', 'sucker', 'suk', 'suking',
            'trash', 'trashy', 'trsh',
            'garbage', 'garbages', 'garbge',
            // Leetspeak variations (bypassed profanity)
            'f*ck', 'f**k', 'f***', 'f@ck', 'f#ck', 'f$ck',
            'sh*t', 's**t', 's@t', 's#t', 'sh!t',
            'a$$', 'a**', 'a@@', 'a##',
            'b!tch', 'b*tch', 'b@tch', 'b#tch', 'btch',
            'd!ck', 'd*ck', 'd@ck', 'd#ck', 'dck',
            'p*ssy', 'p@ssy', 'p#ssy', 'pssy',
            'n*gga', 'n@gga', 'n#gga', 'ngga',
            // Inappropriate content
            'porn', 'porno', 'pornography', 'xxx', 'sex', 'sexual', 'sexy',
            'nude', 'naked', 'nudes', 'nsfw', 'nsfw content',
            // Threats/Violence
            'threat', 'threats', 'threatening', 'violence', 'violent',
            'attack', 'attacking', 'attacked', 'bomb', 'bombs', 'bombing',
            'gun', 'guns', 'weapon', 'weapons', 'shoot', 'shooting', 'shooter',
            'murder', 'murdering', 'murdered', 'kill you', 'i will kill',
            // Self-harm
            'suicide', 'suicidal', 'kill myself', 'self harm', 'end my life',
            // Other inappropriate
            'drug', 'drugs', 'cocaine', 'heroin', 'marijuana', 'weed',
            'alcohol', 'drunk', 'drinking', 'beer', 'wine',
            // Bypass attempts (spaces/dots between letters)
            'f u c k', 's h i t', 'a s s', 'b i t c h',
            'f.u.c.k', 's.h.i.t', 'a.s.s', 'b.i.t.c.h',
            'fu ck', 'sh it', 'as s', 'bi tch',
            // Additional offensive terms
            'cunt', 'cunts', 'cnt',
            'rape', 'raping', 'raped', 'rapist',
            'pedo', 'pedophile', 'pedophilia',
            'nazi', 'nazis', 'hitler',
        ];

        // Additional spam patterns (more lenient - only obvious spam)
        const SPAM_PATTERNS = [

        ];

        // Filter text for inappropriate content - ONLY bad words and bypassed bad words
        function filterText(text) {
            if (!text || typeof text !== 'string') return { filtered: false, text: text };

            const originalText = text;
            let filteredText = text.toLowerCase();
            
            // Remove common bypass characters (spaces, dots, dashes, underscores, etc. between letters)
            // This catches attempts like "f u c k", "f.u.c.k", "f-u-c-k", etc.
            const normalizedText = filteredText.replace(/[\s\.\-\*\_\@\#\$\%\^\&\*\(\)\[\]{}|\\\/:;"'<>,?~`!]/g, '');

            // Check for filtered words (both in original and normalized text)
            for (const word of FILTERED_WORDS) {
                const wordLower = word.toLowerCase();
                const wordNormalized = wordLower.replace(/[\s\.\-\*\_]/g, ''); // Normalize the filter word too
                
                // Skip very short words (1-2 chars) to avoid false positives
                if (wordNormalized.length < 3) continue;
                
                // Check in original text (word boundary match)
                const regex1 = new RegExp(`\\b${wordLower.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'gi');
                if (regex1.test(filteredText)) {
                    return { filtered: true, reason: 'inappropriate_language' };
                }
                
                // Check in normalized text (catches bypass attempts like "f u c k", "f.u.c.k", etc.)
                // Only check if the normalized word is at least 4 characters to avoid false matches
                if (wordNormalized.length >= 4 && normalizedText.includes(wordNormalized)) {
                    return { filtered: true, reason: 'inappropriate_language' };
                }
            }

            // That's it - only block bad words, nothing else
            return { filtered: false, text: originalText };
        }

        // Review Stream Ticker System
        let availableReviews = [];
        let streamTrack = null;

        // Load reviews and populate stream ticker
        async function loadReviewBubbles() {
            // If Firebase isn't ready yet, wait a bit and try again
            if (!firebaseInitialized || !database) {
                setTimeout(() => loadReviewBubbles(), 2000);
                return;
            }

            try {
                const snapshot = await database.ref(RATINGS_PATH).once('value');
                if (!snapshot.exists()) {
                    availableReviews = [];
                    updateReviewStream();
                    return;
                }

                const ratings = snapshot.val();
                const allReviews = Object.values(ratings)
                    .filter(r => {
                        // Filter out reviews with inappropriate content
                        if (!r.review || r.review.trim().length === 0) return false;
                        const filterResult = filterText(r.review);
                        return !filterResult.filtered; // Only include non-filtered reviews
                    })
                    .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)); // Most recent first

                // Remove duplicates from database - keep only the most recent version of each unique review text
                const seenReviewTexts = new Map(); // Map of normalized text -> review object
                
                allReviews.forEach(review => {
                    // Normalize review text: trim, lowercase, and normalize whitespace
                    const normalizedText = review.review.trim().toLowerCase().replace(/\s+/g, ' ');
                    
                    // If we haven't seen this review text, or this one is more recent, keep it
                    if (!seenReviewTexts.has(normalizedText)) {
                        seenReviewTexts.set(normalizedText, review);
                    } else {
                        // Compare timestamps - keep the more recent one
                        const existingReview = seenReviewTexts.get(normalizedText);
                        const existingTimestamp = existingReview.timestamp || 0;
                        const currentTimestamp = review.timestamp || 0;
                        
                        if (currentTimestamp > existingTimestamp) {
                            seenReviewTexts.set(normalizedText, review);
                        }
                    }
                });

                // Convert map values to array - these are the unique reviews
                const newReviews = Array.from(seenReviewTexts.values())
                    .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)); // Sort by timestamp again

                // Update available reviews with deduplicated list
                availableReviews = newReviews;
                
                // Update the stream ticker
                updateReviewStream();

            } catch (error) {
                console.error('Error loading review stream:', error);
            }
        }

        // Update the review stream ticker
        async function updateReviewStream() {
            const track = document.getElementById('reviewStreamTrack');
            if (!track) return;

            // Clear existing content
            track.innerHTML = '';

            if (availableReviews.length === 0) {
                // Show placeholder if no reviews
                const placeholder = document.createElement('div');
                placeholder.className = 'review-stream-item';
                placeholder.innerHTML = '<span class="review-stream-text" style="color: #666;">No reviews yet. Be the first to leave one!</span>';
                track.appendChild(placeholder);
                // Duplicate for seamless loop
                track.appendChild(placeholder.cloneNode(true));
                return;
            }

            // Remove duplicates - track unique reviews by their text content only
            const seenReviews = new Set();
            const uniqueReviews = [];

            availableReviews.forEach(review => {
                // Normalize review text: trim, lowercase, and normalize whitespace
                const reviewText = review.review.trim().toLowerCase().replace(/\s+/g, ' ');
                // Use only the review text for uniqueness (not rating)
                // This ensures the same review text only appears once regardless of rating
                const uniqueKey = reviewText;
                
                if (!seenReviews.has(uniqueKey)) {
                    seenReviews.add(uniqueKey);
                    uniqueReviews.push(review);
                }
            });

            // Create review items from unique reviews only
            for (const review of uniqueReviews) {
                const item = document.createElement('div');
                item.className = 'review-stream-item';

                const rating = review.rating || 5;
                const stars = '★'.repeat(rating);
                let reviewText = review.review.trim();
                
                // Truncate if too long
                if (reviewText.length > 100) {
                    reviewText = reviewText.substring(0, 100) + '...';
                }

                // Load user profile if userId exists
                let profileHtml = '';
                if (review.userId && firebaseInitialized && database) {
                    try {
                        const profileSnapshot = await database.ref(`userProfiles/${review.userId}`).once('value');
                        if (profileSnapshot.exists()) {
                            const profile = profileSnapshot.val();
                            const avatarSrc = profile.avatar || `data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22%3E%3Ccircle cx=%2212%22 cy=%2212%22 r=%2212%22 fill=%22%233a3a3a%22/%3E%3Ctext x=%2212%22 y=%2216%22 font-size=%2210%22 fill=%22%23fff%22 text-anchor=%22middle%22%3E${encodeURIComponent((profile.username || '?').charAt(0).toUpperCase())}%3C/text%3E%3C/svg%3E`;
                            profileHtml = `
                                <div class="review-stream-user" onclick="viewUserProfileFromReview('${escapeHtml(review.userId)}')" style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-right: 12px; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
                                    <img src="${escapeHtml(avatarSrc)}" alt="${escapeHtml(profile.username || 'User')}" 
                                         style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover; border: 1px solid rgba(74, 74, 74, 0.5);"
                                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22%3E%3Ccircle cx=%2212%22 cy=%2212%22 r=%2212%22 fill=%22%233a3a3a%22/%3E%3C/svg%3E'">
                                    <span style="color: #b0b0b0; font-size: 12px; font-weight: 500;">${escapeHtml(profile.username || 'User')}</span>
                                </div>
                            `;
                        }
                    } catch (error) {
                        console.error('Error loading profile for review:', error);
                    }
                }

                item.innerHTML = `
                    ${profileHtml}
                    <span class="review-stream-stars">${stars}</span>
                    <span class="review-stream-separator"></span>
                    <span class="review-stream-text">${escapeHtml(reviewText)}</span>
                `;

                track.appendChild(item);
            }

            // Duplicate all items for seamless infinite scroll
            // We need to duplicate the entire set to ensure smooth looping
            const items = track.querySelectorAll('.review-stream-item');
            const itemsArray = Array.from(items);
            
            // Clone each item to create the duplicate set (exact copies)
            itemsArray.forEach(item => {
                const clone = item.cloneNode(true);
                // Ensure clone has same styles
                clone.style.cssText = item.style.cssText;
                track.appendChild(clone);
            });
            
            // Add a small delay to ensure DOM is updated before animation starts
            requestAnimationFrame(() => {
                // Reset animation to ensure smooth start
                track.style.animation = 'none';
                requestAnimationFrame(() => {
                    track.style.animation = '';
                });
            });
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        
        // Handle download button click
        // Rate limiting configuration
        const RATE_LIMIT_CONFIG = {
            maxDownloads: 3,        // Maximum downloads allowed
            timeWindow: 60 * 60 * 1000, // Time window in milliseconds (1 hour)
            storageKey: 'recon_download_limits'
        };

        // Check if user can download (rate limiting)
        function checkDownloadLimit() {
            const now = Date.now();
            const stored = localStorage.getItem(RATE_LIMIT_CONFIG.storageKey);
            
            if (!stored) {
                // First download, create new record
                const record = {
                    downloads: [now],
                    resetAt: now + RATE_LIMIT_CONFIG.timeWindow
                };
                localStorage.setItem(RATE_LIMIT_CONFIG.storageKey, JSON.stringify(record));
                return { allowed: true, remaining: RATE_LIMIT_CONFIG.maxDownloads - 1, resetAt: record.resetAt };
            }
            
            try {
                const record = JSON.parse(stored);
                
                // Check if time window has expired
                if (now > record.resetAt) {
                    // Reset the limit
                    const newRecord = {
                        downloads: [now],
                        resetAt: now + RATE_LIMIT_CONFIG.timeWindow
                    };
                    localStorage.setItem(RATE_LIMIT_CONFIG.storageKey, JSON.stringify(newRecord));
                    return { allowed: true, remaining: RATE_LIMIT_CONFIG.maxDownloads - 1, resetAt: newRecord.resetAt };
                }
                
                // Filter out old downloads outside the time window
                const validDownloads = record.downloads.filter(timestamp => 
                    (now - timestamp) < RATE_LIMIT_CONFIG.timeWindow
                );
                
                // Check if limit is reached
                if (validDownloads.length >= RATE_LIMIT_CONFIG.maxDownloads) {
                    const timeUntilReset = record.resetAt - now;
                    const minutesLeft = Math.ceil(timeUntilReset / (60 * 1000));
                    return { 
                        allowed: false, 
                        remaining: 0, 
                        resetAt: record.resetAt,
                        minutesLeft: minutesLeft
                    };
                }
                
                // Add new download timestamp
                validDownloads.push(now);
                const updatedRecord = {
                    downloads: validDownloads,
                    resetAt: record.resetAt
                };
                localStorage.setItem(RATE_LIMIT_CONFIG.storageKey, JSON.stringify(updatedRecord));
                
                return { 
                    allowed: true, 
                    remaining: RATE_LIMIT_CONFIG.maxDownloads - validDownloads.length,
                    resetAt: record.resetAt
                };
            } catch (error) {
                console.error('Error checking download limit:', error);
                // On error, allow download but reset storage
                localStorage.removeItem(RATE_LIMIT_CONFIG.storageKey);
                return { allowed: true, remaining: RATE_LIMIT_CONFIG.maxDownloads - 1 };
            }
        }

        // Show rate limit message
        function showRateLimitMessage(minutesLeft) {
            const message = `Download limit reached. Please try again in ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''}.`;
            alert(message);
        }

        // Update download button state
        function updateDownloadButtonState(limitInfo) {
            // Only target actual download buttons (by ID), not support ticket button
            const downloadBtn1 = document.getElementById('downloadBtn1');
            const downloadBtn2 = document.getElementById('downloadBtn2');
            const buttons = [downloadBtn1, downloadBtn2].filter(btn => btn !== null);
            
            buttons.forEach(btn => {
                if (!limitInfo.allowed) {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.style.pointerEvents = 'none';
                    btn.title = `Rate limit reached. Try again in ${limitInfo.minutesLeft} minute${limitInfo.minutesLeft !== 1 ? 's' : ''}.`;
                } else {
                    btn.style.opacity = '';
                    btn.style.cursor = '';
                    btn.style.pointerEvents = '';
                    btn.title = '';
                }
            });
        }

        // Check rate limit on page load
        function checkRateLimitOnLoad() {
            const limitInfo = checkDownloadLimit();
            updateDownloadButtonState(limitInfo);
        }

        async function handleDownload(event) {
            event.preventDefault();
            
            // Check rate limit
            const limitInfo = checkDownloadLimit();
            
            if (!limitInfo.allowed) {
                showRateLimitMessage(limitInfo.minutesLeft);
                updateDownloadButtonState(limitInfo);
                return;
            }
            
            const counterElement = document.getElementById('downloadCount');
            const oldCount = parseInt(counterElement?.getAttribute('data-count') || '0', 10);
            
            // Increment download count in Firebase
            const newCount = await incrementDownloadCount();
            
            // Update the counter display with animation
            if (counterElement) {
                counterElement.setAttribute('data-count', newCount);
                animateCounterFromTo(counterElement, oldCount, newCount);
            }
            
            // Trigger actual download
            // TODO: Replace 'your-installer.exe' with the actual file path/URL
            // Example: const downloadUrl = 'https://yourdomain.com/downloads/Recon-Spoofer-Installer.exe';
            const downloadUrl = 'https://github.com/venaticlol/loader/raw/refs/heads/main/Recon-Bootstrapper.exe'; // Update this with your actual file URL
            
            // Create download link
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = 'Recon-Spoofer-Installer.exe';
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            
            // Clean up after a short delay
            setTimeout(() => {
                document.body.removeChild(link);
            }, 100);
            
            // Update button state after download
            const updatedLimitInfo = checkDownloadLimit();
            updateDownloadButtonState(updatedLimitInfo);
        }
        
        // Animate counter from one value to another
        function animateCounterFromTo(element, from, to) {
            const duration = 1000;
            const startTime = performance.now();
            const difference = to - from;
            
            const updateCounter = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for smooth animation
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = Math.floor(from + (difference * easeOut));
                
                element.textContent = current.toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                } else {
                    element.textContent = to.toLocaleString();
                }
            };
            
            requestAnimationFrame(updateCounter);
        }

        // Animated counter for stats
        function animateCounter(element) {
            const target = parseFloat(element.getAttribute('data-count'));
            const duration = 2000;
            const increment = target / (duration / 16);
            let current = 0;

            const updateCounter = () => {
                current += increment;
                if (current < target) {
                    if (target % 1 === 0) {
                        element.textContent = Math.floor(current).toLocaleString();
                    } else {
                        element.textContent = current.toFixed(1);
                    }
                    requestAnimationFrame(updateCounter);
                } else {
                    if (target % 1 === 0) {
                        element.textContent = Math.floor(target).toLocaleString();
                    } else {
                        element.textContent = target.toFixed(1);
                    }
                }
            };

            updateCounter();
        }

        // Trigger counter animation when stats bar is visible
        const statsObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.querySelectorAll('.stat-number').forEach(async (stat) => {
                        // For download count, use the actual count from Firebase
                        if (stat.id === 'downloadCount') {
                            const count = await getDownloadCount();
                            stat.setAttribute('data-count', count);
                            animateCounter(stat);
                        } else {
                            // Other stats (uptime, rating)
                            animateCounter(stat);
                        }
                    });
                    statsObserver.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });

        const statsBar = document.querySelector('.stats-bar');
        if (statsBar) {
            statsObserver.observe(statsBar.parentElement);
        }
        
        // Initialize download count on page load
        updateDownloadCounterDisplay().then(() => {
            // Set up real-time listener after initial load
            setupDownloadCountListener();
        });

        // Initialize rating system when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setupRatingSystem();
                loadReviewBubbles();
            });
        } else {
            setupRatingSystem();
            loadReviewBubbles();
        }

        // Particles will be initialized after authentication

        // Parallax effect on scroll
        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const hero = document.querySelector('.hero');
            if (hero) {
                hero.style.transform = `translateY(${scrolled * 0.3}px)`;
            }
        });

        // ============================================
        // ADMIN PANEL WITH IP-BASED AUTHENTICATION
        // ============================================
        let isAdminLoggedIn = false;
        const ADMIN_SESSION_KEY = 'recon_admin_session';
        const ALLOWED_ADMIN_IPS = ['172.56.41.249', '74.14.72.29'];

        // Check if current IP is allowed for admin access
        async function checkAdminIP() {
            try {
                const ip = await getClientIP();
                return ALLOWED_ADMIN_IPS.includes(ip);
            } catch (error) {
                console.error('Error checking admin IP:', error);
                return false;
            }
        }

        // Check if admin is logged in
        async function checkAdminSession() {
            const session = sessionStorage.getItem(ADMIN_SESSION_KEY);
            if (session === 'true') {
                // Verify IP is still valid
                const isAllowedIP = await checkAdminIP();
                if (isAllowedIP) {
                    isAdminLoggedIn = true;
                    showAdminPanel();
                    updateAdminButton();
                } else {
                    // IP changed, logout
                    adminLogout();
                    showAdminError('Access denied: IP address not authorized');
                }
            }
        }

        // Admin login (IP-based)
        async function adminLogin() {
            try {
                const isAllowedIP = await checkAdminIP();
                
                if (isAllowedIP) {
                    isAdminLoggedIn = true;
                    sessionStorage.setItem(ADMIN_SESSION_KEY, 'true');
                    hideAdminModal();
                    showAdminPanel();
                    updateAdminButton();
                    console.log('✅ Admin login successful via IP verification');
                    return true;
                } else {
                    const ip = await getClientIP();
                    showAdminError(`Access denied. Your IP (${ip}) is not authorized.`);
                    console.warn('❌ Admin login denied - IP not in allowed list:', ip);
                    return false;
                }
            } catch (error) {
                showAdminError('Error verifying IP address. Please try again.');
                console.error('Admin login error:', error);
                return false;
            }
        }

        // Admin logout
        function adminLogout() {
            isAdminLoggedIn = false;
            sessionStorage.removeItem(ADMIN_SESSION_KEY);
            hideAdminPanel();
            updateAdminButton();
        }

        // Show admin modal
        function showAdminModal() {
            const overlay = document.getElementById('adminModalOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
            }
        }

        // Hide admin modal
        function hideAdminModal() {
            const overlay = document.getElementById('adminModalOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            const errorMsg = document.getElementById('adminErrorMessage');
            if (errorMsg) {
                errorMsg.classList.remove('show');
            }
        }

        // Show admin panel - redirect to admin page
        function showAdminPanel() {
            window.location.href = '/admin';
        }

        // Hide admin panel
        function hideAdminPanel() {
            const panel = document.getElementById('adminPanel');
            if (panel) {
                panel.style.display = 'none';
            }
        }

        // Update admin button
        function updateAdminButton() {
            const btn = document.getElementById('adminLoginBtn');
            if (btn) {
                if (isAdminLoggedIn) {
                    btn.classList.add('logged-in');
                    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="M9 12l2 2 4-4"></path></svg><span>Admin</span>';
                } else {
                    btn.classList.remove('logged-in');
                    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg><span>Admin</span>';
                }
            }
        }

        // Show admin error
        function showAdminError(message) {
            const errorMsg = document.getElementById('adminErrorMessage');
            if (errorMsg) {
                errorMsg.textContent = message;
                errorMsg.classList.add('show');
            }
        }

        // Load admin data
        async function loadAdminData() {
            if (!isAdminLoggedIn) return;
            await loadAnnouncementsList();
            await loadChangelogList();
            await loadAnalytics();
        }

        // Load analytics data
        async function loadAnalytics() {
            if (!firebaseInitialized || !database) return;

            try {
                // Load downloads
                const downloadsSnapshot = await database.ref('downloads/count').once('value');
                const downloads = downloadsSnapshot.exists() ? downloadsSnapshot.val() : 0;
                document.getElementById('statDownloads').textContent = downloads.toLocaleString();

                // Load ratings count
                const ratingsSnapshot = await database.ref('ratings').once('value');
                const ratings = ratingsSnapshot.exists() ? Object.keys(ratingsSnapshot.val()).length : 0;
                document.getElementById('statRatings').textContent = ratings.toLocaleString();

                // Load announcements count
                const announcementsSnapshot = await database.ref('announcements').once('value');
                const announcements = announcementsSnapshot.exists() ? Object.keys(announcementsSnapshot.val()).length : 0;
                document.getElementById('statAnnouncements').textContent = announcements.toLocaleString();

                // Load changelog count
                const changelogSnapshot = await database.ref('changelog').once('value');
                const changelogs = changelogSnapshot.exists() ? Object.keys(changelogSnapshot.val()).length : 0;
                document.getElementById('statChangelogs').textContent = changelogs.toLocaleString();

                // Load activity log
                loadActivityLog();
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Load activity log
        async function loadActivityLog() {
            const logContainer = document.getElementById('activityLog');
            if (!logContainer) return;

            const activities = [];
            const now = new Date();

            // Get recent announcements
            try {
                const announcementsSnapshot = await database.ref('announcements').once('value');
                if (announcementsSnapshot.exists()) {
                    Object.entries(announcementsSnapshot.val()).forEach(([id, announcement]) => {
                        activities.push({
                            type: 'announcement',
                            text: `Announcement: "${announcement.title}"`,
                            time: now
                        });
                    });
                }
            } catch (error) {
                console.error('Error loading activity:', error);
            }

            // Sort by time (most recent first) and limit to 10
            activities.sort((a, b) => b.time - a.time);
            const recentActivities = activities.slice(0, 10);

            if (recentActivities.length === 0) {
                logContainer.innerHTML = '<div style="color: #888; padding: 20px; text-align: center;">No recent activity</div>';
                return;
            }

            logContainer.innerHTML = recentActivities.map(activity => `
                <div class="admin-activity-item">
                    <div>${activity.text}</div>
                    <div class="admin-activity-time">${activity.time.toLocaleString()}</div>
                </div>
            `).join('');
        }

        // Load announcements list for admin
        async function loadAnnouncementsList() {
            const list = document.getElementById('announcementsList');
            if (!list || !firebaseInitialized || !database) return;

            try {
                const snapshot = await database.ref('announcements').once('value');
                if (!snapshot.exists()) {
                    list.innerHTML = '<div style="color: #888; padding: 20px; text-align: center;">No announcements yet</div>';
                    return;
                }

                const announcements = snapshot.val();
                list.innerHTML = Object.entries(announcements).map(([id, announcement]) => `
                    <div class="admin-list-item">
                        <div class="admin-list-item-header">
                            <div class="admin-list-item-title">${escapeHtml(announcement.title || 'Untitled')}</div>
                            <div class="admin-list-item-actions">
                                <button class="admin-btn-small" onclick="editAnnouncement('${id}')">Edit</button>
                                <button class="admin-btn-small delete" onclick="deleteAnnouncement('${id}')">Delete</button>
                            </div>
                        </div>
                        <div style="color: #888; font-size: 13px; margin-top: 8px;">${escapeHtml(announcement.message || '')}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading announcements:', error);
                list.innerHTML = '<div style="color: #ef4444; padding: 20px;">Error loading announcements</div>';
            }
        }

        // Load changelog list for admin
        async function loadChangelogList() {
            const list = document.getElementById('changelogList');
            if (!list || !firebaseInitialized || !database) return;

            try {
                const snapshot = await database.ref('changelog').once('value');
                if (!snapshot.exists()) {
                    list.innerHTML = '<div style="color: #888; padding: 20px; text-align: center;">No changelog entries yet</div>';
                    return;
                }

                const changelog = snapshot.val();
                list.innerHTML = Object.entries(changelog).map(([id, entry]) => `
                    <div class="admin-list-item">
                        <div class="admin-list-item-header">
                            <div class="admin-list-item-title">${escapeHtml(entry.version || 'Unknown Version')} - ${escapeHtml(entry.date || '')}</div>
                            <div class="admin-list-item-actions">
                                <button class="admin-btn-small" onclick="editChangelog('${id}')">Edit</button>
                                <button class="admin-btn-small delete" onclick="deleteChangelog('${id}')">Delete</button>
                            </div>
                        </div>
                        <div style="color: #888; font-size: 13px; margin-top: 8px;">${(entry.changes || []).length} changes</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading changelog:', error);
                list.innerHTML = '<div style="color: #ef4444; padding: 20px;">Error loading changelog</div>';
            }
        }

        // Initialize database paths (force creation)
        async function forceInitPaths() {
            if (!firebaseInitialized || !database) {
                showDatabaseStatus('Firebase not initialized', 'error');
                return;
            }

            showDatabaseStatus('Initializing paths...', '');
            try {
                // Force create announcements
                await database.ref('announcements').set({});
                console.log('✅ Created announcements path');

                // Force create changelog
                await database.ref('changelog').set({});
                console.log('✅ Created changelog path');

                // Force create translations
                await database.ref('translations').set({});
                console.log('✅ Created translations path');

                showDatabaseStatus('✅ All paths created successfully!', 'success');
            } catch (error) {
                console.error('Error creating paths:', error);
                showDatabaseStatus('❌ Error: ' + error.message, 'error');
            }
        }

        function showDatabaseStatus(message, type) {
            const status = document.getElementById('databaseStatus');
            if (status) {
                status.textContent = message;
                status.className = 'admin-status ' + (type || '');
            }
        }

        // Advanced Admin Tools
        window.exportData = async function() {
            if (!firebaseInitialized || !database) {
                alert('Firebase not initialized');
                return;
            }

            try {
                const data = {
                    announcements: {},
                    changelog: {},
                    downloads: {},
                    ratings: {},
                    translations: {}
                };

                const snapshots = await Promise.all([
                    database.ref('announcements').once('value'),
                    database.ref('changelog').once('value'),
                    database.ref('downloads').once('value'),
                    database.ref('ratings').once('value'),
                    database.ref('translations').once('value')
                ]);

                if (snapshots[0].exists()) data.announcements = snapshots[0].val();
                if (snapshots[1].exists()) data.changelog = snapshots[1].val();
                if (snapshots[2].exists()) data.downloads = snapshots[2].val();
                if (snapshots[3].exists()) data.ratings = snapshots[3].val();
                if (snapshots[4].exists()) data.translations = snapshots[4].val();

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `recon-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                alert('✅ Data exported successfully!');
            } catch (error) {
                console.error('Export error:', error);
                alert('❌ Failed to export data: ' + error.message);
            }
        };

        window.importData = function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const text = await file.text();
                    const data = JSON.parse(text);

                    if (!confirm('⚠️ This will overwrite existing data. Continue?')) return;

                    if (!firebaseInitialized || !database) {
                        alert('Firebase not initialized');
                        return;
                    }

                    if (data.announcements) await database.ref('announcements').set(data.announcements);
                    if (data.changelog) await database.ref('changelog').set(data.changelog);
                    if (data.downloads) await database.ref('downloads').set(data.downloads);
                    if (data.ratings) await database.ref('ratings').set(data.ratings);
                    if (data.translations) await database.ref('translations').set(data.translations);

                    alert('✅ Data imported successfully!');
                    loadAdminData();
                } catch (error) {
                    console.error('Import error:', error);
                    alert('❌ Failed to import data: ' + error.message);
                }
            };
            input.click();
        };

        window.clearDismissedAnnouncements = function() {
            if (confirm('Clear all dismissed announcements? Users will see them again.')) {
                localStorage.removeItem(ANNOUNCEMENT_DISMISSED_KEY);
                alert('✅ Dismissed announcements cleared!');
            }
        };

        window.bulkDeleteAnnouncements = async function() {
            if (!firebaseInitialized || !database) {
                alert('Firebase not initialized');
                return;
            }

            try {
                const snapshot = await database.ref('announcements').once('value');
                if (!snapshot.exists()) {
                    alert('No announcements to delete');
                    return;
                }

                const announcements = snapshot.val();
                const ids = Object.keys(announcements);
                const selected = prompt(`Enter announcement IDs to delete (comma-separated):\n\nAvailable IDs: ${ids.join(', ')}`);
                
                if (!selected) return;

                const toDelete = selected.split(',').map(id => id.trim()).filter(id => ids.includes(id));
                if (toDelete.length === 0) {
                    alert('No valid IDs selected');
                    return;
                }

                if (confirm(`Delete ${toDelete.length} announcement(s)?`)) {
                    await Promise.all(toDelete.map(id => database.ref(`announcements/${id}`).remove()));
                    alert(`✅ Deleted ${toDelete.length} announcement(s)!`);
                    loadAnnouncementsList();
                }
            } catch (error) {
                console.error('Bulk delete error:', error);
                alert('❌ Failed to delete: ' + error.message);
            }
        };

        window.searchAndFilter = function() {
            const query = prompt('Enter search query:');
            if (!query) return;

            // Simple search implementation
            const items = document.querySelectorAll('.admin-list-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query.toLowerCase()) ? '' : 'none';
            });
        };

        window.systemHealthCheck = async function() {
            if (!firebaseInitialized || !database) {
                alert('❌ Firebase not initialized');
                return;
            }

            try {
                const checks = [];
                
                // Check Firebase connection
                try {
                    await database.ref('.info/connected').once('value');
                    checks.push('✅ Firebase connected');
                } catch (e) {
                    checks.push('❌ Firebase connection failed');
                }

                // Check database paths
                const paths = ['announcements', 'changelog', 'downloads', 'ratings', 'translations'];
                for (const path of paths) {
                    const snapshot = await database.ref(path).once('value');
                    checks.push(snapshot.exists() ? `✅ ${path} exists` : `⚠️ ${path} missing`);
                }

                alert('System Health Check:\n\n' + checks.join('\n'));
            } catch (error) {
                console.error('Health check error:', error);
                alert('❌ Health check failed: ' + error.message);
            }
        };

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // No initialization needed for IP-based auth

            // Check admin session
            checkAdminSession();

            // Admin login button
            const adminBtn = document.getElementById('adminLoginBtn');
            if (adminBtn) {
                adminBtn.addEventListener('click', () => {
                    if (isAdminLoggedIn) {
                        showAdminPanel();
                    } else {
                        showAdminModal();
                    }
                });
            }

            // Admin modal close
            const modalClose = document.getElementById('adminModalClose');
            if (modalClose) {
                modalClose.addEventListener('click', hideAdminModal);
            }

            // Admin modal overlay click
            const modalOverlay = document.getElementById('adminModalOverlay');
            if (modalOverlay) {
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        hideAdminModal();
                    }
                });
            }

            // Admin submit
            const adminSubmit = document.getElementById('adminSubmitBtn');
            if (adminSubmit) {
                adminSubmit.addEventListener('click', async () => {
                    adminSubmit.disabled = true;
                    adminSubmit.textContent = 'Verifying...';
                    await adminLogin();
                    adminSubmit.disabled = false;
                    adminSubmit.textContent = 'Login';
                });
            }

            // Admin panel close
            const panelClose = document.getElementById('adminPanelClose');
            if (panelClose) {
                panelClose.addEventListener('click', adminLogout);
            }

            // Admin tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    const tabContent = document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1));
                    if (tabContent) {
                        tabContent.classList.add('active');
                        // Load analytics when switching to analytics tab
                        if (tabName === 'analytics') {
                            loadAnalytics();
                        }
                    }
                });
            });

            // Add announcement button
            const addAnnouncementBtn = document.getElementById('addAnnouncementBtn');
            if (addAnnouncementBtn) {
                addAnnouncementBtn.addEventListener('click', () => {
                    editAnnouncement(null);
                });
            }

            // Announcement editor close
            const announcementEditorClose = document.getElementById('announcementEditorClose');
            const announcementCancelBtn = document.getElementById('announcementCancelBtn');
            if (announcementEditorClose) {
                announcementEditorClose.addEventListener('click', hideAnnouncementEditor);
            }
            if (announcementCancelBtn) {
                announcementCancelBtn.addEventListener('click', hideAnnouncementEditor);
            }

            // Announcement editor overlay click
            const announcementEditorModal = document.getElementById('announcementEditorModal');
            if (announcementEditorModal) {
                announcementEditorModal.addEventListener('click', (e) => {
                    if (e.target === announcementEditorModal) {
                        hideAnnouncementEditor();
                    }
                });
            }

            // Save announcement button
            const announcementSaveBtn = document.getElementById('announcementSaveBtn');
            if (announcementSaveBtn) {
                announcementSaveBtn.addEventListener('click', saveAnnouncement);
            }

            // Add changelog button
            const addChangelogBtn = document.getElementById('addChangelogBtn');
            if (addChangelogBtn) {
                addChangelogBtn.addEventListener('click', () => {
                    editChangelog(null);
                });
            }

            // Changelog editor close
            const changelogEditorClose = document.getElementById('changelogEditorClose');
            const changelogCancelBtn = document.getElementById('changelogCancelBtn');
            if (changelogEditorClose) {
                changelogEditorClose.addEventListener('click', hideChangelogEditor);
            }
            if (changelogCancelBtn) {
                changelogCancelBtn.addEventListener('click', hideChangelogEditor);
            }

            // Changelog editor overlay click
            const changelogEditorModal = document.getElementById('changelogEditorModal');
            if (changelogEditorModal) {
                changelogEditorModal.addEventListener('click', (e) => {
                    if (e.target === changelogEditorModal) {
                        hideChangelogEditor();
                    }
                });
            }

            // Save changelog button
            const changelogSaveBtn = document.getElementById('changelogSaveBtn');
            if (changelogSaveBtn) {
                changelogSaveBtn.addEventListener('click', saveChangelog);
            }

            // Add change button
            const addChangeBtn = document.getElementById('addChangeBtn');
            const changelogChangeInput = document.getElementById('changelogChangeInput');
            if (addChangeBtn) {
                addChangeBtn.addEventListener('click', addChangelogChange);
            }
            if (changelogChangeInput) {
                changelogChangeInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        addChangelogChange();
                    }
                });
            }

            // Initialize paths button
            const initPathsBtn = document.getElementById('initPathsBtn');
            if (initPathsBtn) {
                initPathsBtn.addEventListener('click', forceInitPaths);
            }
        });

        // Show announcement editor
        window.editAnnouncement = async function(id) {
            const modal = document.getElementById('announcementEditorModal');
            const title = document.getElementById('announcementEditorTitle');
            const titleInput = document.getElementById('announcementTitleInput');
            const messageInput = document.getElementById('announcementMessageInput');
            const typeInput = document.getElementById('announcementTypeInput');
            const priorityInput = document.getElementById('announcementPriorityInput');
            const startDateInput = document.getElementById('announcementStartDateInput');
            const endDateInput = document.getElementById('announcementEndDateInput');
            const dismissibleInput = document.getElementById('announcementDismissibleInput');
            const linkInput = document.getElementById('announcementLinkInput');
            const linkTextInput = document.getElementById('announcementLinkTextInput');
            const errorDiv = document.getElementById('announcementEditorError');

            if (!modal) return;

            // Clear form
            titleInput.value = '';
            messageInput.value = '';
            typeInput.value = 'info';
            priorityInput.value = 'medium';
            endDateInput.value = '';
            dismissibleInput.checked = true;
            linkInput.value = '';
            linkTextInput.value = '';
            errorDiv.classList.remove('show');
            errorDiv.textContent = '';

            // Set title
            if (id) {
                title.textContent = 'Edit Announcement';
                // Load existing announcement
                try {
                    const snapshot = await database.ref(`announcements/${id}`).once('value');
                    if (snapshot.exists()) {
                        const announcement = snapshot.val();
                        titleInput.value = announcement.title || '';
                        messageInput.value = announcement.message || '';
                        typeInput.value = announcement.type || 'info';
                        priorityInput.value = announcement.priority || 'medium';
                        
                        // Convert timestamp to datetime-local format
                        if (announcement.endDate) {
                            const endDate = new Date(announcement.endDate);
                            endDateInput.value = endDate.toISOString().slice(0, 16);
                        }
                        
                        dismissibleInput.checked = announcement.dismissible !== false;
                        linkInput.value = announcement.link || '';
                        linkTextInput.value = announcement.linkText || '';
                    }
                } catch (error) {
                    console.error('Error loading announcement:', error);
                    showAnnouncementEditorError('Failed to load announcement');
                }
            } else {
                title.textContent = 'Add Announcement';
            }

            // Show modal
            modal.style.display = 'flex';
            window.currentEditingAnnouncementId = id;
        };

        // Hide announcement editor
        window.hideAnnouncementEditor = function() {
            const modal = document.getElementById('announcementEditorModal');
            if (modal) {
                modal.style.display = 'none';
            }
            window.currentEditingAnnouncementId = null;
        };

        // Show announcement editor error
        function showAnnouncementEditorError(message) {
            const errorDiv = document.getElementById('announcementEditorError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.add('show');
            }
        }

        // Save announcement
        window.saveAnnouncement = async function() {
            const titleInput = document.getElementById('announcementTitleInput');
            const messageInput = document.getElementById('announcementMessageInput');
            const typeInput = document.getElementById('announcementTypeInput');
            const priorityInput = document.getElementById('announcementPriorityInput');
            const endDateInput = document.getElementById('announcementEndDateInput');
            const dismissibleInput = document.getElementById('announcementDismissibleInput');
            const linkInput = document.getElementById('announcementLinkInput');
            const linkTextInput = document.getElementById('announcementLinkTextInput');
            const errorDiv = document.getElementById('announcementEditorError');
            const saveBtn = document.getElementById('announcementSaveBtn');

            // Validate
            if (!titleInput.value.trim()) {
                showAnnouncementEditorError('Title is required');
                return;
            }
            if (!messageInput.value.trim()) {
                showAnnouncementEditorError('Message is required');
                return;
            }

            // Get values
            const title = titleInput.value.trim();
            const message = messageInput.value.trim();
            const type = typeInput.value;
            const priority = priorityInput.value;
            const endDate = endDateInput.value ? new Date(endDateInput.value).getTime() : null;
            const dismissible = dismissibleInput.checked;
            const link = linkInput.value.trim() || null;
            const linkText = linkTextInput.value.trim() || null;

            // Validate link
            if (link && !linkText) {
                showAnnouncementEditorError('Link text is required when link URL is provided');
                return;
            }
            if (linkText && !link) {
                showAnnouncementEditorError('Link URL is required when link text is provided');
                return;
            }

            if (!firebaseInitialized || !database) {
                showAnnouncementEditorError('Firebase not initialized');
                return;
            }

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                const announcementData = {
                    title: title,
                    message: message,
                    type: type,
                    priority: priority,
                    dismissible: dismissible
                };

                if (endDate) {
                    announcementData.endDate = endDate;
                }
                if (link) {
                    announcementData.link = link;
                    announcementData.linkText = linkText;
                }

                const id = window.currentEditingAnnouncementId || 'announcement_' + Date.now();
                await database.ref(`announcements/${id}`).set(announcementData);

                console.log('✅ Announcement saved:', id);
                hideAnnouncementEditor();
                loadAnnouncementsList();
                loadAnnouncements(); // Refresh public announcements
            } catch (error) {
                console.error('Error saving announcement:', error);
                showAnnouncementEditorError('Failed to save announcement: ' + error.message);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Announcement';
            }
        }

        // Delete announcement
        window.deleteAnnouncement = async function(id) {
            if (!confirm('Are you sure you want to delete this announcement?')) return;
            if (!firebaseInitialized || !database) return;

            try {
                await database.ref(`announcements/${id}`).remove();
                loadAnnouncementsList();
                loadAnnouncements(); // Refresh public announcements
            } catch (error) {
                console.error('Error deleting announcement:', error);
                alert('Error deleting announcement');
            }
        };

        // Changelog changes array
        let changelogChanges = [];

        // Show changelog editor
        window.editChangelog = async function(id) {
            const modal = document.getElementById('changelogEditorModal');
            const title = document.getElementById('changelogEditorTitle');
            const versionInput = document.getElementById('changelogVersionInput');
            const dateInput = document.getElementById('changelogDateInput');
            const typeInput = document.getElementById('changelogTypeInput');
            const downloadUrlInput = document.getElementById('changelogDownloadUrlInput');
            const changesList = document.getElementById('changelogChangesList');
            const changeInput = document.getElementById('changelogChangeInput');
            const errorDiv = document.getElementById('changelogEditorError');

            if (!modal) return;

            // Clear form
            versionInput.value = '';
            dateInput.value = '';
            typeInput.value = '';
            downloadUrlInput.value = '';
            changelogChanges = [];
            changeInput.value = '';
            errorDiv.classList.remove('show');
            errorDiv.textContent = '';
            renderChangelogChanges();

            // Set title
            if (id) {
                title.textContent = 'Edit Changelog Entry';
                // Load existing changelog
                try {
                    const snapshot = await database.ref(`changelog/${id}`).once('value');
                    if (snapshot.exists()) {
                        const entry = snapshot.val();
                        versionInput.value = entry.version || '';
                        
                        // Convert date to input format
                        if (entry.date) {
                            // Try to parse the date string
                            const dateStr = entry.date;
                            // Handle formats like "January 20, 2024" or "2024-01-20"
                            let dateObj;
                            if (dateStr.includes(',')) {
                                dateObj = new Date(dateStr);
                            } else {
                                dateObj = new Date(dateStr);
                            }
                            if (!isNaN(dateObj.getTime())) {
                                dateInput.value = dateObj.toISOString().split('T')[0];
                            }
                        }
                        
                        typeInput.value = entry.type || '';
                        downloadUrlInput.value = entry.downloadUrl || '';
                        changelogChanges = Array.isArray(entry.changes) ? [...entry.changes] : [];
                        renderChangelogChanges();
                    }
                } catch (error) {
                    console.error('Error loading changelog:', error);
                    showChangelogEditorError('Failed to load changelog entry');
                }
            } else {
                title.textContent = 'Add Changelog Entry';
                // Set default date to today
                const today = new Date();
                dateInput.value = today.toISOString().split('T')[0];
            }

            // Show modal
            modal.style.display = 'flex';
            window.currentEditingChangelogId = id;
        };

        // Render changelog changes list
        function renderChangelogChanges() {
            const changesList = document.getElementById('changelogChangesList');
            if (!changesList) return;

            if (changelogChanges.length === 0) {
                changesList.innerHTML = '<div style="color: #888; font-size: 13px; padding: 8px;">No changes added yet</div>';
                return;
            }

            changesList.innerHTML = changelogChanges.map((change, index) => `
                <div class="changelog-change-item">
                    <span class="changelog-change-item-text">${escapeHtml(change)}</span>
                    <button type="button" class="changelog-change-item-remove" onclick="removeChangelogChange(${index})">Remove</button>
                </div>
            `).join('');
        }

        // Add changelog change
        window.addChangelogChange = function() {
            const changeInput = document.getElementById('changelogChangeInput');
            if (!changeInput) return;

            const change = changeInput.value.trim();
            if (!change) return;

            changelogChanges.push(change);
            changeInput.value = '';
            renderChangelogChanges();
        };

        // Remove changelog change
        window.removeChangelogChange = function(index) {
            changelogChanges.splice(index, 1);
            renderChangelogChanges();
        };

        // Hide changelog editor
        window.hideChangelogEditor = function() {
            const modal = document.getElementById('changelogEditorModal');
            if (modal) {
                modal.style.display = 'none';
            }
            window.currentEditingChangelogId = null;
            changelogChanges = [];
        };

        // Show changelog editor error
        function showChangelogEditorError(message) {
            const errorDiv = document.getElementById('changelogEditorError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.add('show');
            }
        }

        // Save changelog
        window.saveChangelog = async function() {
            const versionInput = document.getElementById('changelogVersionInput');
            const dateInput = document.getElementById('changelogDateInput');
            const typeInput = document.getElementById('changelogTypeInput');
            const downloadUrlInput = document.getElementById('changelogDownloadUrlInput');
            const errorDiv = document.getElementById('changelogEditorError');
            const saveBtn = document.getElementById('changelogSaveBtn');

            // Validate
            if (!versionInput.value.trim()) {
                showChangelogEditorError('Version is required');
                return;
            }
            if (!dateInput.value) {
                showChangelogEditorError('Release date is required');
                return;
            }
            if (changelogChanges.length === 0) {
                showChangelogEditorError('At least one change is required');
                return;
            }

            // Get values
            const version = versionInput.value.trim();
            const dateObj = new Date(dateInput.value);
            const date = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const type = typeInput.value.trim() || null;
            const downloadUrl = downloadUrlInput.value.trim() || null;
            const changes = changelogChanges.filter(c => c.trim().length > 0);

            if (!firebaseInitialized || !database) {
                showChangelogEditorError('Firebase not initialized');
                return;
            }

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                const changelogData = {
                    version: version,
                    date: date,
                    changes: changes
                };

                if (type) {
                    changelogData.type = type;
                }
                if (downloadUrl) {
                    changelogData.downloadUrl = downloadUrl;
                }

                const id = window.currentEditingChangelogId || 'v' + version.replace(/\./g, '_') + '_' + Date.now();
                await database.ref(`changelog/${id}`).set(changelogData);

                console.log('✅ Changelog saved:', id);
                hideChangelogEditor();
                loadChangelogList();
                loadChangelog(); // Refresh public changelog
            } catch (error) {
                console.error('Error saving changelog:', error);
                showChangelogEditorError('Failed to save changelog: ' + error.message);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Changelog';
            }
        };

        // Delete changelog
        window.deleteChangelog = async function(id) {
            if (!confirm('Are you sure you want to delete this changelog entry?')) return;
            if (!firebaseInitialized || !database) return;

            try {
                await database.ref(`changelog/${id}`).remove();
                loadChangelogList();
                loadChangelog(); // Refresh public changelog
            } catch (error) {
                console.error('Error deleting changelog:', error);
                alert('Error deleting changelog');
            }
        };
    </script>
</body>
</html>